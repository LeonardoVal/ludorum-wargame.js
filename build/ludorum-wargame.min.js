//! ludorum-wargame 0.0.1

(function(a){"use strict";"function"==typeof define&&define.amd?define(["creatartis-base","sermat","ludorum"],a):"object"==typeof exports&&module.exports?module.exports=a(require("creatartis-base"),require("sermat"),require("ludorum")):this["ludorum-wargame"]=a(this.base,this.Sermat,this.ludorum)}).call(this,function a(b,c,d){"use strict";function e(a,b){return a[0]<b[0]?[b[0]-1,b[1]]:a[0]>b[0]?[b[0]+1,b[1]]:a[1]<b[1]?[b[0],b[1]-1]:a[1]>=b[1]?[b[0],b[1]+1]:void 0}function f(a,b){return b.priority=a,b}function g(a){var b={};return a&&"[object Function]"===b.toString.call(a)}var h=b.declare,k=b.iterable,l=b.Iterable,m=b.initialize,n=b.raiseIf,o=b.obj,p={__package__:"ludorum-wargame",__name__:"ludorum_wargame",__init__:a,__dependencies__:[b,c,d],__SERMAT__:{include:[b]}},q=p.Army=h({constructor:function(a){var b=this;m(this,a).string("player",{ignore:!0}).number("score",{coerce:!0,defaultValue:0}).array("units"),this.units&&this.units.forEach(function(a,c){a.id=b.player+"#"+c,a.army=b})},isEnabled:function(){for(var a=0,b=this.units.length;a<b;a++)if(this.units[a].isEnabled)return!0;return!1},startRound:function(){return this.units.filter(function(a){return a.startRound()}).length},actions:function(a){var b=a.activeUnit();return b?b.getActions(a):this.units.filter(function(a){return a.isEnabled}).map(function(a){return new u(a.id)})},isEliminated:function(a){return this.units.filter(function(a){return!a.isDead()}).length<=0},livingUnits:function(){return this.units.filter(function(a){return!a.isDead()})},worth:function(){return k(this.units).map(function(a){return a.worth()}).sum()},"static __SERMAT__":{serializer:function(a){return[{player:a.player,units:a.units,score:a.score}]}}}),r=p.Unit=h({radius:.5,quality:3,defense:4,constructor:function(a){m(this,a).array("position").array("models").bool("isActive",{ignore:!0}).bool("hasMoved",{ignore:!0}).bool("isEnabled",{ignore:!0}),this.position=new Float32Array(this.position)},cost:function(){return k(this.models).map(function(a){return a.cost||0}).sum()},size:function(){return this.models.length},livingModels:function(){return this.models.filter(function(a){return a.health()>0})},health:function(){return this.livingModels().length},isDead:function(){return this.health()<=0},worth:function(){return k(this.models).map(function(a){return a.health()/a.toughness*a.cost}).sum()},getActions:function(a){var b=[new v(this.id)];return this.isActive&&(this.hasMoved||(b=b.concat(this.getMoveActions(a))),b=b.concat(this.getShootActions(a))),b},maxRange:function(){var a=-(1/0);return this.livingModels().forEach(function(b){b.equipments.forEach(function(b){+b.range>a&&(a=+b.range)})}),a},getShootActions:function(a){var b=a.armies[a.opponent()].units,c=this,d=b.filter(function(b){return a.terrain.canShoot(c,b)!=1/0}).map(function(a){return new x(c.id,a.id)});return d},getAssaultActions:function(a){var b=a.armies[a.opponent()].units,c=this,d=b.filter(function(b){return a.terrain.canShoot(c,b)<=12}).map(function(a){return new y(c.id,a.id)});return d},getMoveActions:function(a){var b=this;return k(a.terrain.reachablePositions(b)).mapApply(function(a,c){var d=a.split(",");return new w(b.id,[+d[0],+d[1]],c>6)}).toArray()},startRound:function(){return this.isActive=!1,this.hasMoved=!1,this.isEnabled=this.health()>0,this.isEnabled},activate:function(a){n(!this.isEnabled,"Unit ",this.id," is not enabled!"),n(this.isActive,"Unit ",this.id," is already active!"),n(this.health()<=0,"Unit ",this.id," has been eliminated!"),this.isActive=!0,a.__activeUnit__=this},endTurn:function(a){this.isActive=!1,this.isEnabled=!1,a.__activeUnit__===this&&(a.__activeUnit__=null)},move:function(a,b,c){n(!this.isActive,"Unit ",this.id," is not active!"),this.position=b,this.hasMoved=!0,c&&this.endTurn(a)},suffer:function(a,b){var c,d,e,f=this.models;for(e=0;b>0&&e<f.length&&(c=f[e],d=c.health(),!(d>0&&(c.wounds+=Math.min(b,d),b-=d,b<=0)));e++);return this.isEnabled=this.isEnabled&&!this.isDead(),this.isEnabled},influence:function(a){},"static __SERMAT__":{serializer:function(a){var b={position:[a.position[0],a.position[1]],models:a.models};return["isActive","hasMoved","isEnabled"].forEach(function(c){a.hasOwnProperty(c)&&(b[c]=a[c])}),[b]}}}),s=p.Model=h({toughness:1,equipments:[],constructor:function(a){this.wounds=0|a},health:function(){return this.toughness-this.wounds},shooting:function(a){return a=a||1,equipments.filter(function(b){return b.range>=a})},melee:function(){return equipments.filter(function(a){return a.range<1})},"static __SERMAT__":{serializer:function(a){return[a.wounds]}}}),t=p.GameAction=h({aleatories:function(a){return null},execute:b.objects.unimplemented("GameAction","execute(game, haps)"),unitById:function(a,b){b=b||this.unitId;for(var c=null,d=0;!c&&d<a.players.length;d++)for(var e=a.armies[a.players[d]].units,f=0;f<e.length;f++)if(e[f].id==b){c=e[f];break}return n(!c,"Unit ",b," was not found!"),c},worth:function(){return 0}}),u=p.ActivateAction=h(t,{constructor:function(a){this.unitId=a},execute:function(a){this.unitById(a).activate(a)},"static __SERMAT__":{identifier:"ActivateAction",serializer:function(a){return[a.unitId]}}}),v=p.EndTurnAction=h(t,{constructor:function(a){this.unitId=a},execute:function(a){this.unitById(a).endTurn(a)},"static __SERMAT__":{identifier:"EndTurnAction",serializer:function(a){return[a.unitId]}}}),w=p.MoveAction=h(t,{constructor:function(a,b,c){this.unitId=a,this.position=b,this.run=c},execute:function(a){this.unitById(a).move(a,this.position,this.run)},"static __SERMAT__":{identifier:"MoveAction",serializer:function(a){return[a.unitId,Array.apply(Array,a.position),a.run]}}}),x=p.ShootAction=h(t,{constructor:function(a,b){this.unitId=a,this.targetId=b},aleatories:function(a){var b=this.unitById(a),c=this.unitById(a,this.targetId),d=a.terrain.canShoot(b,c),e=0;b.models.forEach(function(a){a.equipments.forEach(function(a){a.range>=d&&(e+=a.attacks)})});var f=new C(b.quality,c.defense,e);return{wounds:f}},execute:function(a,b){var c=b.wounds,d=this.unitById(a,this.targetId);if(c>0){var e=d.worth();d.suffer(a,c),this.worth=e-d.worth()}this.unitById(a,this.unitId).endTurn(a)},"static __SERMAT__":{identifier:"ShootAction",serializer:function(a){return[a.unitId,a.targetId]}}}),y=p.AssaultAction=h(t,{constructor:function(a,b){this.unitId=a,this.targetId=b},aleatories:function(a){var b=this.unitById(a),c=this.unitById(a,this.targetId),d=a.terrain.canShoot(b,c),e=0;d<=12&&b.models.forEach(function(a){a.equipments.forEach(function(a){e+=a.attacks})});var f=new C(b.quality,c.defense,e),g=0;c.models.forEach(function(a){a.equipments.forEach(function(a){g+=a.attacks})});var h=new C(c.quality,b.defense,g);return{wounds:f,enemyWounds:h}},execute:function(a,b){var c=b.wounds,d=this.unitById(a,this.targetId),f=this.unitById(a,this.unitId);this.worth=0,c>0&&d.suffer(a,c),d.isDead(a)&&(this.worth+=d.cost()),this.worth+=d.cost()*c/d.size();var g=b.enemyWounds,h=d.livingModels().length;g=Math.round(h*g/d.size()),g>0&&f.suffer(a,g),f.isDead(a)&&(this.worth-=f.cost()),this.worth-=f.cost()*g/f.size();var i=e(f.position,d.position);this.unitById(a).move(a,i,!1),this.unitById(a,this.unitId).endTurn(a)},"static __SERMAT__":{identifier:"AssaultAction",serializer:function(a){return[a.unitId,a.targetId]}}}),z=b.math.combinations,A=p.rolls=function(a,b){return b<=0?[1]:l.range(b+1).map(function(c){return Math.pow(a,c)*Math.pow(1-a,b-c)*z(b,c)}).toArray()},B=p.rerolls=function(a,b){var c=l.repeat(0,b.length).toArray();return b.forEach(function(b,d){0===d?c[0]+=b:A(a,d).forEach(function(a,d){c[d]+=b*a})}),c},C=(p.addRolls=function(a,b){var c=a.length,d=b.length;return l.range(c+d-1).map(function(e){return l.range(e+1).filter(function(a){return a<c&&e-a<d},function(c){return a[c]*b[e-c]}).sum()}).toArray()},p.ShootAleatory=h(d.aleatories.Aleatory,{constructor:function(a,b,c){this.shooterQuality=0|a,this.targetDefense=0|b,this.attackCount=0|c,this.__hitProb__=Math.max(0,Math.min(1,(6-a+1)/6)),this.__saveProb__=Math.max(0,Math.min(1,(6-b+1)/6));var d=B(this.__saveProb__,A(this.__hitProb__,c));this.__distribution__=k(d).map(function(a,b){return[b,a]}).toArray()},distribution:function(){return k(this.__distribution__)},value:function(a){return(a||b.Randomness.DEFAULT).weightedChoice(this.__distribution__)},"static __SERMAT__":{identifier:"ShootAleatory",serializer:function(a){return[a.shooterQuality,a.targetDefense,a.attackCount]}}})),D=p.Wargame=h(d.Game,{name:"Wargame",players:["Red","Blue"],rounds:4,constructor:function(a){d.Game.call(this,a.activePlayer||this.players[0]),m(this,a).object("armies").object("terrain").integer("round",{coerce:!0,defaultValue:-1}).number("rounds",{coerce:!0,ignore:!0}).object("__activeUnit__",{ignore:!0}),this.round<0?this.nextRound():this.nextTurn()},nextTurn:function(){var a=this.activePlayer();if(!this.armies[a].isEnabled()){var b=(this.players.indexOf(a)+1)%this.players.length;this.activePlayers=[this.players[b]],b||this.nextRound()}return this},nextRound:function(){this.round++;var a=this.armies;for(var b in a)a[b].startRound();return this},scores:function(){return k(this.armies).mapApply(function(a,b){return[a,b.worth()]}).toObject()},result:function(){var a=this.players[0],b=this.players[1];if(this.armies[a].isEliminated(this)||this.armies[b].isEliminated(this)||this.round>=this.rounds){var c=this.scores();return this.zerosumResult(c[a]-c[b],a)}return null},synchronizeMetagame:function(){this.terrain.resetTerrain(this)},activeUnit:function(){return this.__activeUnit__},moves:function(){if(!this.result()){this.synchronizeMetagame();var a=this.activePlayer();return o(a,this.armies[a].actions(this))}return null},next:function(a,b,e){var f=this.activePlayer(),g=a[f];n(!g,"Active player ",f," has no actions!");var h=g.aleatories(this);if(n(!h&&b,"Unexpected haps! ",b),h&&!b)return new d.Contingent(this,a,h,e);var i=e?this:c.clone(this);return g.execute(i,b),i.nextTurn()},"static __SERMAT__":{serializer:function(a){var b={activePlayer:a.activePlayer(),armies:a.armies,terrain:a.terrain,round:a.round,rounds:a.rounds};return a.__activeUnit__&&(b.__activeUnit__=a.__activeUnit__),[b]}}}),E=p.Terrain=h({SURROUNDINGS:[{dx:-1,dy:-1,cost:Math.SQRT2},{dx:-1,dy:0,cost:1},{dx:-1,dy:1,cost:Math.SQRT2},{dx:0,dy:-1,cost:1},{dx:0,dy:1,cost:1},{dx:1,dy:-1,cost:Math.SQRT2},{dx:1,dy:0,cost:1},{dx:1,dy:1,cost:Math.SQRT2}],tileSet:[{passable:!0,visible:!0},{passable:!1,visible:!1}],map:["000000000000000000000001000000000000000000000000","000000000000000000000001000000000000000000000000","000000000000000000000001000000000000000000000000","000000000000000000000001000000000000000000000000","000000000000000000000000000000000000000000000000","000000000000000000000000000000000000000000000000","000000000000000000000000000000000000000000000000","000000000000000000000000000000000000000000000000","000000000000000000000000000000000000000000000000","000000000000000000000000000000000000000000000000","000000000000000000000000000000000000000000000000","000000000000000000000000000000000000000000000000","000000000000000000000000000000000000000000000000","000000000000000000000000000000000000000000000000","000000000000000000000000000000000000000000000000","000000000000000000000000000000000000000000000000","000000000000000000000000000000000000000000000000","000000000000000000000000000000000000000000000000","000000000000000000000000000000000000000000000000","000000000000000000000000000000000000000000000000","000000000000000000000000000000000000000000000000","000000000000000000000000000000000000000000000000","000000000000000000000000000000000000000000000000","111100000000000011110000000011110000000000001111","000000000000000000000000000000000000000000000000","000000000000000000000000000000000000000000000000","000000000000000000000000000000000000000000000000","000000000000000000000000000000000000000000000000","000000000000000000000000000000000000000000000000","000000000000000000000000000000000000000000000000","000000000000000000000000000000000000000000000000","000000000000000000000000000000000000000000000000","000000000000000000000000000000000000000000000000","000000000000000000000000000000000000000000000000","000000000000000000000000000000000000000000000000","000000000000000000000000000000000000000000000000","000000000000000000000000000000000000000000000000","000000000000000000000000000000000000000000000000","000000000000000000000000000000000000000000000000","000000000000000000000000000000000000000000000000","000000000000000000000000000000000000000000000000","000000000000000000000000000000000000000000000000","000000000000000000000000000000000000000000000000","000000000000000000000000000000000000000000000000","000000000000000000000001000000000000000000000000","000000000000000000000001000000000000000000000000","000000000000000000000001000000000000000000000000","000000000000000000000001000000000000000000000000"].map(function(a){return new Uint8Array(a.split(""))}),__unitsByPosition__:{},constructor:function(a){this.width=this.map.length,this.height=this.map[0].length},resetTerrain:function(a){this.__unitsByPosition__=this.unitsByPosition(a)},unitsByPosition:function(a){var b=a.armies,c={};for(var d in b)b[d].units.forEach(function(a){a.isDead()||(c[a.position]=a)});return c},tileAt:function(a){var b=this.map[a[0]]&&this.map[a[0]][a[1]];return this.tileSet[b]},isPassable:function(a,b){var c=this.tileAt(a);return!(!c||!c.passable||b&&this.__unitsByPosition__.hasOwnProperty(a))},isVisible:function(a,b){var c=this.tileAt(a);return!(!c||!c.visible||b&&this.__unitsByPosition__.hasOwnProperty(a))},distance:function(a,b){var c=Math.abs(a[0]-b[0]),d=Math.abs(a[1]-b[1]);return Math.sqrt(c*c+d*d)},reachablePositions:function(a,b){b=b||12;var c,d,e,f,g,h={},i=[a.position],j=(this.width,this.height,this.SURROUNDINGS);h[a.position]=0;for(var k=0;k<i.length;k++){c=i[k],e=h[c];for(var l=0;l<j.length;l++)g=j[l],f=e+g.cost,f>b||(d=[c[0]+g.dx,c[1]+g.dy],!h.hasOwnProperty(d)&&this.isPassable(d,!0)&&(h[d]=f,i.push(d)))}return h},canReach:function(a,b,c){c=c||12;var d,e,f,g,h,i=a.position,j={},k=[a.position],l=(this.width,this.height,this.SURROUNDINGS);j[i]=0,heuristic[i]=this.distance(i,b);for(var m=0;m<k.length;m++){if(d=k[m],d[0]===b[0]&&d[1]===b[1])return!0;f=j[d];for(var n=0;n<l.length;n++)h=l[n],g=f+h.cost,g>c||(e=[d[0]+h.dx,d[1]+h.dy],!j.hasOwnProperty(e)&&this.isPassable(e,!0)&&(j[e]=g,heuristic[e]=this.distance(e,b),k.push(e)));k.sort(function(a,b){return j[a]+heuristic[a]-(j[b]+heuristic[b])})}return!1},"dual bresenham":function(a,b,c){c=c||1/0;for(var d,e=[],f=Math.abs(b[0]-a[0]),g=Math.abs(b[1]-a[1]),h=a[0]<b[0]?1:-1,i=a[1]<b[1]?1:-1,j=a.slice(),k=f-g;c--&&(e.push(j.slice()),j[0]!==b[0]||j[1]!==b[1]);)d=2*k,d>-g&&(k-=g,j[0]+=h),d<f&&(k+=f,j[1]+=i);return e},canShoot:function(a,b){if(a.army===b.army)return 1/0;var c=this.distance(a.position,b.position);if(c>a.maxRange())return 1/0;for(var d,e=this.bresenham(a.position,b.position,c),f=0;f<e.length;f++)if(d=e[f],!this.isVisible(d)||this.__unitsByPosition__[d]&&this.__unitsByPosition__[d].id!==a.id&&this.__unitsByPosition__[d].id!==b.id)return 1/0;return c},areaOfSight:function(a,b){b=b||1/0;var c=a.position,d=this,e={};return k(this.BRESENHAM_CACHE).forEachApply(function(a,f){for(var g,h=1;h<f.length&&h<=b&&(g=f[h],g=[c[0]+g[0],c[1]+g[1]],d.isVisible(g))&&(e[g]=h,!d.__unitsByPosition__[g]);h++);}),e},"static __SERMAT__":{serializer:function(a){return[]}}});E.BRESENHAM_CACHE=E.prototype.BRESENHAM_CACHE=function(a){for(var b={radius:a},c=-a;c<=a;c++)b[[c,-a]]=E.bresenham([0,0],[c,-a]),b[[c,+a]]=E.bresenham([0,0],[c,+a]),c!==-a&&c!==a&&(b[[-a,c]]=E.bresenham([0,0],[-a,c]),b[[+a,c]]=E.bresenham([0,0],[+a,c]));return b}(50);p.InfluenceMap=h({momentum:.67,decay:.3,iterations:30,constructor:function(a,b){this.width=a.terrain.width,this.height=a.terrain.height,this.grid=this.matrix(this.width),this.terrain=a.terrain,this.role=b},matrix:function(a){return Array(a).fill(0).map(function(b){return Array(a).fill(0).map(function(a){return 0})})},update:function(a){var b=this.grid;this.unitsInfluences(a);for(var c=0;c<this.iterations;c++)b=this.spread(b);return b},unitsInfluences:function(a){var b,c,d,e=this,f=this.grid;for(var g in a.armies)b=g===this.role?1:-1,a.armies[g].units.forEach(function(a){a.isDead()||(c=0|a.position[0],d=0|a.position[1],f[c]?f[c][d]||(f[c][d]=0):(f[c]=[],f[c][d]=0),f[c][d]=e.influence(a)*b)})},influence:function(a){return a.worth()},getMomentumInf:function(a,b,c,d){var e,f,g,h,i,j=0;for(f=-1;f<2;f++)for(g=-1;g<2;g++)(0!==f||0!==g)&&a[b+f]&&(e=a[b+f][c+g])&&(e*=d[f*f+g*g],h=j<0?-j:j,i=e<0?-e:e,h<i&&(j=e));return j},spread:function(a){for(var b,c,d=this.decay,e=[NaN,Math.exp(-1*d),Math.exp(-Math.SQRT2*d)],f=this.momentum,g=[],h=this.terrain,i=0;i<a.length;i++)for(var j=0;j<a[i].length;j++)b=a[i][j],1===h.map[i][j]?(g[i]=g[i]?g[i]:[],g[i][j]="t"):(c=this.getMomentumInf(a,i,j,e),g[i]=g[i]?g[i]:[],g[i][j]=b*(1-f)+c*f);return g}});p.test={example0:function(){var a=new E,b=F.BattleBrothers,c=new D({terrain:a,armies:{Red:new F.BattleBrothers({player:"Red",units:[[3,10]].map(function(a){return new b.UNITS.BattleBrothers_Unit({position:a})})}),Blue:new F.BattleBrothers({player:"Blue",units:[[40,10],[40,20],[40,15],[40,2]].map(function(a){return new b.UNITS.BattleBrothers_Unit({position:a})})})}});return c},example1:function(){var a=new E,b=F.BattleBrothers,c=new D({terrain:a,armies:{Red:new F.BattleBrothers({player:"Red",units:[[3,10],[3,20],[4,15],[3,2]].map(function(a){return new b.UNITS.BattleBrothers_Unit({position:a})})}),Blue:new F.BattleBrothers({player:"Blue",units:[[40,10],[40,20],[40,15],[40,2]].map(function(a){return new b.UNITS.BattleBrothers_Unit({position:a})})})}});return c},example2:function(){var a=new E,b=F.BattleBrothers,c=new D({terrain:a,armies:{Red:new F.BattleBrothers({player:"Red",units:[new b.UNITS.BattleBrothers_Unit({position:[12,4],models:Array.apply(null,{length:5}).map(function(){return new b.MODELS.BattleBrother})}),new b.UNITS.AssaultBrothers_Unit({position:[12,6],models:Array.apply(null,{length:5}).map(function(){return new b.MODELS.AssaultBrother})}),new b.UNITS.Engineers_Unit({position:[12,8],models:[new b.MODELS.Engineer]}),new b.UNITS.SupportBikers_Unit({position:[2,7],models:[new b.MODELS.SupportBiker]}),new b.UNITS.NuevoFastAttacks_Unit({position:[12,10],models:Array.apply(null,{length:5}).map(function(){return new b.MODELS.NuevoFastAttack})}),new b.UNITS.NuevoMelees_Unit({position:[12,12],models:Array.apply(null,{length:3}).map(function(){return new b.MODELS.NuevoMelee})})]}),Blue:new F.BattleBrothers({player:"Blue",units:[new b.UNITS.BattleBrothers_Unit({position:[36,4],models:Array.apply(null,{length:5}).map(function(){return new b.MODELS.BattleBrother})}),new b.UNITS.AssaultBrothers_Unit({position:[36,6],models:Array.apply(null,{length:5}).map(function(){return new b.MODELS.AssaultBrother})}),new b.UNITS.Engineers_Unit({position:[36,8],models:[new b.MODELS.Engineer]}),new b.UNITS.SupportBikers_Unit({position:[46,7],models:[new b.MODELS.SupportBiker]}),new b.UNITS.NuevoFastAttacks_Unit({position:[36,10],models:Array.apply(null,{length:5}).map(function(){return new b.MODELS.NuevoFastAttack})}),new b.UNITS.NuevoMelees_Unit({position:[36,12],models:Array.apply(null,{length:3}).map(function(){return new b.MODELS.NuevoMelee})})]})}});return c},exampleAssault:function(){var a=new E,b=F.BattleBrothers,c=new D({terrain:a,armies:{Red:new F.BattleBrothers({player:"Red",units:[[3,10],[3,20],[4,15],[3,2]].map(function(a){return new b.UNITS.BattleBrothers_Unit({position:a})})}),Blue:new F.BattleBrothers({player:"Blue",units:[[4,10],[4,20],[5,15],[4,2]].map(function(a){return new b.UNITS.BattleBrothers_Unit({position:a})})})}});return c},randomGame:function(){var a=d.players.RandomPlayer,b=[new a,new a];window.match=new d.Match(this.example1(),b),match.events.on("begin",function(a,b){window.RENDERER.render(a)}),match.events.on("move",function(a,b,d){console.log(c.ser(b))}),match.events.on("next",function(a,b,c){b instanceof D&&window.RENDERER.render(b)}),match.run().then(function(a){console.log(a.result())})},randomAbstractedGame:function(){var a=[new d.players.RandomPlayer,new d.players.RandomPlayer],b=new O(this.example1());window.match=new d.Match(b,a),match.events.on("begin",function(a,b){a.concreteGame.terrain;window.RENDERER.render(a.concreteGame)}),match.events.on("move",function(a,b,d){console.log(c.ser(b))}),match.events.on("next",function(a,b,c){b.concreteGame.terrain;window.RENDERER.render(b.concreteGame)}),match.run().then(function(a){console.log("randomAbstractedGame"),console.log(a.result())})},randomAbstractedGameDiscrete:function(){var a=[new d.players.MonteCarloPlayer({simulationCount:100,timeCap:2e4}),new d.players.RandomPlayer],b=new O(this.example1());window.match=new d.Match(b,a),match.events.on("begin",function(a,b){a.concreteGame.terrain;window.RENDERER.render(a.concreteGame)}),match.events.on("move",function(a,b,d){console.log(c.ser(b))}),match.events.on("next",function(a,b,c){b.concreteGame.terrain;window.RENDERER.render(b.concreteGame)}),match.run().then(function(a){console.log("randomAbstractedGameDiscrete"),console.log(a.result())})},testGame:function(a,b){var e=d.players.RandomPlayer,f=[a||new e,b||new e];window.match=new d.Match(this.example1(),f),match.events.on("begin",function(a,b){window.RENDERER.render(a)}),match.events.on("move",function(a,b,d){console.log(c.ser(b)),window.RENDERER.renderSight(a)}),match.events.on("next",function(a,b,c){b instanceof D&&window.RENDERER.render(b)}),match.run().then(function(a){console.log(a.result())})},conPesosDS_vs_sinPesosDS:function(){var a=[new H,new I];window.match=new d.Match(this.example2(),a),match.events.on("begin",function(a,b){window.RENDERER.render(a)}),match.events.on("move",function(a,b,d){console.log(c.ser(b)),window.RENDERER.renderSight(a)}),match.events.on("next",function(a,b,c){b instanceof D&&window.RENDERER.render(b)}),match.run().then(function(a){console.log(a.result())})},sinPesosDS_vs_conPesosDS:function(){var a=[new I,new H];window.match=new d.Match(this.example2(),a),match.events.on("begin",function(a,b){window.RENDERER.render(a)}),match.events.on("move",function(a,b,d){console.log(c.ser(b)),window.RENDERER.renderSight(a)}),match.events.on("next",function(a,b,c){b instanceof D&&window.RENDERER.render(b)}),match.run().then(function(a){console.log(a.result())})},conPesosDS_vs_random:function(){var a=d.players.RandomPlayer,b=[new H,new a];window.match=new d.Match(this.example2(),b),match.events.on("begin",function(a,b){window.RENDERER.render(a)}),match.events.on("move",function(a,b,c){window.RENDERER.renderSight(a)}),match.events.on("next",function(a,b,c){b instanceof D&&window.RENDERER.render(b)}),match.run().then(function(a){console.log(a.result())})},sinPesosDS_vs_random:function(){var a=d.players.RandomPlayer,b=[new I,new a];window.match=new d.Match(this.exampleAssault(),b),match.events.on("begin",function(a,b){window.RENDERER.render(a)}),match.events.on("move",function(a,b,d){console.log(c.ser(b)),window.RENDERER.renderSight(a)}),match.events.on("next",function(a,b,c){b instanceof D&&window.RENDERER.render(b)}),match.run().then(function(a){console.log(a.result())})},conPesosDS_vs_random_Abstracted:function(){var a=d.players.RandomPlayer,b=[new H,new a],e=new O(this.example2());window.match=new d.Match(e,b),match.events.on("begin",function(a,b){a.concreteGame.terrain;window.RENDERER.render(a.concreteGame)}),match.events.on("move",function(a,b,d){console.log(c.ser(b))}),match.events.on("next",function(a,b,c){b.concreteGame.terrain;window.RENDERER.render(b.concreteGame)}),match.run().then(function(a){console.log("conPesosDS_vs_random_Abstracted"),console.log(a.result())})},conPesosDS_vs_BasicRulePlayer_shoot:function(){var a=[new H,new J];window.match=new d.Match(this.example2(),a),match.events.on("begin",function(a,b){window.RENDERER.render(a)}),match.events.on("move",function(a,b,d){console.log(c.ser(b)),window.RENDERER.renderSight(a)}),match.events.on("next",function(a,b,c){b instanceof D&&window.RENDERER.render(b)}),match.run().then(function(a){console.log(a.result())})},conPesosDS_vs_BasicRulePlayer_assault:function(){var a=[new H,new K];window.match=new d.Match(this.example2(),a),match.events.on("begin",function(a,b){window.RENDERER.render(a)}),match.events.on("move",function(a,b,d){console.log(c.ser(b)),window.RENDERER.renderSight(a)}),match.events.on("next",function(a,b,c){b instanceof D&&window.RENDERER.render(b)}),match.run().then(function(a){console.log(a.result())})},conPesosDS_vs_BasicRulePlayer_assist:function(){var a=[new H,new L];window.match=new d.Match(this.example2(),a),match.events.on("begin",function(a,b){window.RENDERER.render(a)}),match.events.on("move",function(a,b,d){console.log(c.ser(b)),window.RENDERER.renderSight(a)}),match.events.on("next",function(a,b,c){b instanceof D&&window.RENDERER.render(b)}),match.run().then(function(a){console.log(a.result())})},conPesosDS_vs_BasicRulePlayer_scape_then_shoot:function(){var a=[new H,new M];window.match=new d.Match(this.example2(),a),match.events.on("begin",function(a,b){window.RENDERER.render(a)}),match.events.on("move",function(a,b,d){console.log(c.ser(b)),window.RENDERER.renderSight(a)}),match.events.on("next",function(a,b,c){b instanceof D&&window.RENDERER.render(b)}),match.run().then(function(a){console.log(a.result())})},randomAbstractedTest:function(a,b){var e=d.players.RandomPlayer,f=[a||new e,b||new e];game=new O(this.example1()),window.match=new d.Match(game,f),match.events.on("begin",function(a,b){a.concreteGame.terrain;window.RENDERER.render(a.concreteGame)}),match.events.on("move",function(a,b,d){console.log(c.ser(b))}),match.events.on("next",function(a,b,c){b.concreteGame.terrain;window.RENDERER.render(b.concreteGame)}),match.run().then(function(a){console.log("randomAbstractedGame"),console.log(a.result())})}};var F=p.GrimFuture=function(){var a={},b={LightClaws:{range:0,attacks:1},CClaws:{range:0,attacks:2},Pistol:{range:12,attacks:1},AssaultRifle:{range:24,attacks:1},HeavyFlamethrower:{range:12,attacks:6,ap:1},EnergyFist:{range:0,attacks:2,ap:4},LinkedAssaultRifle:{range:24,attacks:1},HeavyMachinegun:{range:36,attacks:3,ap:1}},c={BattleBrother:h(s,{cost:22,equipments:[b.AssaultRifle,b.LightClaws],constructor:function(a){s.call(this,a)}}),AssaultBrother:h(s,{cost:22,equipments:[b.Pistol,b.CClaws],constructor:function(a){s.call(this,a)}}),SupportBrother:h(s,{cost:50,equipments:[b.HeavyFlamethrower,b.LightClaws],constructor:function(a){s.call(this,a)}}),Engineer:h(s,{cost:140,equipments:[b.Pistol,b.EnergyFist],constructor:function(a){s.call(this,a)}}),SupportBiker:h(s,{cost:100,equipments:[b.LinkedAssaultRifle,b.HeavyMachinegun,b.LightClaws],constructor:function(a){s.call(this,a)}}),NuevoFastAttack:h(s,{cost:30,equipments:[b.AssaultRifle,b.LightClaws],constructor:function(a){s.call(this,a)}}),NuevoMelee:h(s,{cost:20,equipments:[b.LightClaws],constructor:function(a){s.call(this,a)}})},d={BattleBrothers_Unit:h(r,{quality:3,defense:6,fearless:!0,constructor:function(a){a=a||{},a.models||(a.models=l.range(5).map(function(){return new c.BattleBrother}).toArray()),r.call(this,a)}}),AssaultBrothers_Unit:h(r,{quality:3,defense:6,fearless:!0,constructor:function(a){a=a||{},a.models||(a.models=l.range(5).map(function(){return new c.AssaultBrother}).toArray()),r.call(this,a)}}),SupportBrothers_Unit:h(r,{quality:3,defense:6,fearless:!0,constructor:function(a){a=a||{},a.models||(a.models=l.range(5).map(function(){return new c.SupportBrother}).toArray()),r.call(this,a)}}),Engineers_Unit:h(r,{quality:3,defense:7,constructor:function(a){a=a||{},a.models||(a.models=l.range(1).map(function(){return new c.Engineer}).toArray()),r.call(this,a)}}),SupportBikers_Unit:h(r,{quality:3,defense:6,constructor:function(a){a=a||{},a.models||(a.models=l.range(1).map(function(){return new c.SupportBiker}).toArray()),r.call(this,a)}}),NuevoFastAttacks_Unit:h(r,{quality:4,defense:3,constructor:function(a){a=a||{},a.models||(a.models=l.range(5).map(function(){return new c.NuevoFastAttack}).toArray()),r.call(this,a)}}),NuevoMelees_Unit:h(r,{quality:3,defense:6,constructor:function(a){a=a||{},a.models||(a.models=l.range(3).map(function(){return new c.NuevoMelee}).toArray()),r.call(this,a)}})};a.BattleBrothers=h(q,{faction:"BattleBrothers","static MODELS":c,"static UNITS":d,constructor:function(a){q.call(this,a)}});return a}(),G=[],H=p.DynamicScriptingPlayer=h(d.Player,{constructor:function(a){d.Player.call(this,a),m(this,a).array("rules",{defaultValue:[]}),this.__pendingActions__=[],this.rules=this.ownRules(),this.sortRules(),this.roundActions=[],this.playerPossibleUnits=[],this.playerShootableUnits=[],this.playerAssaultableUnits=[]},ownRules:function(){var a=this;return Object.keys(Object.getPrototypeOf(this)).map(function(b){return[a[b],1]}).filter(function(a){var b=a[0];return"function"==typeof b&&b.name&&"rule"===b.name.substr(0,4)})},sortRules:function(){this.rules.sort(function(a,b){return b[0].priority-a[0].priority||b[1]-a[1]})},sortRuleListByWeight:function(a){a.length>0&&a.sort(function(a,b){return b[1]-a[1]})},firstRules:function(a,b,c){for(var d,e,f=[],g=0,h=this.rules.length;g<h;g++)this.rules[g][0].priority==c&&(d=this.rules[g],e=d[0].call(this,a,b),e&&f.push(d));return this.sortRuleListByWeight(f),f},decision:function(a,b){a.synchronizeMetagame(),this.playerPossibleUnits=this.possibleUnits(a,b),this.playerShootableUnits=this.allShootableUnits(a,b),this.playerAssaultableUnits=this.allAssaultableUnits(a,b);for(var c,d,e=this.armiesAndUnits(a,b),f=e[1],g=0,h=0;h<f.length;h++)(f[h].isEnabled||f[h].isActive)&&(g+=1);var i=0;g===f.length&&(i=this.gameWorth(a,b));var j=this.roundActions;if(this.__pendingActions__.length<1)for(var k=12;k>0;){var l=this.firstRules(a,b,k);if(l.length>0){for(var m=0,o=0;o<l.length;o++){var p=l[o];m+=p[1]}if(m>l.length)for(var q=0,r=0,s=Math.random(),t=0;t<l.length;t++)q=l[t][1]/m,r+=q,s<=r&&(c=l[t],d=c[0].call(this,a,b));else c=l[Math.floor(Math.random()*l.length)],d=c[0].call(this,a,b);if(d){d.forEach(function(a){a.__rule__=c}),this.__pendingActions__=this.__pendingActions__.concat(d),j=j.concat(d),this.roundActions=j,G=G.concat(d);for(var u=0,v=0;v<f.length;v++)f[v].isEnabled&&!f[v].isActive||(u+=1);return this.__pendingActions__.shift()}}else k-=1}return n(this.__pendingActions__.length<1,"No rule applied to game!"),this.__pendingActions__.shift()},participate:function(a,b){return this.attachToMatch(a.state(),a),this},attachToMatch:function(a,b){var c=this,d=0,e=a;b.events.on("next",function(a,b,f){!b.isContingent&&b.round>d&&!a.isContingent&&(c.adjustWeights(a,a.players[0],G,e),d=b.round,G=[],e=a)})},adjustWeights:function(a,b,c,d){var e=this.rules;for(h=0;h<e.length;h++)e[h][1]<0&&(e[h][1]=e[h][1]*-1),isNaN(e[h][1])&&n(isNaN(e[h][1]),"rules[reg][1]");var f=[];c.forEach(function(a){f.indexOf(a.__rule__)<0&&f.push(a.__rule__)});var h,i,j=this.gameWorth(d,b),k=(this.gameWorth(a,b)-j)/10;if(k<0)for(h=0;h<e.length;h++)f.indexOf(e[h])<0&&(e[h][1]+=k*-1);else for(h=0;h<e.length;h++)f.indexOf(e[h])>=0&&(e[h][1]+=k);for(var l=0;l<c.length;l++){var m=c[l];i=m.__rule__[0].name,m.__rule__[1]||(m.__rule__[1]=1);var o=0;for(o=g(m.worth)?m.worth()/10:m.worth/10,h=0;h<this.rules.length;h++)o<0?this.rules[h][0].name!=i&&(this.rules[h][1]+=o*-1):this.rules[h][0].name==i&&(this.rules[h][1]+=o)}},gameWorth:function(a,b){var c=0,d=0,e=0,f=this.armiesAndUnits(a,b),g=f[1],h=f[3];return h.forEach(function(a){d=a.cost(),a.isDead()&&(c+=d),e=a.size()-a.livingModels().length,c+=d*e/a.size()}),g.forEach(function(a){d=a.cost(),a.isDead()&&(c-=d),e=a.size()-a.livingModels().length,c-=d*e/a.size()}),c},"static __SERMAT__":{identifier:"DynamicScriptingPlayer",serializer:function(a){return this.serializeAsProperties(a,["name","rules"])}},shoot:function(a,b){return[new u(a.id),new x(a.id,b.id)]},assault:function(a,b){return[new u(a.id),new y(a.id,b.id)]},move:function(a,b,c){return c?[new u(a.id),b,new x(a.id,c.id)]:[new u(a.id),b,new v(a.id)]},scapeAux:function(a,b,c,d){
for(var e=0;e<c.length;e++){var f=c[e],g=[];if(this.canHide(a,d,f)){for(var h=this.hideMoves(a,d,f),i=0;i<h.length;i++)if(a.terrain.distance(f.position,h[i].position)<=f.maxRange()+6)return this.move(d,h[i]);g=g.concat(h)}if(this.canRun(a,d,f)){for(var j=this.runMoves(a,d,f),k=0;k<j.length;k++)if(a.terrain.distance(f.position,j[k].position)<=f.maxRange()+6)return this.move(d,j[k]);g=g.concat(j)}if(g.length>0)return this.move(d,g[Math.floor(Math.random()*g.length)])}},scape:function(a,b,c){var d=this.mostDangerousUnits(a,b,c),e=this.scapeAux(a,b,d,c);if(e)return e;var f=(this.dangerousUnits(a,b,c),this.scapeAux(a,b,d,c));if(f)return f;var g=c.getMoveActions(a),h=this.move(c,g[Math.floor(Math.random()*g.length)]);return h},assistAux:function(a,b,c,d,e){for(var f=0;f<c.length;f++){var g=c[f];if(this.canAssault(a,d,g))return this.assault(d,g);var h;if(this.canBlockSight(a,d,e,g)){var i=this.blockSightMovements(a,d,e,g);h=i[Math.floor(Math.random()*i.length)]}if(this.canShoot_(a,d,g,!0))return h?this.move(d,h,g):this.shoot(d,g);if(h)return this.move(d,h)}return null},assist:function(a,b,c,d){var e=this.mostDangerousUnits(a,b,d),f=this.assistAux(a,b,e,c,d);if(f)return f;var g=this.dangerousUnits(a,b,d),h=this.assistAux(a,b,g,c,d);if(h)return h;var i=c.getMoveActions(a),j=this.move(c,i[Math.floor(Math.random()*i.length)]);return j},getFewMoveActions:function(a,b){var c=[],d=b.position[0],e=b.position[1];return c.push(new w(b.id,[d+1,e+1],(!1))),c},getCloseTo:function(a,b,c){for(var d=this.interpolation(b.position,c.position),e=b.getMoveActions(a),f=[],g=0;g<e.length;g++){var h=e[g].position;d.forEach(function(a){h[0]===a[0]&&h[1]===a[1]&&f.push(e[g])})}for(var i=b.position,j=e[Math.floor(Math.random()*e.length)],k=0;k<f.length;k++){var l=f[k].position;a.terrain.distance(l,c.position)<a.terrain.distance(i,c.position)&&(i=l,j=f[k])}var m=this.move(b,j);return m},possibleUnits:function P(a,b){var c=this.armiesAndUnits(a,b)[1],P=[];return c.forEach(function(a){a.isDead()||!a.isEnabled||a.isActive||P.push(a)}),P},shootableUnitsAux:function(a,b,c){var d=[],e=this.livingEnemyUnits(a,b),f=c.getShootActions(a);return f.forEach(function(a){e.forEach(function(b){a.targetId===b.id&&d.push(b)})}),d},allShootableUnits:function Q(a,b){for(var Q=[],c=this.playerPossibleUnits,d=0;d<c.length;d++){var e=c[d],f=[];f=this.shootableUnitsAux(a,b,e),Q[d]=[e,f]}return Q},enemyShootableUnits:function R(a,b,c){for(var R=[],d=0;d<this.playerShootableUnits.length;d++)this.playerShootableUnits[d][0]==c&&(R=this.playerShootableUnits[d][1]);return R},assaultableUnits:function S(a,b,c){var S=[],d=this.livingEnemyUnits(a,b),e=c.getAssaultActions(a);return e.forEach(function(a){d.forEach(function(b){a.targetId===b.id&&S.push(b)})}),S},allAssaultableUnits:function T(a,b){for(var T=[],c=this.playerPossibleUnits,d=0;d<c.length;d++){var e=c[d],f=[];f=this.assaultableUnits(a,b,e),T[d]=[e,f]}return T},enemyAssaultableUnits:function U(a,b,c){for(var U=[],d=0;d<this.playerAssaultableUnits.length;d++)this.playerAssaultableUnits[d][0]==c&&(U=this.playerAssaultableUnits[d][1]);return U},canShoot_:function(a,b,c,d){return!(b.isDead()||!b.isEnabled||c.isDead()||a.terrain.canShoot(b,c)==1/0)},canAssault:function(a,b,c){return!(b.isDead()||!b.isEnabled||c.isDead()||!(a.terrain.canShoot(b,c)<=12))},interForX:function(a,b,c,d){for(var e=[],f=c,g=a+1;g<b;g++)e.push([parseInt(g),parseInt(f)]),f+=d;return e},interForY:function(a,b,c,d){for(var e=[],f=c,g=a+1;g<b;g++)e.push([parseInt(f),parseInt(g)]),f+=d;return e},interpolation:function(a,b){var c,d,e=0,f=a[0],g=b[0],h=a[1],i=b[1],j=Math.min(f,g),k=Math.max(f,g),l=Math.min(h,i),m=Math.max(h,i);d=j===f?h:i,c=l===h?f:g;var n,o;return h===i?n=this.interForX(j,k,d,e):f===g?o=this.interForY(l,m,c,e):Math.abs(i-h)>=Math.abs(g-f)?(e=Math.abs(g-f)/Math.abs(i-h),o=this.interForY(l,m,c,e)):(e=Math.abs(i-h)/Math.abs(g-f),n=this.interForX(j,k,d,e))},blockSightMovements:function(a,b,c,d){for(var e=c.position,f=d.position,g=this.interpolation(e,f),h=[],i=b.getMoveActions(a),j=0;j<i.length;j++){var k=i[j].position;g.forEach(function(a){k[0]===a[0]&&k[1]===a[1]&&h.push(i[j])})}return h},canBlockSight:function(a,b,c,d){return this.blockSightMovements(a,b,c,d).length>0},canAssist:function V(a,b,c,d){for(var e=this.dangerousUnits(a,b,d),V=!1,f=0;f<e.length;f++){var g=e[f];if(!(this.canBlockSight(a,c,d,g)||this.canShoot_(a,c,g,!0)||this.canAssault(a,c,g))){V=!1;break}V=!0}return V},canRun:function(a,b,c){var d=c.maxRange()+6;return!(b.isEnabled&&a.terrain.canShoot(c,b)<=d)},canHide:function(a,b,c){return!1},runMoves:function(a,b,c){for(var d=c.position,e=b.position,f=b.getMoveActions(a),g=f[Math.floor(Math.random()*f.length)],h=0;h<f.length;h++){var i=f[h].position;a.terrain.distance(i,d)>a.terrain.distance(e,d)&&(e=i,g=f[h])}return a.terrain.distance(c.position,e)<=c.maxRange()+6?[g]:[g]},hideMoves:function(a,b,c){return[]},canScape:function W(a,b,c){var d=this.mostDangerousUnits(a,b,c);if(0===d.length)return!1;for(var W=!0,e=0;e<d.length;e++){var f=d[e];this.canRun(a,c,f)||this.canHide(a,c,f)||(W=!1)}return W},mostDangerousUnits:function(a,b,c){for(var d=this.livingEnemyUnits(a,b),e=[],f=0;f<d.length;f++){var g=d[f];this.canKill(a,g,c)&&e.push(g)}return e},dangerousUnits:function(a,b,c){for(var d=this.livingEnemyUnits(a,b),e=[],f=0;f<d.length;f++){var g=d[f];(this.canShoot_(a,g,c,!0)||this.canAssault(a,g,c))&&e.push(g)}return e},canBeKilled:function(a,b,c){for(var d=this.armiesAndUnits(a,b)[3],e=0;e<d.length;e++)if(this.canKill(a,d[e],c))return!0;return!1},canKill:function(a,b,c){return!(b.isDead()||!b.isEnabled||c.isDead()||!this.canKillShooting(a,b,c)&&!this.canKillAssaulting(a,b,c))},canKillShooting:function(a,b,c){return!(b.isDead()||c.isDead()||!b.isEnabled||!(this.bestAttackResultShooting(a,b,c)>=100))},canKillAssaulting:function(a,b,c){return!(b.isDead()||c.isDead()||!b.isEnabled||!(this.bestAttackResultAssaulting(a,b,c)>=100))},bestAttackResult:function X(a,b,c){if(!b.isDead()&&b.isEnabled&&!c.isDead()){var d=this.bestAttackResultShooting(a,b,c),e=this.bestAttackResultAssaulting(a,b,c),X=Math.max(d,e);return X}return 0},bestAttackResultShooting:function(a,b,c){if(!b.isDead()&&b.isEnabled&&!c.isDead()){var d=a.terrain.distance(b.position,c.position),e=b.livingModels(),f=0;e.forEach(function(a){a.equipments.forEach(function(a){a.range>=d&&(f+=a.attacks)})});var g=c.livingModels().length,h=100*f/g;return h>100&&(h=100),h}return 0},bestAttackResultAssaulting:function(a,b,c){if(!b.isDead()&&b.isEnabled&&!c.isDead()&&this.canAssault(a,b,c)){var d=0,e=b.livingModels();e.forEach(function(a){a.equipments.forEach(function(a){0===a.range&&(d+=a.attacks)})});var f=c.livingModels().length,g=100*d/f;return g>100&&(g=100),g}return 0},shootingKillableUnits:function Y(a,b,c){for(var Y=[],d=this.shootableUnitsAux(a,b,c),e=0;e<d.length;e++){var f=d[e];this.willKillShooting(a,c,f)&&Y.push(f)}return Y},livingEnemyUnits:function(a,b){var c=this.armiesAndUnits(a,b)[2];return c.livingUnits()},armiesAndUnits:function(a,b){var c=a.armies[b],d=c.units,e=a.opponent(b),f=a.armies[e],g=f.units;return[c,d,f,g]},wounded:function(a){return a.livingModels().length<a.size()},canWoundALot:function(a,b,c){return!(b.isDead()||!b.isEnabled||c.isDead())&&this.bestAttackResult(a,b,c)>=75},canWound:function(a,b,c){return!(b.isDead()||!b.isEnabled||c.isDead())&&this.bestAttackResult(a,b,c)>0},maxCost:function(a){return k(a).map(function(a){a.cost()}).max(0)},mostExpensiveUnit:function(a){for(var b,c=0,d=0;d<a.length;d++)a[d].cost()>c&&(b=a[d],c=b.cost());return b},cheapestUnit:function(a){for(var b,c=0,d=0;d<a.length;d++)a[d].cost()>c&&(b=a[d],c=b.cost());return b},unitForce:function(a){var b=a.livingModels(),c=0;b.forEach(function(a){a.equipments.forEach(function(a){c+=a.attacks})});var d=a.quality*c+a.defense/2+a.cost()/10;return d},unitIsStrongest:function(a,b){for(var c,d=0,e=0;e<a.length;e++)this.unitForce(a[e])>d&&(c=a[e],d=this.unitForce(c));return this.unitForce(b)===d},classification:function(a){return a.quality>=4&&a.defense<=3?"fastAttack":a.defense>=7?"heavySupport":a.size()>=5&&a.cost()<=130?"troop":a.maxRange()>=36?"sniper":""},maxRangeInUnits:function(a,b){var c=k(a).map(function(a){return a.maxRange()}).max(0);return b.maxRange()===c},easiestToKill:function(a,b){var c=k(a).map(function(a){return a.livingModels().length*a.defense}).max(0);return b.livingModels().length*b.defense===c},expectedResultShooting:function(a,b,c){if(this.canShoot_(a,b,c,!0)){var d=a.terrain.distance(b.position,c.position),e=b.livingModels(),f=0;e.forEach(function(a){a.equipments.forEach(function(a){a.range>=d&&(f+=a.attacks)})});for(var g=0,h=0,i=0;i<f;i++)g=Math.floor(3+4*Math.random()),b.quality>g&&(h+=1);for(var j=0,k=0;k<h;k++)g=Math.floor(1+6*Math.random()),c.defense>g&&(j+=1);var l=h-j,m=c.livingModels().length,n=100*l/m;return n>100&&(n=100),n}return 0},expectedResultAssaulting:function(a,b,c){return 0},willKillShooting:function(a,b,c){return 100===this.expectedResultShooting(a,b,c)},willWoundALotShooting:function(a,b,c){return this.expectedResultShooting(a,b,c)>75},willWoundHalfShooting:function(a,b,c){return this.expectedResultShooting(a,b,c)>=50},willWoundShooting:function(a,b,c){return this.expectedResultShooting(a,b,c)>0},willKillAssaulting:function(a,b,c){return 100===this.expectedResultAssaulting(a,b,c)},willWoundALotAssaulting:function(a,b,c){return this.expectedResultAssaulting(a,b,c)>75},willWoundHalfAssaulting:function(a,b,c){return this.expectedResultAssaulting(a,b,c)>=50},willWoundAssaulting:function(a,b,c){return this.expectedResultAssaulting(a,b,c)>0},winning:function(a){var b=a.activePlayer(),c=a.players[0];return b===a.players[0]&&(c=a.players[1]),a.scores(b)>a.scores(c)},losingGameByUnitElimination:function(a,b){var c=a.activePlayer(),d=a.players[0];return c===a.players[0]&&(d=a.players[1]),a.scores(c)-b.cost()<a.scores(d)},winningActivation:function(a,b){if(4===a.round){var c=a.activePlayer(),d=a.players[0];c===a.players[0]&&(d=a.players[1]);var e=[],f=this.livingEnemyUnits(a,b);f.forEach(function(b){a.scores(c)>a.scores(d)-b.cost()&&e.push(b)});var g=this.possibleUnits(a,b);for(i=0;i<g.length;i++){var h=g[i];for(j=0;j<e.length;j++){var k=e[j];if(this.canKill(a,h,k)||this.canPin(a,h,k))return!0}}}return!1},canPin:function(a,b,c){if(this.canAssault(a,b,c)){var d=0,e=b.livingModels();if(e.forEach(function(a){a.equipments.forEach(function(a){0===a.range&&(d+=a.attacks)})}),d>=c.size()/2)return!0}return!1},isMelee:function(a){var b=0,c=0,d=a.livingModels();return d.forEach(function(a){a.equipments.forEach(function(a){a.range>=b&&(b=a.range,c=a.attacks)})}),0===b||(d.forEach(function(a){a.equipments.forEach(function(a){if(0===a.range&&a.attacks>c)return!0})}),!1)},rule_12A:f(12,function(a,b){if(3===a.round&&!this.winning(a))for(var c=this.playerPossibleUnits,d=this.armiesAndUnits(a,b)[1],e=this.livingEnemyUnits(a,b),f=0;f<c.length;f++){var g=c[f],h=this.enemyShootableUnits(a,b,g);if(this.canBeKilled(a,b,g))for(var i=0;i<e.length;i++){var j=e[i];if(this.willWoundShooting(a,j,g))for(var k=0;k<h.length;k++){var l=h[k];if(this.willWoundShooting(a,g,l)&&g.cost()>l.cost())for(var m=0;m<d.length;m++){var n=d[m];if(n.cost()>g.cost()&&this.canAssist(a,b,g,n))return this.assist(a,b,g,n)}}}}return null}),rule_12B:f(12,function(a,b){if(3===a.round&&!this.winning(a)&&this.winningActivation(a,b))for(var c=this.playerPossibleUnits,d=(this.armiesAndUnits(a,b)[1],this.livingEnemyUnits(a,b)),e=0;e<c.length;e++){var f=c[e],g=this.enemyAssaultableUnits(a,b,f);if(this.canBeKilled(a,b,f)&&!this.canScape(a,b,f))for(var h=0;h<d.length;h++){var i=d[h];if(this.willWoundShooting(a,i,f))for(var j=0;j<g.length;j++){var k=g[j];if(this.willWoundHalfAssaulting(a,f,k)&&f.cost()>k.cost())return this.assault(f,k)}}}return null}),rule_12C:f(12,function(a,b){if(3===a.round&&!this.winning(a)&&this.winningActivation(a,b))for(var c=this.playerPossibleUnits,d=(this.armiesAndUnits(a,b)[1],this.livingEnemyUnits(a,b)),e=0;e<c.length;e++){var f=c[e],g=this.enemyAssaultableUnits(a,b,f);if(this.canBeKilled(a,b,f)&&this.canScape(a,b,f))for(var h=0;h<d.length;h++){var i=d[h];if(this.willWoundShooting(a,i,f))for(var j=0;j<g.length;j++){var k=g[j];if(this.willWoundHalfAssaulting(a,f,k)&&f.cost()>k.cost())return this.scape(a,b,f)}}}return null}),rule_12D:f(12,function(a,b){if(3===a.round&&!this.winning(a)&&this.winningActivation(a,b))for(var c=this.playerPossibleUnits,d=(this.armiesAndUnits(a,b)[1],this.livingEnemyUnits(a,b)),e=0;e<c.length;e++){var f=c[e],g=this.enemyShootableUnits(a,b,f);if(this.canBeKilled(a,b,f)&&!this.canScape(a,b,f))for(var h=0;h<d.length;h++){var i=d[h];if(this.willWoundShooting(a,i,f))for(var j=0;j<g.length;j++){var k=g[j];if(this.willWoundShooting(a,f,k)&&this.canKill(a,f,k)&&f.cost()>k.cost())return this.shoot(f,k)}}}return null}),rule_11A:f(11,function(a,b){if(3===a.round&&!this.winning(a))for(var c=this.playerPossibleUnits,d=(this.armiesAndUnits(a,b)[1],this.livingEnemyUnits(a,b)),e=0;e<c.length;e++){var f=c[e],g=this.enemyAssaultableUnits(a,b,f);if(this.canBeKilled(a,b,f)&&this.canScape(a,b,f))for(var h=0;h<d.length;h++){var i=d[h];if(this.willWoundShooting(a,i,f))for(var j=0;j<g.length;j++){var k=g[j];if(this.willWoundHalfAssaulting(a,f,k)&&f.cost()>k.cost())return this.scape(a,b,f)}}}return null}),rule_11B:f(11,function(a,b){if(3===a.round&&this.winning(a)&&this.winningActivation(a,b))for(var c=this.playerPossibleUnits,d=(this.armiesAndUnits(a,b)[1],this.livingEnemyUnits(a,b)),e=0;e<c.length;e++){var f=c[e],g=this.enemyAssaultableUnits(a,b,f);if(this.canBeKilled(a,b,f)&&this.canScape(a,b,f))for(var h=0;h<d.length;h++){var i=d[h];if(this.willWoundShooting(a,i,f))for(var j=0;j<g.length;j++){var k=g[j];if(this.willWoundHalfAssaulting(a,f,k)&&f.cost()>k.cost())return this.scape(a,b,f)}}}return null}),rule_11C:f(11,function(a,b){if(3===a.round&&this.winning(a)&&this.winningActivation(a,b))for(var c=this.playerPossibleUnits,d=(this.armiesAndUnits(a,b)[1],this.livingEnemyUnits(a,b)),e=0;e<c.length;e++){var f=c[e],g=this.enemyAssaultableUnits(a,b,f);if(this.canBeKilled(a,b,f)&&!this.canScape(a,b,f))for(var h=0;h<d.length;h++){var i=d[h];if(this.willWoundShooting(a,i,f))for(var j=0;j<g.length;j++){var k=g[j];if(this.willWoundHalfAssaulting(a,f,k)&&f.cost()>k.cost())return this.assault(f,k)}}}return null}),rule_11D:f(11,function(a,b){if(3===a.round&&this.winning(a)&&this.winningActivation(a,b))for(var c=this.playerPossibleUnits,d=(this.armiesAndUnits(a,b)[1],this.livingEnemyUnits(a,b)),e=0;e<c.length;e++){var f=c[e],g=this.enemyAssaultableUnits(a,b,f);if(this.canBeKilled(a,b,f)&&!this.losingGameByUnitElimination(a,f))for(var h=0;h<d.length;h++){var i=d[h];if(this.willWoundShooting(a,i,f))for(var j=0;j<g.length;j++){var k=g[j];if(this.willWoundHalfAssaulting(a,f,k)&&f.cost()>k.cost())return this.assault(f,k)}}}return null}),rule_10A:f(1e6,function(a,b){if(1===a.round)for(var c=this.playerPossibleUnits,d=0;d<c.length;d++){var e=c[d],f=this.enemyAssaultableUnits(a,b,e);if(this.isMelee(e))for(var g=0;g<f.length;g++){var h=f[g];if(this.unitIsStrongest(f,h)&&this.willWoundHalfAssaulting(a,e,h))return this.assault(e,h)}}return null}),rule_10B:f(10,function(a,b){if(2===a.round)for(var c=this.playerPossibleUnits,d=0;d<c.length;d++){var e=c[d],f=this.enemyAssaultableUnits(a,b,e);if(this.isMelee(e))for(var g=0;g<f.length;g++){var h=f[g];if(this.unitIsStrongest(f,h)&&this.willWoundHalfAssaulting(a,e,h))return this.assault(e,h)}}return null}),rule_9A:f(9,function(a,b){if(2===a.round)for(var c=this.playerPossibleUnits,d=0;d<c.length;d++)for(var e=c[d],f=this.enemyAssaultableUnits(a,b,e),g=0;g<f.length;g++){var h=f[g];if(this.easiestToKill(f,h)&&this.willWoundHalfAssaulting(a,e,h))return this.assault(e,h)}return null}),rule_9B:f(9,function(a,b){if(1===a.round)for(var c=this.playerPossibleUnits,d=0;d<c.length;d++)for(var e=c[d],f=this.enemyAssaultableUnits(a,b,e),g=0;g<f.length;g++){var h=f[g];if(this.easiestToKill(f,h)&&this.willWoundHalfAssaulting(a,e,h))return this.assault(e,h)}return null}),rule_8A:f(8,function(a,b){if(3===a.round&&this.winning(a))for(var c=this.playerPossibleUnits,d=this.armiesAndUnits(a,b)[1],e=0;e<c.length;e++){var f=c[e],g=this.enemyShootableUnits(a,b,f);if(!this.canBeKilled(a,b,f))for(var h=0;h<d.length;h++){var i=d[h];if(i.cost()>f.cost()&&!this.canAssist(a,b,f,i))for(var j=0;j<g.length;j++){var k=g[j];if(this.willKillShooting(a,f,k)&&k.cost()===this.mostExpensiveUnit(g).cost())return this.shoot(f,k)}}}return null}),rule_8B:f(8,function(a,b){if(3===a.round&&this.winning(a))for(var c=this.playerPossibleUnits,d=(this.armiesAndUnits(a,b)[1],this.livingEnemyUnits(a,b)),e=0;e<c.length;e++){var f=c[e],g=this.enemyShootableUnits(a,b,f);if(this.canBeKilled(a,b,f))for(var h=0;h<d.length;h++){var i=d[h];if(f.cost()<i.cost()&&this.canKill(a,f,i)&&this.willWoundShooting(a,f,i))for(var j=0;j<g.length;j++){var k=g[j];if(this.willWoundShooting(a,k,f))return this.shoot(f,i)}}}return null}),rule_8C:f(8,function(a,b){if(3===a.round&&this.winning(a))for(var c=this.playerPossibleUnits,d=this.armiesAndUnits(a,b)[1],e=this.livingEnemyUnits(a,b),f=0;f<c.length;f++){var g=c[f],h=this.enemyShootableUnits(a,b,g);if(this.canBeKilled(a,b,g))for(var i=0;i<d.length;i++){var j=d[i];if(g.cost()<j.cost()&&this.canAssist(a,b,g,j))for(var k=0;k<e.length;k++){var l=e[k];if(this.willWoundShooting(a,l,g))for(var m=0;m<h.length;m++){var n=h[m];if(this.willWoundShooting(a,g,n)&&g.cost()>n.cost())return this.assist(a,b,g,j)}}}}return null}),rule_7A:f(7,function(a,b){if(3===a.round)for(var c=this.playerPossibleUnits,d=this.armiesAndUnits(a,b)[1],e=0;e<c.length;e++){var f=c[e];if(!this.canBeKilled(a,b,f))for(var g=0;g<d.length;g++){var h=d[g];if(h.cost()>f.cost())for(var i=this.enemyShootableUnits(a,b,f),j=0;j<i.length;j++){var k=i[j];if(this.easiestToKill(i,k)&&this.canWound(a,f,k))return this.shoot(f,k)}}}return null}),rule_7B:f(7,function(a,b){if(3===a.round)for(var c=this.playerPossibleUnits,d=(this.armiesAndUnits(a,b)[1],this.livingEnemyUnits(a,b)),e=0;e<c.length;e++){var f=c[e];if(this.canBeKilled(a,b,f))for(var g=this.enemyShootableUnits(a,b,f),h=0;h<g.length;h++){var i=g[h];if(i.cost()===this.mostExpensiveUnit(d).cost()&&this.canKill(a,f,i)&&this.willWoundShooting(a,f,i))for(var j=0;j<d.length;j++){var k=d[j];if(this.willWoundShooting(a,k,f))return this.shoot(f,i)}}}return null}),rule_7C:f(7,function(a,b){if(3===a.round)for(var c=this.playerPossibleUnits,d=(this.armiesAndUnits(a,b)[1],this.livingEnemyUnits(a,b)),e=0;e<c.length;e++){var f=c[e];if(this.canBeKilled(a,b,f))for(var g=this.enemyShootableUnits(a,b,f),h=0;h<g.length;h++){var i=g[h];if(f.cost()<i.cost()&&this.canKill(a,f,i)&&this.willWoundShooting(a,f,i))for(var j=0;j<d.length;j++){var k=d[j];if(this.willWoundShooting(a,k,f))return this.shoot(f,i)}}}return null}),rule_7D:f(7,function(a,b){if(3===a.round&&!this.winning(a))for(var c=this.playerPossibleUnits,d=(this.armiesAndUnits(a,b)[1],this.livingEnemyUnits(a,b)),e=0;e<c.length;e++){var f=c[e];if(this.canBeKilled(a,b,f))for(var g=0;g<d.length;g++){var h=d[g];if(f.cost()<h.cost()&&this.willWoundShooting(a,f,h))for(var i=this.enemyShootableUnits(a,b,f),j=0;j<i.length;j++){var k=i[j];if(this.willWoundShooting(a,k,f))return this.shoot(f,h)}}}return null}),rule_7E:f(7,function(a,b){if(3===a.round)for(var c=this.playerPossibleUnits,d=0;d<c.length;d++){var e=c[d],f=this.enemyShootableUnits(a,b,e);if(this.canBeKilled(a,b,e))for(var g=0;g<f.length;g++){var h=f[g];if(!this.willWoundShooting(a,e,h))for(var i=0;i<f.length;i++){var j=f[i];if(this.willWoundShooting(a,j,e))for(var k=0;k<c.length;k++){var l=c[k];if(e.cost()<l.cost()&&this.canAssist(a,b,e,l))return this.assist(a,b,e,l)}}}}return null}),rule_7F:f(7,function(a,b){if(3===a.round)for(var c=this.playerPossibleUnits,d=0;d<c.length;d++){var e=c[d],f=this.enemyShootableUnits(a,b,e);if(this.canBeKilled(a,b,e)&&this.canScape(a,b,e))for(var g=0;g<f.length;g++){var h=f[g];if(!this.willWoundShooting(a,e,h))for(var i=0;i<f.length;i++){var j=f[i];if(this.willWoundShooting(a,j,e))for(var k=0;k<c.length;k++){var l=c[k];if(e.cost()<l.cost()&&!this.canAssist(a,b,e,l))return this.scape(a,b,e)}}}}return null}),rule_6A:f(6,function(a,b){if(3===a.round)for(var c=this.playerPossibleUnits,d=0;d<c.length;d++){var e=c[d],f=this.shootingKillableUnits(a,b,e);if(!this.canBeKilled(a,b,e))for(var g=0;g<f.length;g++){var h=f[g];if(h.cost()===this.mostExpensiveUnit(f).cost())return this.shoot(e,h)}}return null}),rule_6B:f(6,function(a,b){if(3===a.round)for(var c=this.playerPossibleUnits,d=0;d<c.length;d++){var e=c[d],f=this.shootingKillableUnits(a,b,e);if(this.canBeKilled(a,b,e))for(var g=this.enemyShootableUnits(a,b,e),h=0;h<g.length;h++){var i=g[h];if(this.willWoundShooting(a,i,e))for(var j=0;j<f.length;j++){var k=f[j];if(e.cost()>k.cost()&&this.willWoundShooting(a,e,k))return this.shoot(e,i)}}}return null}),rule_6C:f(6,function(a,b){if(3===a.round)for(var c=this.playerPossibleUnits,d=0;d<c.length;d++){var e=c[d];if(this.canBeKilled(a,b,e))for(var f=this.enemyShootableUnits(a,b,e),g=0;g<f.length;g++){var h=f[g];if(this.willWoundShooting(a,h,e)&&this.canScape(a,b,e))return this.scape(a,b,e)}}return null}),rule_5A:f(5,function(a,b){if(0===a.round)for(var c=this.playerPossibleUnits,d=0;d<c.length;d++)for(var e=c[d],f=this.enemyShootableUnits(a,b,e),g=0;g<f.length;g++){var h=f[g];if(this.canKillShooting(a,e,h)&&this.willWoundALotShooting(a,e,h))return this.shoot(e,h)}return null}),rule_5B:f(5,function(a,b){if(1===a.round)for(var c=this.playerPossibleUnits,d=0;d<c.length;d++)for(var e=c[d],f=this.enemyShootableUnits(a,b,e),g=0;g<f.length;g++){var h=f[g];if(this.canKillShooting(a,e,h)&&this.willWoundALotShooting(a,e,h))return this.shoot(e,h)}return null}),rule_5C:f(5,function(a,b){if(2===a.round)for(var c=this.playerPossibleUnits,d=0;d<c.length;d++)for(var e=c[d],f=this.enemyShootableUnits(a,b,e),g=0;g<f.length;g++){var h=f[g];if(this.canKillShooting(a,e,h)&&this.willWoundALotShooting(a,e,h))return this.shoot(e,h)}return null}),rule_5D:f(5,function(a,b){if(1===a.round)for(var c=this.playerPossibleUnits,d=0;d<c.length;d++)for(var e=c[d],f=this.enemyShootableUnits(a,b,e),g=0;g<f.length;g++){var h=f[g];if(this.canKill(a,h,e)&&this.willWoundShooting(a,e,h))return this.shoot(e,h)}return null}),rule_5E:f(5,function(a,b){if(2===a.round)for(var c=this.playerPossibleUnits,d=0;d<c.length;d++)for(var e=c[d],f=this.enemyShootableUnits(a,b,e),g=0;g<f.length;g++){var h=f[g];if(this.canKill(a,h,e)&&this.willWoundShooting(a,e,h))return this.shoot(e,h)}return null}),rule_5F:f(5,function(a,b){if(1===a.round)for(var c=this.playerPossibleUnits,d=0;d<c.length;d++)for(var e=c[d],f=this.enemyShootableUnits(a,b,e),g=0;g<f.length;g++){var h=f[g];if(this.canKill(a,h,e)&&this.canScape(a,b,e))return this.scape(a,b,e)}return null}),rule_5G:f(5,function(a,b){if(2===a.round)for(var c=this.playerPossibleUnits,d=0;d<c.length;d++)for(var e=c[d],f=this.enemyShootableUnits(a,b,e),g=0;g<f.length;g++){var h=f[g];if(this.canKill(a,h,e)&&this.canScape(a,b,e))return this.scape(a,b,e)}return null}),rule_4A:f(4,function(a,b){if(0===a.round)for(var c=this.playerPossibleUnits,d=0;d<c.length;d++)for(var e=c[d],f=this.enemyShootableUnits(a,b,e),g=0;g<f.length;g++){var h=f[g];if(this.canKillShooting(a,e,h))return this.shoot(e,h)}return null}),rule_4B:f(4,function(a,b){if(1===a.round)for(var c=this.playerPossibleUnits,d=0;d<c.length;d++)for(var e=c[d],f=this.enemyShootableUnits(a,b,e),g=0;g<f.length;g++){var h=f[g];if(this.canKillShooting(a,e,h))return this.shoot(e,h)}return null}),rule_4C:f(4,function(a,b){if(2===a.round)for(var c=this.playerPossibleUnits,d=0;d<c.length;d++)for(var e=c[d],f=this.enemyShootableUnits(a,b,e),g=0;g<f.length;g++){var h=f[g];if(this.canKillShooting(a,e,h))return this.shoot(e,h)}return null}),rule_4D:f(4,function(a,b){if(3===a.round&&this.winning(a))for(var c=this.playerPossibleUnits,d=this.armiesAndUnits(a,b)[1],e=0;e<c.length;e++){var f=c[e];if(!this.canBeKilled(a,b,f))for(var g=0;g<d.length;g++){var h=d[g];if(h.cost()>f.cost()&&this.canAssist(a,b,f,h))return this.assist(a,b,f,h)}}return null}),rule_4E:f(4,function(a,b){if(3===a.round&&this.winning(a))for(var c=this.playerPossibleUnits,d=this.armiesAndUnits(a,b)[1],e=0;e<c.length;e++){var f=c[e];if(!this.canBeKilled(a,b,f))for(var g=this.enemyShootableUnits(a,b,f),h=0;h<g.length;h++){var i=g[h];if(this.canWound(a,f,i)&&this.easiestToKill(g,i))for(var j=0;j<d.length;j++){var k=d[j];if(k.cost()>f.cost()&&!this.canAssist(a,b,f,k))return this.shoot(f,i)}}}return null}),rule_3A:f(3,function(a,b){if(0===a.round)for(var c=this.playerPossibleUnits,d=0;d<c.length;d++)for(var e=c[d],f=this.enemyShootableUnits(a,b,e),g=0;g<f.length;g++){var h=f[g];if("sniper"===this.classification(e)&&this.unitIsStrongest(f,h))return this.shoot(e,h)}return null}),rule_3B:f(3,function(a,b){if(0===a.round)for(var c=this.playerPossibleUnits,d=0;d<c.length;d++)for(var e=c[d],f=this.enemyShootableUnits(a,b,e),g=0;g<f.length;g++){var h=f[g];if(this.maxRangeInUnits(c,e)&&this.unitIsStrongest(f,h))return this.shoot(e,h)}return null}),rule_3C:f(3,function(a,b){if(0===a.round)for(var c=this.playerPossibleUnits,d=this.armiesAndUnits(a,b)[1],e=0;e<c.length;e++)for(var f=c[e],g=0;g<d.length;g++){var h=d[g];if(this.wounded(h)&&this.canAssist(a,b,f,h))return this.assist(a,b,f,h)}return null}),rule_3D:f(3,function(a,b){if(1===a.round)for(var c=this.playerPossibleUnits,d=this.armiesAndUnits(a,b)[1],e=0;e<c.length;e++)for(var f=c[e],g=0;g<d.length;g++){var h=d[g];if(this.wounded(h)&&this.canAssist(a,b,f,h))return this.assist(a,b,f,h)}return null}),rule_3E:f(3,function(a,b){if(2===a.round)for(var c=this.playerPossibleUnits,d=this.armiesAndUnits(a,b)[1],e=0;e<c.length;e++)for(var f=c[e],g=0;g<d.length;g++){var h=d[g];if(this.wounded(h)&&this.canAssist(a,b,f,h))return this.assist(a,b,f,h)}return null}),rule_3F:f(3,function(a,b){if(3===a.round)for(var c=this.playerPossibleUnits,d=this.livingEnemyUnits(a,b),e=this.armiesAndUnits(a,b)[1],f=0;f<c.length;f++)for(var g=c[f],h=0;h<e.length;h++){var i=e[h];if(i.cost()>g.cost()&&this.canAssist(a,b,g,i))for(var j=0;j<d.length;j++){var k=d[j];if(!this.canKill(a,k,g))return this.assist(a,b,g,i)}}return null}),rule_3G:f(3,function(a,b){var c=this.playerPossibleUnits;if(0===a.round)for(var d=0;d<c.length;d++){var e=c[d],f=this.enemyShootableUnits(a,b,e);if(f.length>1)for(var g=0;g<f.length;g++){var h=f[g];if(h.cost()===this.mostExpensiveUnit(f).cost())return this.shoot(e,h)}}return null}),rule_3H:f(3,function(a,b){if(2===a.round)for(var c=this.playerPossibleUnits,d=this.armiesAndUnits(a,b)[1],e=0;e<c.length;e++)for(var f=c[e],g=0;g<d.length;g++){var h=d[g];if(h.livingModels().length<h.size()&&this.canAssist(a,b,f,h))return this.assist(a,b,f,h)}return null}),rule_3I:f(3,function(a,b){if(1===a.round)for(var c=this.playerPossibleUnits,d=this.armiesAndUnits(a,b)[1],e=0;e<c.length;e++)for(var f=c[e],g=0;g<d.length;g++){var h=d[g];if(h.livingModels().length<h.size()&&this.canAssist(a,b,f,h))return this.assist(a,b,f,h)}return null}),rule_3J:f(3,function(a,b){if(0===a.round)for(var c=this.playerPossibleUnits,d=this.armiesAndUnits(a,b)[1],e=0;e<c.length;e++)for(var f=c[e],g=0;g<d.length;g++){var h=d[g];if(h.livingModels().length<h.size()&&this.canAssist(a,b,f,h))return this.assist(a,b,f,h)}return null}),rule_3K:f(3,function(a,b){if(0===a.round)for(var c=this.playerPossibleUnits,d=0;d<c.length;d++)for(var e=c[d],f=this.enemyShootableUnits(a,b,e),g=0;g<f.length;g++){var h=f[g];if(this.canShoot_(a,e,h,!1)&&this.unitIsStrongest(f,h))return this.shoot(e,h)}return null}),rule_3L:f(31e3,function(a,b){if(0===a.round)for(var c=this.playerPossibleUnits,d=this.armiesAndUnits(a,b)[1].concat(this.armiesAndUnits(a,b)[3]),e=0;e<c.length;e++)for(var f=c[e],g=this.enemyShootableUnits(a,b,f),h=0;h<g.length;h++){var i=g[h];if(this.willWoundShooting(a,f,i)&&this.unitIsStrongest(d,i))return this.shoot(f,i)}return null}),rule_3M:f(3,function(a,b){if(1===a.round)for(var c=this.playerPossibleUnits,d=0;d<c.length;d++)for(var e=c[d],f=this.enemyShootableUnits(a,b,e),g=0;g<f.length;g++){var h=f[g];if(this.willWoundShooting(a,e,h)&&this.unitIsStrongest(f,h))return this.shoot(e,h)}return null}),rule_3N:f(3,function(a,b){if(1===a.round)for(var c=this.playerPossibleUnits,d=this.armiesAndUnits(a,b)[1].concat(this.armiesAndUnits(a,b)[3]),e=0;e<c.length;e++)for(var f=c[e],g=this.enemyShootableUnits(a,b,f),h=0;h<g.length;h++){var i=g[h];if(this.willWoundShooting(a,f,i)&&this.unitIsStrongest(d,i))return this.shoot(f,i)}return null}),rule_3O:f(3,function(a,b){if(2===a.round)for(var c=this.playerPossibleUnits,d=0;d<c.length;d++)for(var e=c[d],f=this.enemyShootableUnits(a,b,e),g=0;g<f.length;g++){var h=f[g];if(this.willWoundShooting(a,e,h)&&this.unitIsStrongest(f,h))return this.shoot(e,h)}return null}),rule_3P:f(3,function(a,b){if(2===a.round)for(var c=this.playerPossibleUnits,d=0;d<c.length;d++)for(var e=c[d],f=this.enemyShootableUnits(a,b,e),g=0;g<f.length;g++){var h=f[g];if(this.willWoundShooting(a,e,h)&&this.easiestToKill(f,h))return this.shoot(e,h)}return null}),rule_3Q:f(3,function(a,b){if(0===a.round)for(var c=this.playerPossibleUnits,d=0;d<c.length;d++){var e=c[d];if("troop"===this.classification(e))for(var f=this.enemyShootableUnits(a,b,e),g=0;g<f.length;g++){var h=f[g];if(this.willWoundShooting(a,e,h)&&this.unitIsStrongest(f,h))return this.shoot(e,h)}}return null}),rule_3R:f(3,function(a,b){if(0===a.round)for(var c=this.playerPossibleUnits,d=this.armiesAndUnits(a,b)[1],e=0;e<c.length;e++){var f=c[e];if(f.cost()===this.cheapestUnit(d).cost())for(var g=this.enemyShootableUnits(a,b,f),h=0;h<g.length;h++){var i=g[h];if(this.willWoundShooting(a,f,i)&&this.unitIsStrongest(g,i))return this.shoot(f,i)}}return null}),rule_3S:f(3,function(a,b){if(0===a.round)for(var c=this.playerPossibleUnits,d=this.armiesAndUnits(a,b)[1].concat(this.armiesAndUnits(a,b)[3]),e=0;e<c.length;e++){var f=c[e];if("troop"===this.classification(f))for(var g=this.enemyShootableUnits(a,b,f),h=0;h<g.length;h++){var i=g[h];if(this.willWoundShooting(a,f,i)&&this.unitIsStrongest(d,i))return this.shoot(f,i)}}return null}),rule_3T:f(3,function(a,b){for(var c=this.playerPossibleUnits,d=this.armiesAndUnits(a,b),e=d[1],f=e.concat(d[3]),g=0;g<c.length;g++)for(var h=c[g],i=0;i<e.length;i++){var j=e[i];if(this.wounded(j)&&this.canAssist(a,b,h,j))for(var k=this.enemyShootableUnits(a,b,h),l=0;l<k.length;l++){var m=k[l];if(this.willWoundShooting(a,h,m)&&this.unitIsStrongest(f,m))return this.assist(a,b,h,j)}}return null}),rule_2A:f(2,function(a,b){if(0===a.round)for(var c=this.playerPossibleUnits,d=0;d<c.length;d++){var e=c[d],f=this.enemyAssaultableUnits(a,b,e);if(f.length>0)for(var g=0;g<f.length;g++){var h=f[g];if(this.wounded(h))return this.assault(e,h)}}return null}),rule_2B:f(2,function(a,b){if(0===a.round)for(var c=this.playerPossibleUnits,d=0;d<c.length;d++){var e=c[d];if("fastAttack"===this.classification(e))for(var f=this.enemyShootableUnits(a,b,e),g=0;g<f.length;g++){var h=f[g];return this.shoot(e,h)}}return null}),rule_2C:f(2,function(a,b){if(1===a.round)for(var c=this.playerPossibleUnits,d=0;d<c.length;d++){var e=c[d];if("fastAttack"===this.classification(e))for(var f=this.enemyShootableUnits(a,b,e),g=0;g<f.length;g++){var h=f[g];return this.shoot(e,h)}}return null}),rule_2D:f(2,function(a,b){if(2===a.round)for(var c=this.playerPossibleUnits,d=0;d<c.length;d++){var e=c[d];if("fastAttack"===this.classification(e))for(var f=this.enemyShootableUnits(a,b,e),g=0;g<f.length;g++){var h=f[g];return this.shoot(e,h)}}return null}),rule_2E:f(2,function(a,b){if(0===a.round)for(var c=this.playerPossibleUnits,d=this.armiesAndUnits(a,b)[1],e=0;e<c.length;e++){var f=c[e];if("heavySupport"===this.classification(f))for(var g=0;g<d.length;g++){var h=d[g];if(!h.isEnabled&&this.canAssist(a,b,f,h))return this.assist(a,b,f,h)}}return null}),rule_2F:f(2,function(a,b){if(0===a.round)for(var c=this.playerPossibleUnits,d=this.armiesAndUnits(a,b)[1],e=0;e<c.length;e++){var f=c[e];if("heavySupport"===this.classification(f))for(var g=0;g<d.length;g++){
var h=d[g];if(this.canAssist(a,b,f,h))return this.assist(a,b,f,h)}}return null}),rule_2G:f(2,function(a,b){if(1===a.round)for(var c=this.playerPossibleUnits,d=this.armiesAndUnits(a,b)[1],e=0;e<c.length;e++){var f=c[e];if("heavySupport"===this.classification(f))for(var g=0;g<d.length;g++){var h=d[g];if(!h.isEnabled&&this.canAssist(a,b,f,h))return this.assist(a,b,f,h)}}return null}),rule_2H:f(2,function(a,b){if(1===a.round)for(var c=this.playerPossibleUnits,d=this.armiesAndUnits(a,b)[1],e=0;e<c.length;e++){var f=c[e];if("heavySupport"===this.classification(f))for(var g=0;g<d.length;g++){var h=d[g];if(this.canAssist(a,b,f,h))return this.assist(a,b,f,h)}}return null}),rule_2I:f(2,function(a,b){if(2===a.round)for(var c=this.playerPossibleUnits,d=this.armiesAndUnits(a,b)[1],e=0;e<c.length;e++){var f=c[e];if("heavySupport"===this.classification(f))for(var g=0;g<d.length;g++){var h=d[g];if(!h.isEnabled&&this.canAssist(a,b,f,h))return this.assist(a,b,f,h)}}return null}),rule_2J:f(2,function(a,b){if(2===a.round)for(var c=this.playerPossibleUnits,d=this.armiesAndUnits(a,b)[1],e=0;e<c.length;e++){var f=c[e];if("heavySupport"===this.classification(f))for(var g=0;g<d.length;g++){var h=d[g];if(this.canAssist(a,b,f,h))return this.assist(a,b,f,h)}}return null}),rule_2K:f(2,function(a,b){if(0===a.round)for(var c=this.playerPossibleUnits,d=this.armiesAndUnits(a,b)[1],e=0;e<c.length;e++){var f=c[e];if("troop"===this.classification(f))for(var g=0;g<d.length;g++){var h=d[g];if(!h.isEnabled&&this.canAssist(a,b,f,h))return this.assist(a,b,f,h)}}return null}),rule_2L:f(2,function(a,b){if(0===a.round)for(var c=this.playerPossibleUnits,d=this.armiesAndUnits(a,b)[1],e=0;e<c.length;e++){var f=c[e];if("troop"===this.classification(f))for(var g=0;g<d.length;g++){var h=d[g];if(this.canAssist(a,b,f,h))return this.assist(a,b,f,h)}}return null}),rule_2M:f(2,function(a,b){if(1===a.round)for(var c=this.playerPossibleUnits,d=this.armiesAndUnits(a,b)[1],e=0;e<c.length;e++){var f=c[e];if("troop"===this.classification(f))for(var g=0;g<d.length;g++){var h=d[g];if(!h.isEnabled&&this.canAssist(a,b,f,h))return this.assist(a,b,f,h)}}return null}),rule_2N:f(1,function(a,b){if(0===a.round)for(var c=this.playerPossibleUnits,d=this.armiesAndUnits(a,b)[1],e=0;e<c.length;e++){var f=c[e];if("troop"===this.classification(f))for(var g=0;g<d.length;g++){var h=d[g];if(this.canAssist(a,b,f,h))return this.assist(a,b,f,h)}}return null}),rule_2O:f(2,function(a,b){if(2===a.round)for(var c=this.playerPossibleUnits,d=this.armiesAndUnits(a,b)[1],e=0;e<c.length;e++){var f=c[e];if("troop"===this.classification(f))for(var g=0;g<d.length;g++){var h=d[g];if(!h.isEnabled&&this.canAssist(a,b,f,h))return this.assist(a,b,f,h)}}return null}),rule_2P:f(2,function(a,b){if(2===a.round)for(var c=this.playerPossibleUnits,d=this.armiesAndUnits(a,b)[1],e=0;e<c.length;e++){var f=c[e];if("troop"===this.classification(f))for(var g=0;g<d.length;g++){var h=d[g];if(this.canAssist(a,b,f,h))return this.assist(a,b,f,h)}}return null}),rule_2Q:f(2,function(a,b){if(0===a.round)for(var c=this.playerPossibleUnits,d=0;d<c.length;d++){var e=c[d];if("sniper"===this.classification(e))for(var f=this.enemyShootableUnits(a,b,e),g=0;g<f.length;g++){var h=f[g];return this.shoot(e,h)}}return null}),rule_2R:f(2,function(a,b){if(1===a.round)for(var c=this.playerPossibleUnits,d=0;d<c.length;d++){var e=c[d];if("sniper"===this.classification(e))for(var f=this.enemyShootableUnits(a,b,e),g=0;g<f.length;g++){var h=f[g];return this.shoot(e,h)}}return null}),rule_2S:f(2,function(a,b){if(2===a.round)for(var c=this.playerPossibleUnits,d=0;d<c.length;d++){var e=c[d];if("sniper"===this.classification(e))for(var f=this.enemyShootableUnits(a,b,e),g=0;g<f.length;g++){var h=f[g];return this.shoot(e,h)}}return null}),rule_1A:f(1,function(a,b){if(0===a.round)for(var c=this.playerPossibleUnits,d=0;d<c.length;d++){var e=c[d];if(this.canScape(a,b,e))return this.scape(a,b,e)}return null}),rule_1B:f(1,function(a,b){if(1===a.round)for(var c=this.playerPossibleUnits,d=0;d<c.length;d++){var e=c[d];if(this.canScape(a,b,e))return this.scape(a,b,e)}return null}),rule_1C:f(1,function(a,b){if(2===a.round)for(var c=this.playerPossibleUnits,d=0;d<c.length;d++)for(var e=c[d],f=this.enemyShootableUnits(a,b,e),g=0;g<f.length;g++){var h=f[g];return this.shoot(e,h)}return null}),rule_1D:f(1,function(a,b){if(3===a.round)for(var c=this.playerPossibleUnits,d=0;d<c.length;d++)for(var e=c[d],f=this.enemyAssaultableUnits(a,b,e),g=0;g<f.length;g++){var h=f[g];return this.assault(e,h)}return null}),rule_1E:f(1,function(a,b){for(var c=this.playerPossibleUnits,d=0;d<c.length;d++)for(var e=c[d],f=this.enemyShootableUnits(a,b,e),g=0;g<f.length;g++){var h=f[g];return this.shoot(e,h)}return null}),rule_1F:f(1,function(a,b){for(var c=this.playerPossibleUnits,d=0;d<c.length;d++){var e=c[d],f=this.enemyShootableUnits(a,b,e);if(0==f.length)for(var g=this.livingEnemyUnits(a,b),h=0;h<g.length;h++){var i=g[h];if(this.easiestToKill(g,i)){var j=this.getCloseTo(a,e,i);return j}}}return null})}),I=p.DynamicScriptingSinPesosPlayer=h(d.Player,{constructor:function(a){d.Player.call(this,a),m(this,a).array("rules",{defaultValue:[]}),this.__pendingActions__=[],this.rules=this.ownRules(),this.sortRules(),this.playerPossibleUnits=[],this.playerShootableUnits=[],this.playerAssaultableUnits=[]},ownRules:function(){var a=this;return Object.keys(Object.getPrototypeOf(this)).map(function(b){return[a[b],1]}).filter(function(a){var b=a[0];return"function"==typeof b&&b.name&&"rule"===b.name.substr(0,4)})},sortRules:function(){this.rules.sort(function(a,b){return b[0].priority-a[0].priority||b[1]-a[1]})},firstRules:function(a,b,c){for(var d,e,f=[],g=0,h=this.rules.length;g<h;g++)this.rules[g][0].priority==c&&(d=this.rules[g],e=d[0].call(this,a,b),e&&f.push(d));return f},decision:function(a,b){a.synchronizeMetagame(),this.playerPossibleUnits=this.possibleUnits(a,b),this.playerShootableUnits=this.allShootableUnits(a,b),this.playerAssaultableUnits=this.allAssaultableUnits(a,b);var c,d;if(this.__pendingActions__.length<1)for(var e=12;e>0;){var f=this.firstRules(a,b,e);if(f.length>0){if(c=f[Math.floor(Math.random()*f.length)],d=c[0].call(this,a,b))return d.forEach(function(a){a.__rule__=c}),this.__pendingActions__=this.__pendingActions__.concat(d),this.__pendingActions__.shift()}else e-=1}return n(this.__pendingActions__.length<1,"No rule applied to game!"),this.__pendingActions__.shift()},"static __SERMAT__":{identifier:"DynamicScriptingSinPesosPlayer",serializer:function(a){return this.serializeAsProperties(a,["name","rules"])}},shoot:function(a,b){return[new u(a.id),new x(a.id,b.id)]},assault:function(a,b){return[new u(a.id),new y(a.id,b.id)]},move:function(a,b,c){return c?[new u(a.id),b,new x(a.id,c.id)]:[new u(a.id),b,new v(a.id)]},scapeAux:function(a,b,c,d){for(var e=0;e<c.length;e++){var f=c[e],g=[];if(this.canHide(a,d,f)){for(var h=this.hideMoves(a,d,f),i=0;i<h.length;i++)if(a.terrain.distance(f.position,h[i].position)<=f.maxRange()+6)return this.move(d,h[i]);g=g.concat(h)}if(this.canRun(a,d,f)){for(var j=this.runMoves(a,d,f),k=0;k<j.length;k++)if(a.terrain.distance(f.position,j[k].position)<=f.maxRange()+6)return this.move(d,j[k]);g=g.concat(j)}if(g.length>0)return this.move(d,g[Math.floor(Math.random()*g.length)])}},scape:function(a,b,c){var d=this.mostDangerousUnits(a,b,c),e=this.scapeAux(a,b,d,c);if(e)return e;var f=(this.dangerousUnits(a,b,c),this.scapeAux(a,b,d,c));if(f)return f;console.log("no escapa cuando deberia");var g=c.getMoveActions(a),h=this.move(c,g[Math.floor(Math.random()*g.length)]);return h},assistAux:function(a,b,c,d,e){for(var f=0;f<c.length;f++){var g=c[f];if(this.canAssault(a,d,g))return this.assault(d,g);var h;if(this.canBlockSight(a,d,e,g)){var i=this.blockSightMovements(a,d,e,g);h=i[Math.floor(Math.random()*i.length)]}if(this.canShoot_(a,d,g,!0))return h?this.move(d,h,g):this.shoot(d,g);if(h)return this.move(d,h)}return null},assist:function(a,b,c,d){var e=this.mostDangerousUnits(a,b,d),f=this.assistAux(a,b,e,c,d);if(f)return f;var g=this.dangerousUnits(a,b,d),h=this.assistAux(a,b,g,c,d);if(h)return h;console.log("no asiste cuando deberia");var i=c.getMoveActions(a),j=this.move(c,i[Math.floor(Math.random()*i.length)]);return j},getFewMoveActions:function(a,b){var c=[],d=b.position[0],e=b.position[1];return c.push(new w(b.id,[d+1,e+1],(!1))),c},getCloseTo:function(a,b,c){for(var d=this.interpolation(b.position,c.position),e=b.getMoveActions(a),f=[],g=0;g<e.length;g++){var h=e[g].position;d.forEach(function(a){h[0]===a[0]&&h[1]===a[1]&&f.push(e[g])})}for(var i=b.position,j=e[Math.floor(Math.random()*e.length)],k=0;k<f.length;k++){var l=f[k].position;a.terrain.distance(l,c.position)<a.terrain.distance(i,c.position)&&(i=l,j=f[k])}var m=this.move(b,j);return m},possibleUnits:function Z(a,b){var c=this.armiesAndUnits(a,b)[1],Z=[];return c.forEach(function(a){a.isDead()||!a.isEnabled||a.isActive||Z.push(a)}),Z},shootableUnitsAux:function(a,b,c){var d=[],e=this.livingEnemyUnits(a,b),f=c.getShootActions(a);return f.forEach(function(a){e.forEach(function(b){a.targetId===b.id&&d.push(b)})}),d},allShootableUnits:function $(a,b){for(var $=[],c=this.playerPossibleUnits,d=0;d<c.length;d++){var e=c[d],f=[];f=this.shootableUnitsAux(a,b,e),$[d]=[e,f]}return $},enemyShootableUnits:function _(a,b,c){for(var _=[],d=0;d<this.playerShootableUnits.length;d++)this.playerShootableUnits[d][0]==c&&(_=this.playerShootableUnits[d][1]);return _},assaultableUnits:function aa(a,b,c){var aa=[],d=this.livingEnemyUnits(a,b),e=c.getAssaultActions(a);return e.forEach(function(a){d.forEach(function(b){a.targetId===b.id&&aa.push(b)})}),aa},allAssaultableUnits:function ba(a,b){for(var ba=[],c=this.playerPossibleUnits,d=0;d<c.length;d++){var e=c[d],f=[];f=this.assaultableUnits(a,b,e),ba[d]=[e,f]}return ba},enemyAssaultableUnits:function ca(a,b,c){for(var ca=[],d=0;d<this.playerAssaultableUnits.length;d++)this.playerAssaultableUnits[d][0]==c&&(ca=this.playerAssaultableUnits[d][1]);return ca},canShoot_:function(a,b,c,d){return!(b.isDead()||!b.isEnabled||c.isDead()||a.terrain.canShoot(b,c)==1/0)},canAssault:function(a,b,c){return!(b.isDead()||!b.isEnabled||c.isDead()||!(a.terrain.canShoot(b,c)<=12))},interForX:function(a,b,c,d){for(var e=[],f=c,g=a+1;g<b;g++)e.push([parseInt(g),parseInt(f)]),f+=d;return e},interForY:function(a,b,c,d){for(var e=[],f=c,g=a+1;g<b;g++)e.push([parseInt(f),parseInt(g)]),f+=d;return e},interpolation:function(a,b){var c,d,e=0,f=a[0],g=b[0],h=a[1],i=b[1],j=Math.min(f,g),k=Math.max(f,g),l=Math.min(h,i),m=Math.max(h,i);d=j===f?h:i,c=l===h?f:g;var n,o;return h===i?n=this.interForX(j,k,d,e):f===g?o=this.interForY(l,m,c,e):Math.abs(i-h)>=Math.abs(g-f)?(e=Math.abs(g-f)/Math.abs(i-h),o=this.interForY(l,m,c,e)):(e=Math.abs(i-h)/Math.abs(g-f),n=this.interForX(j,k,d,e))},blockSightMovements:function(a,b,c,d){for(var e=c.position,f=d.position,g=this.interpolation(e,f),h=[],i=b.getMoveActions(a),j=0;j<i.length;j++){var k=i[j].position;g.forEach(function(a){k[0]===a[0]&&k[1]===a[1]&&h.push(i[j])})}return h},canBlockSight:function(a,b,c,d){return this.blockSightMovements(a,b,c,d).length>0},canAssist:function da(a,b,c,d){for(var e=this.dangerousUnits(a,b,d),da=!1,f=0;f<e.length;f++){var g=e[f];if(!(this.canBlockSight(a,c,d,g)||this.canShoot_(a,c,g,!0)||this.canAssault(a,c,g))){da=!1;break}da=!0}return da},canRun:function(a,b,c){var d=c.maxRange()+6;return!(b.isEnabled&&a.terrain.canShoot(c,b)<=d)},canHide:function(a,b,c){return!1},runMoves:function(a,b,c){for(var d=c.position,e=b.position,f=b.getMoveActions(a),g=f[Math.floor(Math.random()*f.length)],h=0;h<f.length;h++){var i=f[h].position;a.terrain.distance(i,d)>a.terrain.distance(e,d)&&(e=i,g=f[h])}return a.terrain.distance(c.position,e)<=c.maxRange()+6?(console.log("run y puede huir"),[g]):(console.log("run y huyo lo maximo q pudo pero igual lo alcanzan"),[g])},hideMoves:function(a,b,c){return[]},canScape:function ea(a,b,c){var d=this.mostDangerousUnits(a,b,c);if(0===d.length)return!1;for(var ea=!0,e=0;e<d.length;e++){var f=d[e];this.canRun(a,c,f)||this.canHide(a,c,f)||(ea=!1)}return ea},mostDangerousUnits:function(a,b,c){for(var d=this.livingEnemyUnits(a,b),e=[],f=0;f<d.length;f++){var g=d[f];this.canKill(a,g,c)&&e.push(g)}return e},dangerousUnits:function(a,b,c){for(var d=this.livingEnemyUnits(a,b),e=[],f=0;f<d.length;f++){var g=d[f];(this.canShoot_(a,g,c,!0)||this.canAssault(a,g,c))&&e.push(g)}return e},canBeKilled:function(a,b,c){for(var d=this.armiesAndUnits(a,b)[3],e=0;e<d.length;e++)if(this.canKill(a,d[e],c))return!0;return!1},canKill:function(a,b,c){return!(b.isDead()||!b.isEnabled||c.isDead()||!this.canKillShooting(a,b,c)&&!this.canKillAssaulting(a,b,c))},canKillShooting:function(a,b,c){return!(b.isDead()||c.isDead()||!b.isEnabled||!(this.bestAttackResultShooting(a,b,c)>=100))},canKillAssaulting:function(a,b,c){return!(b.isDead()||c.isDead()||!b.isEnabled||!(this.bestAttackResultAssaulting(a,b,c)>=100))},bestAttackResult:function fa(a,b,c){if(!b.isDead()&&b.isEnabled&&!c.isDead()){var d=this.bestAttackResultShooting(a,b,c),e=this.bestAttackResultAssaulting(a,b,c),fa=Math.max(d,e);return fa}return 0},bestAttackResultShooting:function(a,b,c){if(!b.isDead()&&b.isEnabled&&!c.isDead()){var d=a.terrain.distance(b.position,c.position),e=b.livingModels(),f=0;e.forEach(function(a){a.equipments.forEach(function(a){a.range>=d&&(f+=a.attacks)})});var g=c.livingModels().length,h=100*f/g;return h>100&&(h=100),h}return 0},bestAttackResultAssaulting:function(a,b,c){if(!b.isDead()&&b.isEnabled&&!c.isDead()&&this.canAssault(a,b,c)){var d=0,e=b.livingModels();e.forEach(function(a){a.equipments.forEach(function(a){0===a.range&&(d+=a.attacks)})});var f=c.livingModels().length,g=100*d/f;return g>100&&(g=100),g}return 0},shootingKillableUnits:function ga(a,b,c){for(var ga=[],d=this.shootableUnitsAux(a,b,c),e=0;e<d.length;e++){var f=d[e];this.willKillShooting(a,c,f)&&ga.push(f)}return ga},livingEnemyUnits:function(a,b){var c=this.armiesAndUnits(a,b)[2];return c.livingUnits()},armiesAndUnits:function(a,b){var c=a.armies[b],d=c.units,e=a.opponent(b),f=a.armies[e],g=f.units;return[c,d,f,g]},wounded:function(a){return a.livingModels().length<a.size()},canWoundALot:function(a,b,c){return!(b.isDead()||!b.isEnabled||c.isDead())&&this.bestAttackResult(a,b,c)>=75},canWound:function(a,b,c){return!(b.isDead()||!b.isEnabled||c.isDead())&&this.bestAttackResult(a,b,c)>0},maxCost:function(a){return k(a).map(function(a){a.cost()}).max(0)},mostExpensiveUnit:function(a){for(var b,c=0,d=0;d<a.length;d++)a[d].cost()>c&&(b=a[d],c=b.cost());return b},cheapestUnit:function(a){for(var b,c=0,d=0;d<a.length;d++)a[d].cost()>c&&(b=a[d],c=b.cost());return b},unitForce:function(a){var b=a.livingModels(),c=0;b.forEach(function(a){a.equipments.forEach(function(a){c+=a.attacks})});var d=a.quality*c+a.defense/2+a.cost()/10;return d},unitIsStrongest:function(a,b){for(var c,d=0,e=0;e<a.length;e++)this.unitForce(a[e])>d&&(c=a[e],d=this.unitForce(c));return this.unitForce(b)===d},classification:function(a){return a.quality>=4&&a.defense<=3?"fastAttack":a.defense>=7?"heavySupport":a.size()>=5&&a.cost()<=130?"troop":a.maxRange()>=36?"sniper":""},maxRangeInUnits:function(a,b){var c=k(a).map(function(a){return a.maxRange()}).max(0);return b.maxRange()===c},easiestToKill:function(a,b){var c=k(a).map(function(a){return a.livingModels().length*a.defense}).max(0);return b.livingModels().length*b.defense===c},expectedResultShooting:function(a,b,c){if(this.canShoot_(a,b,c,!0)){var d=a.terrain.distance(b.position,c.position),e=b.livingModels(),f=0;e.forEach(function(a){a.equipments.forEach(function(a){a.range>=d&&(f+=a.attacks)})});for(var g=0,h=0,i=0;i<f;i++)g=Math.floor(3+4*Math.random()),b.quality>g&&(h+=1);for(var j=0,k=0;k<h;k++)g=Math.floor(1+6*Math.random()),c.defense>g&&(j+=1);var l=h-j,m=c.livingModels().length,n=100*l/m;return n>100&&(n=100),n}return 0},expectedResultAssaulting:function(a,b,c){return 0},willKillShooting:function(a,b,c){return 100===this.expectedResultShooting(a,b,c)},willWoundALotShooting:function(a,b,c){return this.expectedResultShooting(a,b,c)>75},willWoundHalfShooting:function(a,b,c){return this.expectedResultShooting(a,b,c)>=50},willWoundShooting:function(a,b,c){return this.expectedResultShooting(a,b,c)>0},willKillAssaulting:function(a,b,c){return 100===this.expectedResultAssaulting(a,b,c)},willWoundALotAssaulting:function(a,b,c){return this.expectedResultAssaulting(a,b,c)>75},willWoundHalfAssaulting:function(a,b,c){return this.expectedResultAssaulting(a,b,c)>=50},willWoundAssaulting:function(a,b,c){return this.expectedResultAssaulting(a,b,c)>0},winning:function(a){var b=a.activePlayer(),c=a.players[0];return b===a.players[0]&&(c=a.players[1]),a.scores(b)>a.scores(c)},losingGameByUnitElimination:function(a,b){var c=a.activePlayer(),d=a.players[0];return c===a.players[0]&&(d=a.players[1]),a.scores(c)-b.cost()<a.scores(d)},winningActivation:function(a,b){if(4===a.round){var c=a.activePlayer(),d=a.players[0];c===a.players[0]&&(d=a.players[1]);var e=[],f=this.livingEnemyUnits(a,b);f.forEach(function(b){a.scores(c)>a.scores(d)-b.cost()&&e.push(b)});var g=this.possibleUnits(a,b);for(i=0;i<g.length;i++){var h=g[i];for(j=0;j<e.length;j++){var k=e[j];if(this.canKill(a,h,k)||this.canPin(a,h,k))return!0}}}return!1},canPin:function(a,b,c){if(this.canAssault(a,b,c)){var d=0,e=b.livingModels();if(e.forEach(function(a){a.equipments.forEach(function(a){0===a.range&&(d+=a.attacks)})}),d>=c.size()/2)return!0}return!1},isMelee:function(a){var b=0,c=0,d=a.livingModels();return d.forEach(function(a){a.equipments.forEach(function(a){a.range>=b&&(b=a.range,c=a.attacks)})}),0===b||(d.forEach(function(a){a.equipments.forEach(function(a){if(0===a.range&&a.attacks>c)return!0})}),!1)},rule_12A:f(12,function(a,b){if(3===a.round&&!this.winning(a))for(var c=this.playerPossibleUnits,d=this.armiesAndUnits(a,b)[1],e=this.livingEnemyUnits(a,b),f=0;f<c.length;f++){var g=c[f],h=this.enemyShootableUnits(a,b,g);if(this.canBeKilled(a,b,g))for(var i=0;i<e.length;i++){var j=e[i];if(this.willWoundShooting(a,j,g))for(var k=0;k<h.length;k++){var l=h[k];if(this.willWoundShooting(a,g,l)&&g.cost()>l.cost())for(var m=0;m<d.length;m++){var n=d[m];if(n.cost()>g.cost()&&this.canAssist(a,b,g,n))return console.log("rule_12A. assist"),this.assist(a,b,g,n)}}}}return null}),rule_12B:f(12,function(a,b){if(3===a.round&&!this.winning(a)&&this.winningActivation(a,b))for(var c=this.playerPossibleUnits,d=(this.armiesAndUnits(a,b)[1],this.livingEnemyUnits(a,b)),e=0;e<c.length;e++){var f=c[e],g=this.enemyAssaultableUnits(a,b,f);if(this.canBeKilled(a,b,f)&&!this.canScape(a,b,f))for(var h=0;h<d.length;h++){var i=d[h];if(this.willWoundShooting(a,i,f))for(var j=0;j<g.length;j++){var k=g[j];if(this.willWoundHalfAssaulting(a,f,k)&&f.cost()>k.cost())return console.log("rule_12B. assault"),this.assault(f,k)}}}return null}),rule_12C:f(12,function(a,b){if(3===a.round&&!this.winning(a)&&this.winningActivation(a,b))for(var c=this.playerPossibleUnits,d=(this.armiesAndUnits(a,b)[1],this.livingEnemyUnits(a,b)),e=0;e<c.length;e++){var f=c[e],g=this.enemyAssaultableUnits(a,b,f);if(this.canBeKilled(a,b,f)&&this.canScape(a,b,f))for(var h=0;h<d.length;h++){var i=d[h];if(this.willWoundShooting(a,i,f))for(var j=0;j<g.length;j++){var k=g[j];if(this.willWoundHalfAssaulting(a,f,k)&&f.cost()>k.cost())return console.log("rule_12C. scape"),this.scape(a,b,f)}}}return null}),rule_12D:f(12,function(a,b){if(3===a.round&&!this.winning(a)&&this.winningActivation(a,b))for(var c=this.playerPossibleUnits,d=(this.armiesAndUnits(a,b)[1],this.livingEnemyUnits(a,b)),e=0;e<c.length;e++){var f=c[e],g=this.enemyShootableUnits(a,b,f);if(this.canBeKilled(a,b,f)&&!this.canScape(a,b,f))for(var h=0;h<d.length;h++){var i=d[h];if(this.willWoundShooting(a,i,f))for(var j=0;j<g.length;j++){var k=g[j];if(this.willWoundShooting(a,f,k)&&this.canKill(a,f,k)&&f.cost()>k.cost())return console.log("rule_12D. shoot"),this.shoot(f,k)}}}return null}),rule_11A:f(11,function(a,b){if(3===a.round&&!this.winning(a))for(var c=this.playerPossibleUnits,d=(this.armiesAndUnits(a,b)[1],this.livingEnemyUnits(a,b)),e=0;e<c.length;e++){var f=c[e],g=this.enemyAssaultableUnits(a,b,f);if(this.canBeKilled(a,b,f)&&this.canScape(a,b,f))for(var h=0;h<d.length;h++){var i=d[h];if(this.willWoundShooting(a,i,f))for(var j=0;j<g.length;j++){var k=g[j];if(this.willWoundHalfAssaulting(a,f,k)&&f.cost()>k.cost())return console.log("rule_11A. scape"),this.scape(a,b,f)}}}return null}),rule_11B:f(11,function(a,b){if(3===a.round&&this.winning(a)&&this.winningActivation(a,b))for(var c=this.playerPossibleUnits,d=(this.armiesAndUnits(a,b)[1],this.livingEnemyUnits(a,b)),e=0;e<c.length;e++){var f=c[e],g=this.enemyAssaultableUnits(a,b,f);if(this.canBeKilled(a,b,f)&&this.canScape(a,b,f))for(var h=0;h<d.length;h++){var i=d[h];if(this.willWoundShooting(a,i,f))for(var j=0;j<g.length;j++){var k=g[j];if(this.willWoundHalfAssaulting(a,f,k)&&f.cost()>k.cost())return console.log("rule_11B. scape"),this.scape(a,b,f)}}}return null}),rule_11C:f(11,function(a,b){if(3===a.round&&this.winning(a)&&this.winningActivation(a,b))for(var c=this.playerPossibleUnits,d=(this.armiesAndUnits(a,b)[1],this.livingEnemyUnits(a,b)),e=0;e<c.length;e++){var f=c[e],g=this.enemyAssaultableUnits(a,b,f);if(this.canBeKilled(a,b,f)&&!this.canScape(a,b,f))for(var h=0;h<d.length;h++){var i=d[h];if(this.willWoundShooting(a,i,f))for(var j=0;j<g.length;j++){var k=g[j];if(this.willWoundHalfAssaulting(a,f,k)&&f.cost()>k.cost())return console.log("rule_11C. assault"),this.assault(f,k)}}}return null}),rule_11D:f(11,function(a,b){if(3===a.round&&this.winning(a)&&this.winningActivation(a,b))for(var c=this.playerPossibleUnits,d=(this.armiesAndUnits(a,b)[1],this.livingEnemyUnits(a,b)),e=0;e<c.length;e++){var f=c[e],g=this.enemyAssaultableUnits(a,b,f);if(this.canBeKilled(a,b,f)&&!this.losingGameByUnitElimination(a,f))for(var h=0;h<d.length;h++){var i=d[h];if(this.willWoundShooting(a,i,f))for(var j=0;j<g.length;j++){var k=g[j];if(this.willWoundHalfAssaulting(a,f,k)&&f.cost()>k.cost())return console.log("rule_11D. assault"),this.assault(f,k)}}}return null}),rule_10A:f(10,function(a,b){if(1===a.round)for(var c=this.playerPossibleUnits,d=0;d<c.length;d++){var e=c[d],f=this.enemyAssaultableUnits(a,b,e);if(this.isMelee(e))for(var g=0;g<f.length;g++){var h=f[g];if(this.unitIsStrongest(f,h)&&this.willWoundHalfAssaulting(a,e,h))return console.log("rule_10A. assault"),this.assault(e,h)}}return null}),rule_10B:f(10,function(a,b){if(2===a.round)for(var c=this.playerPossibleUnits,d=0;d<c.length;d++){var e=c[d],f=this.enemyAssaultableUnits(a,b,e);if(this.isMelee(e))for(var g=0;g<f.length;g++){var h=f[g];if(this.unitIsStrongest(f,h)&&this.willWoundHalfAssaulting(a,e,h))return console.log("rule_10B. assault"),this.assault(e,h)}}return null}),rule_9A:f(9,function(a,b){if(2===a.round)for(var c=this.playerPossibleUnits,d=0;d<c.length;d++)for(var e=c[d],f=this.enemyAssaultableUnits(a,b,e),g=0;g<f.length;g++){var h=f[g];if(this.easiestToKill(f,h)&&this.willWoundHalfAssaulting(a,e,h))return console.log("rule_11A. assault"),this.assault(e,h)}return null}),rule_9B:f(9,function(a,b){if(1===a.round)for(var c=this.playerPossibleUnits,d=0;d<c.length;d++)for(var e=c[d],f=this.enemyAssaultableUnits(a,b,e),g=0;g<f.length;g++){var h=f[g];if(this.easiestToKill(f,h)&&this.willWoundHalfAssaulting(a,e,h))return console.log("rule_9B. assault"),this.assault(e,h)}return null}),rule_8A:f(8,function(a,b){if(3===a.round&&this.winning(a))for(var c=this.playerPossibleUnits,d=this.armiesAndUnits(a,b)[1],e=0;e<c.length;e++){var f=c[e],g=this.enemyShootableUnits(a,b,f);if(!this.canBeKilled(a,b,f))for(var h=0;h<d.length;h++){var i=d[h];if(i.cost()>f.cost()&&!this.canAssist(a,b,f,i))for(var j=0;j<g.length;j++){var k=g[j];if(this.willKillShooting(a,f,k)&&k.cost()===this.mostExpensiveUnit(g).cost())return console.log("rule_8A. shoot"),this.shoot(f,k)}}}return null}),rule_8B:f(8,function(a,b){if(3===a.round&&this.winning(a))for(var c=this.playerPossibleUnits,d=(this.armiesAndUnits(a,b)[1],this.livingEnemyUnits(a,b)),e=0;e<c.length;e++){var f=c[e],g=this.enemyShootableUnits(a,b,f);if(this.canBeKilled(a,b,f))for(var h=0;h<d.length;h++){var i=d[h];if(f.cost()<i.cost()&&this.canKill(a,f,i)&&this.willWoundShooting(a,f,i))for(var j=0;j<g.length;j++){var k=g[j];if(this.willWoundShooting(a,k,f))return console.log("rule_8B. shoot"),this.shoot(f,i)}}}return null}),rule_8C:f(8,function(a,b){if(3===a.round&&this.winning(a))for(var c=this.playerPossibleUnits,d=this.armiesAndUnits(a,b)[1],e=this.livingEnemyUnits(a,b),f=0;f<c.length;f++){var g=c[f],h=this.enemyShootableUnits(a,b,g);if(this.canBeKilled(a,b,g))for(var i=0;i<d.length;i++){var j=d[i];if(g.cost()<j.cost()&&this.canAssist(a,b,g,j))for(var k=0;k<e.length;k++){var l=e[k];if(this.willWoundShooting(a,l,g))for(var m=0;m<h.length;m++){var n=h[m];if(this.willWoundShooting(a,g,n)&&g.cost()>n.cost())return console.log("rule_8C. assist"),this.assist(a,b,g,j)}}}}return null}),rule_7A:f(7,function(a,b){if(3===a.round)for(var c=this.playerPossibleUnits,d=this.armiesAndUnits(a,b)[1],e=0;e<c.length;e++){var f=c[e];if(!this.canBeKilled(a,b,f))for(var g=0;g<d.length;g++){var h=d[g];if(h.cost()>f.cost())for(var i=this.enemyShootableUnits(a,b,f),j=0;j<i.length;j++){var k=i[j];if(this.easiestToKill(i,k)&&this.canWound(a,f,k))return console.log("rule_7A. shoot"),this.shoot(f,k)}}}return null}),rule_7B:f(7,function(a,b){if(3===a.round)for(var c=this.playerPossibleUnits,d=(this.armiesAndUnits(a,b)[1],this.livingEnemyUnits(a,b)),e=0;e<c.length;e++){var f=c[e];if(this.canBeKilled(a,b,f))for(var g=this.enemyShootableUnits(a,b,f),h=0;h<g.length;h++){var i=g[h];if(i.cost()===this.mostExpensiveUnit(d).cost()&&this.canKill(a,f,i)&&this.willWoundShooting(a,f,i))for(var j=0;j<d.length;j++){var k=d[j];if(this.willWoundShooting(a,k,f))return console.log("rule_7B. shoot"),this.shoot(f,i)}}}return null}),rule_7C:f(7,function(a,b){if(3===a.round)for(var c=this.playerPossibleUnits,d=(this.armiesAndUnits(a,b)[1],this.livingEnemyUnits(a,b)),e=0;e<c.length;e++){var f=c[e];if(this.canBeKilled(a,b,f))for(var g=this.enemyShootableUnits(a,b,f),h=0;h<g.length;h++){var i=g[h];if(f.cost()<i.cost()&&this.canKill(a,f,i)&&this.willWoundShooting(a,f,i))for(var j=0;j<d.length;j++){var k=d[j];if(this.willWoundShooting(a,k,f))return console.log("rule_7C. shoot"),this.shoot(f,i)}}}return null}),rule_7D:f(7,function(a,b){if(3===a.round&&!this.winning(a))for(var c=this.playerPossibleUnits,d=(this.armiesAndUnits(a,b)[1],this.livingEnemyUnits(a,b)),e=0;e<c.length;e++){var f=c[e];if(this.canBeKilled(a,b,f))for(var g=0;g<d.length;g++){var h=d[g];if(f.cost()<h.cost()&&this.willWoundShooting(a,f,h))for(var i=this.enemyShootableUnits(a,b,f),j=0;j<i.length;j++){var k=i[j];if(this.willWoundShooting(a,k,f))return console.log("rule_7D. shoot"),this.shoot(f,h)}}}return null}),rule_7E:f(7,function(a,b){if(3===a.round)for(var c=this.playerPossibleUnits,d=0;d<c.length;d++){var e=c[d],f=this.enemyShootableUnits(a,b,e);if(this.canBeKilled(a,b,e))for(var g=0;g<f.length;g++){var h=f[g];if(!this.willWoundShooting(a,e,h))for(var i=0;i<f.length;i++){var j=f[i];if(this.willWoundShooting(a,j,e))for(var k=0;k<c.length;k++){var l=c[k];if(e.cost()<l.cost()&&this.canAssist(a,b,e,l))return console.log("rule_7E. assist"),this.assist(a,b,e,l)}}}}return null}),rule_7F:f(7,function(a,b){if(3===a.round)for(var c=this.playerPossibleUnits,d=0;d<c.length;d++){var e=c[d],f=this.enemyShootableUnits(a,b,e);if(this.canBeKilled(a,b,e)&&this.canScape(a,b,e))for(var g=0;g<f.length;g++){var h=f[g];if(!this.willWoundShooting(a,e,h))for(var i=0;i<f.length;i++){var j=f[i];if(this.willWoundShooting(a,j,e))for(var k=0;k<c.length;k++){var l=c[k];if(e.cost()<l.cost()&&!this.canAssist(a,b,e,l))return console.log("rule_7F. scape"),this.scape(a,b,e)}}}}return null}),rule_6A:f(6,function(a,b){if(3===a.round)for(var c=this.playerPossibleUnits,d=0;d<c.length;d++){var e=c[d],f=this.shootingKillableUnits(a,b,e);if(!this.canBeKilled(a,b,e))for(var g=0;g<f.length;g++){var h=f[g];if(h.cost()===this.mostExpensiveUnit(f).cost())return console.log("rule_6A. shoot"),this.shoot(e,h)}}return null}),rule_6B:f(6,function(a,b){if(3===a.round)for(var c=this.playerPossibleUnits,d=0;d<c.length;d++){var e=c[d],f=this.shootingKillableUnits(a,b,e);if(this.canBeKilled(a,b,e))for(var g=this.enemyShootableUnits(a,b,e),h=0;h<g.length;h++){var i=g[h];if(this.willWoundShooting(a,i,e))for(var j=0;j<f.length;j++){var k=f[j];if(e.cost()>k.cost()&&this.willWoundShooting(a,e,k))return console.log("rule_6B. shoot"),this.shoot(e,i)}}}return null}),rule_6C:f(6,function(a,b){if(3===a.round)for(var c=this.playerPossibleUnits,d=0;d<c.length;d++){var e=c[d];if(this.canBeKilled(a,b,e))for(var f=this.enemyShootableUnits(a,b,e),g=0;g<f.length;g++){var h=f[g];if(this.willWoundShooting(a,h,e)&&this.canScape(a,b,e))return console.log("rule_6C. scape"),this.scape(a,b,e)}}return null}),rule_5A:f(5,function(a,b){if(0===a.round)for(var c=this.playerPossibleUnits,d=0;d<c.length;d++)for(var e=c[d],f=this.enemyShootableUnits(a,b,e),g=0;g<f.length;g++){var h=f[g];if(this.canKillShooting(a,e,h)&&this.willWoundALotShooting(a,e,h))return console.log("rule_5A. shoot"),this.shoot(e,h)}return null}),rule_5B:f(5,function(a,b){if(1===a.round)for(var c=this.playerPossibleUnits,d=0;d<c.length;d++)for(var e=c[d],f=this.enemyShootableUnits(a,b,e),g=0;g<f.length;g++){var h=f[g];if(this.canKillShooting(a,e,h)&&this.willWoundALotShooting(a,e,h))return console.log("rule_5B. shoot"),this.shoot(e,h)}return null}),rule_5C:f(5,function(a,b){if(2===a.round)for(var c=this.playerPossibleUnits,d=0;d<c.length;d++)for(var e=c[d],f=this.enemyShootableUnits(a,b,e),g=0;g<f.length;g++){var h=f[g];if(this.canKillShooting(a,e,h)&&this.willWoundALotShooting(a,e,h))return console.log("rule_5C. shoot"),this.shoot(e,h)}return null}),rule_5D:f(5,function(a,b){if(1===a.round)for(var c=this.playerPossibleUnits,d=0;d<c.length;d++)for(var e=c[d],f=this.enemyShootableUnits(a,b,e),g=0;g<f.length;g++){var h=f[g];if(this.canKill(a,h,e)&&this.willWoundShooting(a,e,h))return console.log("rule_5D. shoot"),this.shoot(e,h)}return null}),rule_5E:f(5,function(a,b){if(2===a.round)for(var c=this.playerPossibleUnits,d=0;d<c.length;d++)for(var e=c[d],f=this.enemyShootableUnits(a,b,e),g=0;g<f.length;g++){var h=f[g];if(this.canKill(a,h,e)&&this.willWoundShooting(a,e,h))return console.log("rule_5E. shoot"),this.shoot(e,h)}return null}),rule_5F:f(5,function(a,b){if(1===a.round)for(var c=this.playerPossibleUnits,d=0;d<c.length;d++)for(var e=c[d],f=this.enemyShootableUnits(a,b,e),g=0;g<f.length;g++){var h=f[g];if(this.canKill(a,h,e)&&this.canScape(a,b,e))return console.log("rule_5F. scape"),this.scape(a,b,e)}return null}),rule_5G:f(5,function(a,b){if(2===a.round)for(var c=this.playerPossibleUnits,d=0;d<c.length;d++)for(var e=c[d],f=this.enemyShootableUnits(a,b,e),g=0;g<f.length;g++){var h=f[g];if(this.canKill(a,h,e)&&this.canScape(a,b,e))return console.log("rule_5G. scape"),this.scape(a,b,e)}return null}),rule_4A:f(4,function(a,b){if(0===a.round)for(var c=this.playerPossibleUnits,d=0;d<c.length;d++)for(var e=c[d],f=this.enemyShootableUnits(a,b,e),g=0;g<f.length;g++){var h=f[g];if(this.canKillShooting(a,e,h))return console.log("rule_4A. shoot"),this.shoot(e,h)}return null}),rule_4B:f(4,function(a,b){if(1===a.round)for(var c=this.playerPossibleUnits,d=0;d<c.length;d++)for(var e=c[d],f=this.enemyShootableUnits(a,b,e),g=0;g<f.length;g++){var h=f[g];if(this.canKillShooting(a,e,h))return console.log("rule_4B. shoot"),this.shoot(e,h)}return null}),rule_4C:f(4,function(a,b){if(2===a.round)for(var c=this.playerPossibleUnits,d=0;d<c.length;d++)for(var e=c[d],f=this.enemyShootableUnits(a,b,e),g=0;g<f.length;g++){var h=f[g];if(this.canKillShooting(a,e,h))return console.log("rule_4C. shoot"),this.shoot(e,h)}return null}),rule_4D:f(4,function(a,b){if(3===a.round&&this.winning(a))for(var c=this.playerPossibleUnits,d=this.armiesAndUnits(a,b)[1],e=0;e<c.length;e++){var f=c[e];if(!this.canBeKilled(a,b,f))for(var g=0;g<d.length;g++){
var h=d[g];if(h.cost()>f.cost()&&this.canAssist(a,b,f,h))return console.log("rule_4D. assist"),this.assist(a,b,f,h)}}return null}),rule_4E:f(4,function(a,b){if(3===a.round&&this.winning(a))for(var c=this.playerPossibleUnits,d=this.armiesAndUnits(a,b)[1],e=0;e<c.length;e++){var f=c[e];if(!this.canBeKilled(a,b,f))for(var g=this.enemyShootableUnits(a,b,f),h=0;h<g.length;h++){var i=g[h];if(this.canWound(a,f,i)&&this.easiestToKill(g,i))for(var j=0;j<d.length;j++){var k=d[j];if(k.cost()>f.cost()&&!this.canAssist(a,b,f,k))return console.log("rule_4E. shoot"),this.shoot(f,i)}}}return null}),rule_3A:f(3,function(a,b){if(0===a.round)for(var c=this.playerPossibleUnits,d=0;d<c.length;d++)for(var e=c[d],f=this.enemyShootableUnits(a,b,e),g=0;g<f.length;g++){var h=f[g];if("sniper"===this.classification(e)&&this.unitIsStrongest(f,h))return console.log("rule_3A. shoot"),this.shoot(e,h)}return null}),rule_3B:f(3,function(a,b){if(0===a.round)for(var c=this.playerPossibleUnits,d=0;d<c.length;d++)for(var e=c[d],f=this.enemyShootableUnits(a,b,e),g=0;g<f.length;g++){var h=f[g];if(this.maxRangeInUnits(c,e)&&this.unitIsStrongest(f,h))return console.log("rule_3B. shoot"),this.shoot(e,h)}return null}),rule_3C:f(3,function(a,b){if(0===a.round)for(var c=this.playerPossibleUnits,d=this.armiesAndUnits(a,b)[1],e=0;e<c.length;e++)for(var f=c[e],g=0;g<d.length;g++){var h=d[g];if(this.wounded(h)&&this.canAssist(a,b,f,h))return console.log("rule_3C. assist"),this.assist(a,b,f,h)}return null}),rule_3D:f(3,function(a,b){if(1===a.round)for(var c=this.playerPossibleUnits,d=this.armiesAndUnits(a,b)[1],e=0;e<c.length;e++)for(var f=c[e],g=0;g<d.length;g++){var h=d[g];if(this.wounded(h)&&this.canAssist(a,b,f,h))return console.log("rule_3D. assist"),this.assist(a,b,f,h)}return null}),rule_3E:f(3,function(a,b){if(2===a.round)for(var c=this.playerPossibleUnits,d=this.armiesAndUnits(a,b)[1],e=0;e<c.length;e++)for(var f=c[e],g=0;g<d.length;g++){var h=d[g];if(this.wounded(h)&&this.canAssist(a,b,f,h))return console.log("rule_3E. assist"),this.assist(a,b,f,h)}return null}),rule_3F:f(3,function(a,b){if(3===a.round)for(var c=this.playerPossibleUnits,d=this.livingEnemyUnits(a,b),e=this.armiesAndUnits(a,b)[1],f=0;f<c.length;f++)for(var g=c[f],h=0;h<e.length;h++){var i=e[h];if(i.cost()>g.cost()&&this.canAssist(a,b,g,i))for(var j=0;j<d.length;j++){var k=d[j];if(!this.canKill(a,k,g))return console.log("rule_3F. assist"),this.assist(a,b,g,i)}}return null}),rule_3G:f(3,function(a,b){var c=this.playerPossibleUnits;if(0===a.round)for(var d=0;d<c.length;d++){var e=c[d],f=this.enemyShootableUnits(a,b,e);if(f.length>1)for(var g=0;g<f.length;g++){var h=f[g];if(h.cost()===this.mostExpensiveUnit(f).cost())return console.log("rule_3G. shoot"),this.shoot(e,h)}}return null}),rule_3H:f(3,function(a,b){if(2===a.round)for(var c=this.playerPossibleUnits,d=this.armiesAndUnits(a,b)[1],e=0;e<c.length;e++)for(var f=c[e],g=0;g<d.length;g++){var h=d[g];if(h.livingModels().length<h.size()&&this.canAssist(a,b,f,h))return console.log("rule_3H. assist"),this.assist(a,b,f,h)}return null}),rule_3I:f(3,function(a,b){if(1===a.round)for(var c=this.playerPossibleUnits,d=this.armiesAndUnits(a,b)[1],e=0;e<c.length;e++)for(var f=c[e],g=0;g<d.length;g++){var h=d[g];if(h.livingModels().length<h.size()&&this.canAssist(a,b,f,h))return console.log("rule_3I. assist"),this.assist(a,b,f,h)}return null}),rule_3J:f(3,function(a,b){if(0===a.round)for(var c=this.playerPossibleUnits,d=this.armiesAndUnits(a,b)[1],e=0;e<c.length;e++)for(var f=c[e],g=0;g<d.length;g++){var h=d[g];if(h.livingModels().length<h.size()&&this.canAssist(a,b,f,h))return console.log("rule_3J. assist"),this.assist(a,b,f,h)}return null}),rule_3K:f(3,function(a,b){if(0===a.round)for(var c=this.playerPossibleUnits,d=0;d<c.length;d++)for(var e=c[d],f=this.enemyShootableUnits(a,b,e),g=0;g<f.length;g++){var h=f[g];if(this.canShoot_(a,e,h,!1)&&this.unitIsStrongest(f,h))return console.log("rule_3K. shoot"),this.shoot(e,h)}return null}),rule_3L:f(3,function(a,b){if(0===a.round)for(var c=this.playerPossibleUnits,d=this.armiesAndUnits(a,b)[1].concat(this.armiesAndUnits[3]),e=0;e<c.length;e++)for(var f=c[e],g=this.enemyShootableUnits(a,b,f),h=0;h<g.length;h++){var i=g[h];if(this.willWoundShooting(a,f,i)&&this.unitIsStrongest(d,i))return console.log("rule_3L. shoot"),this.shoot(f,i)}return null}),rule_3M:f(3,function(a,b){if(1===a.round)for(var c=this.playerPossibleUnits,d=0;d<c.length;d++)for(var e=c[d],f=this.enemyShootableUnits(a,b,e),g=0;g<f.length;g++){var h=f[g];if(this.willWoundShooting(a,e,h)&&this.unitIsStrongest(f,h))return console.log("rule_3M. shoot"),this.shoot(e,h)}return null}),rule_3N:f(3,function(a,b){if(1===a.round)for(var c=this.playerPossibleUnits,d=this.armiesAndUnits(a,b)[1].concat(this.armiesAndUnits(a,b)[3]),e=0;e<c.length;e++)for(var f=c[e],g=this.enemyShootableUnits(a,b,f),h=0;h<g.length;h++){var i=g[h];if(this.willWoundShooting(a,f,i)&&this.unitIsStrongest(d,i))return console.log("rule_3N. shoot"),this.shoot(f,i)}return null}),rule_3O:f(3,function(a,b){if(2===a.round)for(var c=this.playerPossibleUnits,d=0;d<c.length;d++)for(var e=c[d],f=this.enemyShootableUnits(a,b,e),g=0;g<f.length;g++){var h=f[g];if(this.willWoundShooting(a,e,h)&&this.unitIsStrongest(f,h))return console.log("rule_3O. shoot"),this.shoot(e,h)}return null}),rule_3P:f(3,function(a,b){if(2===a.round)for(var c=this.playerPossibleUnits,d=0;d<c.length;d++)for(var e=c[d],f=this.enemyShootableUnits(a,b,e),g=0;g<f.length;g++){var h=f[g];if(this.willWoundShooting(a,e,h)&&this.easiestToKill(f,h))return console.log("rule_3P. shoot"),this.shoot(e,h)}return null}),rule_3Q:f(3,function(a,b){if(0===a.round)for(var c=this.playerPossibleUnits,d=0;d<c.length;d++){var e=c[d];if("troop"===this.classification(e))for(var f=this.enemyShootableUnits(a,b,e),g=0;g<f.length;g++){var h=f[g];if(this.willWoundShooting(a,e,h)&&this.unitIsStrongest(f,h))return console.log("rule_3Q. shoot"),this.shoot(e,h)}}return null}),rule_3R:f(3,function(a,b){if(0===a.round)for(var c=this.playerPossibleUnits,d=this.armiesAndUnits(a,b)[1],e=0;e<c.length;e++){var f=c[e];if(f.cost()===this.cheapestUnit(d).cost())for(var g=this.enemyShootableUnits(a,b,f),h=0;h<g.length;h++){var i=g[h];if(this.willWoundShooting(a,f,i)&&this.unitIsStrongest(g,i))return console.log("rule_3R. shoot"),this.shoot(f,i)}}return null}),rule_3S:f(3,function(a,b){if(0===a.round)for(var c=this.playerPossibleUnits,d=this.armiesAndUnits(a,b)[1].concat(this.armiesAndUnits(a,b)[3]),e=0;e<c.length;e++){var f=c[e];if("troop"===this.classification(f))for(var g=this.enemyShootableUnits(a,b,f),h=0;h<g.length;h++){var i=g[h];if(this.willWoundShooting(a,f,i)&&this.unitIsStrongest(d,i))return console.log("rule_3S. shoot"),this.shoot(f,i)}}return null}),rule_3T:f(3,function(a,b){for(var c=this.playerPossibleUnits,d=this.armiesAndUnits(a,b),e=d[1],f=e.concat(d[3]),g=0;g<c.length;g++)for(var h=c[g],i=0;i<e.length;i++){var j=e[i];if(this.wounded(j)&&this.canAssist(a,b,h,j))for(var k=this.enemyShootableUnits(a,b,h),l=0;l<k.length;l++){var m=k[l];if(this.willWoundShooting(a,h,m)&&this.unitIsStrongest(f,m))return console.log("rule_3T. assist"),this.assist(a,b,h,j)}}return null}),rule_2A:f(2,function(a,b){if(0===a.round)for(var c=this.playerPossibleUnits,d=0;d<c.length;d++){var e=c[d],f=this.enemyAssaultableUnits(a,b,e);if(f.length>0)for(var g=0;g<f.length;g++){var h=f[g];if(this.wounded(h))return console.log("rule_2A. assault"),this.assault(e,h)}}return null}),rule_2B:f(2,function(a,b){if(0===a.round)for(var c=this.playerPossibleUnits,d=0;d<c.length;d++){var e=c[d];if("fastAttack"===this.classification(e))for(var f=this.enemyShootableUnits(a,b,e),g=0;g<f.length;g++){var h=f[g];return console.log("rule_2B. shoot"),this.shoot(e,h)}}return null}),rule_2C:f(2,function(a,b){if(1===a.round)for(var c=this.playerPossibleUnits,d=0;d<c.length;d++){var e=c[d];if("fastAttack"===this.classification(e))for(var f=this.enemyShootableUnits(a,b,e),g=0;g<f.length;g++){var h=f[g];return console.log("rule_2C. shoot"),this.shoot(e,h)}}return null}),rule_2D:f(2,function(a,b){if(2===a.round)for(var c=this.playerPossibleUnits,d=0;d<c.length;d++){var e=c[d];if("fastAttack"===this.classification(e))for(var f=this.enemyShootableUnits(a,b,e),g=0;g<f.length;g++){var h=f[g];return console.log("rule_2D. shoot"),this.shoot(e,h)}}return null}),rule_2E:f(2,function(a,b){if(0===a.round)for(var c=this.playerPossibleUnits,d=this.armiesAndUnits(a,b)[1],e=0;e<c.length;e++){var f=c[e];if("heavySupport"===this.classification(f))for(var g=0;g<d.length;g++){var h=d[g];if(!h.isEnabled&&this.canAssist(a,b,f,h))return console.log("rule_2E. assist"),this.assist(a,b,f,h)}}return null}),rule_2F:f(2,function(a,b){if(0===a.round)for(var c=this.playerPossibleUnits,d=this.armiesAndUnits(a,b)[1],e=0;e<c.length;e++){var f=c[e];if("heavySupport"===this.classification(f))for(var g=0;g<d.length;g++){var h=d[g];if(this.canAssist(a,b,f,h))return console.log("rule_2F. assist"),this.assist(a,b,f,h)}}return null}),rule_2G:f(2,function(a,b){if(1===a.round)for(var c=this.playerPossibleUnits,d=this.armiesAndUnits(a,b)[1],e=0;e<c.length;e++){var f=c[e];if("heavySupport"===this.classification(f))for(var g=0;g<d.length;g++){var h=d[g];if(!h.isEnabled&&this.canAssist(a,b,f,h))return console.log("rule_2G. assist"),this.assist(a,b,f,h)}}return null}),rule_2H:f(2,function(a,b){if(1===a.round)for(var c=this.playerPossibleUnits,d=this.armiesAndUnits(a,b)[1],e=0;e<c.length;e++){var f=c[e];if("heavySupport"===this.classification(f))for(var g=0;g<d.length;g++){var h=d[g];if(this.canAssist(a,b,f,h))return console.log("rule_2H. assist"),this.assist(a,b,f,h)}}return null}),rule_2I:f(2,function(a,b){if(2===a.round)for(var c=this.playerPossibleUnits,d=this.armiesAndUnits(a,b)[1],e=0;e<c.length;e++){var f=c[e];if("heavySupport"===this.classification(f))for(var g=0;g<d.length;g++){var h=d[g];if(!h.isEnabled&&this.canAssist(a,b,f,h))return console.log("rule_2I. assist"),this.assist(a,b,f,h)}}return null}),rule_2J:f(2,function(a,b){if(2===a.round)for(var c=this.playerPossibleUnits,d=this.armiesAndUnits(a,b)[1],e=0;e<c.length;e++){var f=c[e];if("heavySupport"===this.classification(f))for(var g=0;g<d.length;g++){var h=d[g];if(this.canAssist(a,b,f,h))return console.log("rule_2J. assist"),this.assist(a,b,f,h)}}return null}),rule_2K:f(2,function(a,b){if(0===a.round)for(var c=this.playerPossibleUnits,d=this.armiesAndUnits(a,b)[1],e=0;e<c.length;e++){var f=c[e];if("troop"===this.classification(f))for(var g=0;g<d.length;g++){var h=d[g];if(!h.isEnabled&&this.canAssist(a,b,f,h))return console.log("rule_2K. assist"),this.assist(a,b,f,h)}}return null}),rule_2L:f(2,function(a,b){if(0===a.round)for(var c=this.playerPossibleUnits,d=this.armiesAndUnits(a,b)[1],e=0;e<c.length;e++){var f=c[e];if("troop"===this.classification(f))for(var g=0;g<d.length;g++){var h=d[g];if(this.canAssist(a,b,f,h))return console.log("rule_2L. assist"),this.assist(a,b,f,h)}}return null}),rule_2M:f(2,function(a,b){if(1===a.round)for(var c=this.playerPossibleUnits,d=this.armiesAndUnits(a,b)[1],e=0;e<c.length;e++){var f=c[e];if("troop"===this.classification(f))for(var g=0;g<d.length;g++){var h=d[g];if(!h.isEnabled&&this.canAssist(a,b,f,h))return console.log("rule_2M. assist"),this.assist(a,b,f,h)}}return null}),rule_2N:f(1,function(a,b){if(0===a.round)for(var c=this.playerPossibleUnits,d=this.armiesAndUnits(a,b)[1],e=0;e<c.length;e++){var f=c[e];if("troop"===this.classification(f))for(var g=0;g<d.length;g++){var h=d[g];if(this.canAssist(a,b,f,h))return console.log("rule_2N. assist"),this.assist(a,b,f,h)}}return null}),rule_2O:f(2,function(a,b){if(2===a.round)for(var c=this.playerPossibleUnits,d=this.armiesAndUnits(a,b)[1],e=0;e<c.length;e++){var f=c[e];if("troop"===this.classification(f))for(var g=0;g<d.length;g++){var h=d[g];if(!h.isEnabled&&this.canAssist(a,b,f,h))return console.log("rule_2O. assist"),this.assist(a,b,f,h)}}return null}),rule_2P:f(2,function(a,b){if(2===a.round)for(var c=this.playerPossibleUnits,d=this.armiesAndUnits(a,b)[1],e=0;e<c.length;e++){var f=c[e];if("troop"===this.classification(f))for(var g=0;g<d.length;g++){var h=d[g];if(this.canAssist(a,b,f,h))return console.log("rule_2P. assist"),this.assist(a,b,f,h)}}return null}),rule_2Q:f(2,function(a,b){if(0===a.round)for(var c=this.playerPossibleUnits,d=0;d<c.length;d++){var e=c[d];if("sniper"===this.classification(e))for(var f=this.enemyShootableUnits(a,b,e),g=0;g<f.length;g++){var h=f[g];return console.log("rule_2Q. shoot"),this.shoot(e,h)}}return null}),rule_2R:f(2,function(a,b){if(1===a.round)for(var c=this.playerPossibleUnits,d=0;d<c.length;d++){var e=c[d];if("sniper"===this.classification(e))for(var f=this.enemyShootableUnits(a,b,e),g=0;g<f.length;g++){var h=f[g];return console.log("rule_2R. shoot"),this.shoot(e,h)}}return null}),rule_2S:f(2,function(a,b){if(2===a.round)for(var c=this.playerPossibleUnits,d=0;d<c.length;d++){var e=c[d];if("sniper"===this.classification(e))for(var f=this.enemyShootableUnits(a,b,e),g=0;g<f.length;g++){var h=f[g];return console.log("rule_2S. shoot"),this.shoot(e,h)}}return null}),rule_1A:f(1,function(a,b){if(0===a.round)for(var c=this.playerPossibleUnits,d=0;d<c.length;d++){var e=c[d];if(this.canScape(a,b,e))return console.log("rule_1A. scape"),this.scape(a,b,e)}return null}),rule_1B:f(1,function(a,b){if(1===a.round)for(var c=this.playerPossibleUnits,d=0;d<c.length;d++){var e=c[d];if(this.canScape(a,b,e))return console.log("rule_1B. scape"),this.scape(a,b,e)}return null}),rule_1C:f(1,function(a,b){if(2===a.round)for(var c=this.playerPossibleUnits,d=0;d<c.length;d++)for(var e=c[d],f=this.enemyShootableUnits(a,b,e),g=0;g<f.length;g++){var h=f[g];return console.log("rule_1C. shoot"),this.shoot(e,h)}return null}),rule_1D:f(1,function(a,b){if(3===a.round)for(var c=this.playerPossibleUnits,d=0;d<c.length;d++)for(var e=c[d],f=this.enemyAssaultableUnits(a,b,e),g=0;g<f.length;g++){var h=f[g];return console.log("rule_1D. assault"),this.assault(e,h)}return null}),rule_1E:f(1,function(a,b){for(var c=this.playerPossibleUnits,d=0;d<c.length;d++)for(var e=c[d],f=this.enemyShootableUnits(a,b,e),g=0;g<f.length;g++){var h=f[g];return console.log("rule_1E. shoot"),this.shoot(e,h)}return null}),rule_1F:f(1,function(a,b){for(var c=this.playerPossibleUnits,d=0;d<c.length;d++){var e=c[d],f=this.enemyShootableUnits(a,b,e);if(0==f.length)for(var g=this.livingEnemyUnits(a,b),h=0;h<g.length;h++){var i=g[h];if(this.easiestToKill(g,i)){console.log("rule_1F. move");var j=this.getCloseTo(a,e,i);return j}}}return null})}),J=p.BasicRulePlayer_shoot=h(d.Player,{constructor:function(a){d.Player.call(this,a),m(this,a).array("rules",{defaultValue:[]}),this.__pendingActions__=[],this.rules=this.ownRules(),this.playerPossibleUnits=[],this.playerShootableUnits=[]},ownRules:function(){var a=this;return Object.keys(Object.getPrototypeOf(this)).map(function(b){return[a[b],1]}).filter(function(a){var b=a[0];return"function"==typeof b&&b.name&&"rule"===b.name.substr(0,4)})},decision:function(a,b){a.synchronizeMetagame(),this.playerPossibleUnits=this.possibleUnits(a,b),this.playerShootableUnits=this.allShootableUnits(a,b);var c,d;if(this.__pendingActions__.length<1)for(var e=0;e<this.rules.length;e++)if(c=this.rules[e],d=c[0].call(this,a,b))return d.forEach(function(a){a.__rule__=c}),this.__pendingActions__=this.__pendingActions__.concat(d),this.__pendingActions__.shift();return n(this.__pendingActions__.length<1,"No rule applied to game!"),this.__pendingActions__.shift()},"static __SERMAT__":{identifier:"BasicRulePlayer_shoot",serializer:function(a){return this.serializeAsProperties(a,["name","rules"])}},shoot:function(a,b){return[new u(a.id),new x(a.id,b.id)]},move:function(a,b,c){return c?[new u(a.id),b,new x(a.id,c.id)]:[new u(a.id),b,new v(a.id)]},possibleUnits:function ha(a,b){var c=this.armiesAndUnits(a,b)[1],ha=[];return c.forEach(function(a){a.isDead()||!a.isEnabled||a.isActive||ha.push(a)}),ha},shootableUnitsAux:function(a,b,c){var d=[],e=this.livingEnemyUnits(a,b),f=c.getShootActions(a);return f.forEach(function(a){e.forEach(function(b){a.targetId===b.id&&d.push(b)})}),d},allShootableUnits:function ia(a,b){for(var ia=[],c=this.playerPossibleUnits,d=0;d<c.length;d++){var e=c[d],f=[];f=this.shootableUnitsAux(a,b,e),ia[d]=[e,f]}return ia},enemyShootableUnits:function ja(a,b,c){for(var ja=[],d=0;d<this.playerShootableUnits.length;d++)this.playerShootableUnits[d][0]==c&&(ja=this.playerShootableUnits[d][1]);return ja},canShoot_:function(a,b,c,d){return!(b.isDead()||!b.isEnabled||c.isDead()||a.terrain.canShoot(b,c)==1/0)},livingEnemyUnits:function(a,b){var c=this.armiesAndUnits(a,b)[2];return c.livingUnits()},armiesAndUnits:function(a,b){var c=a.armies[b],d=c.units,e=a.opponent(b),f=a.armies[e],g=f.units;return[c,d,f,g]},easiestToKill:function(a,b){var c=k(a).map(function(a){return a.livingModels().length*a.defense}).max(0);return b.livingModels().length*b.defense===c},interForX:function(a,b,c,d){for(var e=[],f=c,g=a+1;g<b;g++)e.push([parseInt(g),parseInt(f)]),f+=d;return e},interForY:function(a,b,c,d){for(var e=[],f=c,g=a+1;g<b;g++)e.push([parseInt(f),parseInt(g)]),f+=d;return e},interpolation:function(a,b){var c,d,e=0,f=a[0],g=b[0],h=a[1],i=b[1],j=Math.min(f,g),k=Math.max(f,g),l=Math.min(h,i),m=Math.max(h,i);d=j===f?h:i,c=l===h?f:g;var n,o;return h===i?n=this.interForX(j,k,d,e):f===g?o=this.interForY(l,m,c,e):Math.abs(i-h)>=Math.abs(g-f)?(e=Math.abs(g-f)/Math.abs(i-h),o=this.interForY(l,m,c,e)):(e=Math.abs(i-h)/Math.abs(g-f),n=this.interForX(j,k,d,e))},getCloseTo:function(a,b,c){for(var d=this.interpolation(b.position,c.position),e=b.getMoveActions(a),f=[],g=0;g<e.length;g++){var h=e[g].position;d.forEach(function(a){h[0]===a[0]&&h[1]===a[1]&&f.push(e[g])})}for(var i=b.position,j=e[Math.floor(Math.random()*e.length)],k=0;k<f.length;k++){var l=f[k].position;a.terrain.distance(l,c.position)<a.terrain.distance(i,c.position)&&(i=l,j=f[k])}var m=this.move(b,j);return m},rule_100:f(100,function(a,b){for(var c=this.playerPossibleUnits,d=0;d<c.length;d++)for(var e=c[d],f=this.enemyShootableUnits(a,b,e),g=0;g<f.length;g++){var h=f[g];return console.log("rule_100. shoot"),this.shoot(e,h)}return null}),rule_1F:f(1,function(a,b){for(var c=this.playerPossibleUnits,d=0;d<c.length;d++){var e=c[d],f=this.enemyShootableUnits(a,b,e);if(0==f.length)for(var g=this.livingEnemyUnits(a,b),h=0;h<g.length;h++){var i=g[h];if(this.easiestToKill(g,i)){console.log("rule_1F. move");var j=this.getCloseTo(a,e,i);return j}}}return null})}),K=p.BasicRulePlayer_assault=h(d.Player,{constructor:function(a){d.Player.call(this,a),m(this,a).array("rules",{defaultValue:[]}),this.__pendingActions__=[],this.rules=this.ownRules(),this.playerPossibleUnits=[],this.playerAssaultableUnits=[]},ownRules:function(){var a=this;return Object.keys(Object.getPrototypeOf(this)).map(function(b){return[a[b],1]}).filter(function(a){var b=a[0];return"function"==typeof b&&b.name&&"rule"===b.name.substr(0,4)})},decision:function(a,b){a.synchronizeMetagame(),this.playerPossibleUnits=this.possibleUnits(a,b),this.playerAssaultableUnits=this.allAssaultableUnits(a,b);var c,d;if(this.__pendingActions__.length<1)for(var e=0;e<this.rules.length;e++)if(c=this.rules[e],d=c[0].call(this,a,b))return d.forEach(function(a){a.__rule__=c}),this.__pendingActions__=this.__pendingActions__.concat(d),this.__pendingActions__.shift();return n(this.__pendingActions__.length<1,"No rule applied to game!"),this.__pendingActions__.shift()},"static __SERMAT__":{identifier:"BasicRulePlayer_assault",serializer:function(a){return this.serializeAsProperties(a,["name","rules"])}},assault:function(a,b){return[new u(a.id),new y(a.id,b.id)]},move:function(a,b,c){return c?[new u(a.id),b,new x(a.id,c.id)]:[new u(a.id),b,new v(a.id)]},possibleUnits:function ka(a,b){var c=this.armiesAndUnits(a,b)[1],ka=[];return c.forEach(function(a){a.isDead()||!a.isEnabled||a.isActive||ka.push(a)}),ka},assaultableUnits:function la(a,b,c){var la=[],d=this.livingEnemyUnits(a,b),e=c.getAssaultActions(a);return e.forEach(function(a){d.forEach(function(b){a.targetId===b.id&&la.push(b)})}),la},allAssaultableUnits:function ma(a,b){for(var ma=[],c=this.playerPossibleUnits,d=0;d<c.length;d++){var e=c[d],f=[];f=this.assaultableUnits(a,b,e),ma[d]=[e,f]}return ma},enemyAssaultableUnits:function na(a,b,c){for(var na=[],d=0;d<this.playerAssaultableUnits.length;d++)this.playerAssaultableUnits[d][0]==c&&(na=this.playerAssaultableUnits[d][1]);return na},canAssault:function(a,b,c){return!(b.isDead()||!b.isEnabled||c.isDead()||!(a.terrain.canShoot(b,c)<=12))},livingEnemyUnits:function(a,b){var c=this.armiesAndUnits(a,b)[2];return c.livingUnits()},armiesAndUnits:function(a,b){var c=a.armies[b],d=c.units,e=a.opponent(b),f=a.armies[e],g=f.units;return[c,d,f,g]},rule_100:f(100,function(a,b){for(var c=this.playerPossibleUnits,d=0;d<c.length;d++)for(var e=c[d],f=this.enemyAssaultableUnits(a,b,e),g=0;g<f.length;g++){var h=f[g];return console.log("rule_100. assault"),this.assault(e,h)}return null}),rule_1:f(1,function(a,b){for(var c=this.playerPossibleUnits,d=0;d<c.length;d++){var e=c[d],f=e.getMoveActions(a),g=this.move(e,f[Math.floor(Math.random()*f.length)]);return console.log("rule_1. move"),g}return null})}),L=p.BasicRulePlayer_assist=h(d.Player,{constructor:function(a){d.Player.call(this,a),m(this,a).array("rules",{defaultValue:[]}),this.__pendingActions__=[],this.rules=this.ownRules(),this.playerPossibleUnits=[],this.playerShootableUnits=[],this.playerAssaultableUnits=[]},ownRules:function(){var a=this;return Object.keys(Object.getPrototypeOf(this)).map(function(b){return[a[b],1]}).filter(function(a){var b=a[0];return"function"==typeof b&&b.name&&"rule"===b.name.substr(0,4)})},decision:function(a,b){a.synchronizeMetagame(),this.playerPossibleUnits=this.possibleUnits(a,b),this.playerShootableUnits=this.allShootableUnits(a,b),this.playerAssaultableUnits=this.allAssaultableUnits(a,b);var c,d;if(this.__pendingActions__.length<1)for(var e=0;e<this.rules.length;e++)if(c=this.rules[e],d=c[0].call(this,a,b))return d.forEach(function(a){a.__rule__=c}),this.__pendingActions__=this.__pendingActions__.concat(d),this.__pendingActions__.shift();return n(this.__pendingActions__.length<1,"No rule applied to game!"),this.__pendingActions__.shift()},"static __SERMAT__":{identifier:"BasicRulePlayer_assist",serializer:function(a){return this.serializeAsProperties(a,["name","rules"])}},shoot:function(a,b){return[new u(a.id),new x(a.id,b.id)]},assault:function(a,b){return[new u(a.id),new y(a.id,b.id)]},move:function(a,b,c){return c?[new u(a.id),b,new x(a.id,c.id)]:[new u(a.id),b,new v(a.id)]},assistAux:function(a,b,c,d,e){for(var f=0;f<c.length;f++){var g=c[f];if(this.canAssault(a,d,g))return this.assault(d,g);var h;if(this.canBlockSight(a,d,e,g)){var i=this.blockSightMovements(a,d,e,g);h=i[Math.floor(Math.random()*i.length)]}if(this.canShoot_(a,d,g,!0))return h?this.move(d,h,g):this.shoot(d,g);if(h)return this.move(d,h)}return null},assist:function(a,b,c,d){var e=this.mostDangerousUnits(a,b,d),f=this.assistAux(a,b,e,c,d);if(f)return f;var g=this.dangerousUnits(a,b,d),h=this.assistAux(a,b,g,c,d);if(h)return h;console.log("no asiste cuando deberia");var i=c.getMoveActions(a),j=this.move(c,i[Math.floor(Math.random()*i.length)]);return j},possibleUnits:function oa(a,b){var c=this.armiesAndUnits(a,b)[1],oa=[];return c.forEach(function(a){a.isDead()||!a.isEnabled||a.isActive||oa.push(a)}),oa},shootableUnitsAux:function(a,b,c){var d=[],e=this.livingEnemyUnits(a,b),f=c.getShootActions(a);return f.forEach(function(a){e.forEach(function(b){a.targetId===b.id&&d.push(b)})}),d},allShootableUnits:function pa(a,b){for(var pa=[],c=this.playerPossibleUnits,d=0;d<c.length;d++){var e=c[d],f=[];f=this.shootableUnitsAux(a,b,e),pa[d]=[e,f]}return pa},enemyShootableUnits:function qa(a,b,c){for(var qa=[],d=0;d<this.playerShootableUnits.length;d++)this.playerShootableUnits[d][0]==c&&(qa=this.playerShootableUnits[d][1]);return qa},assaultableUnits:function ra(a,b,c){var ra=[],d=this.livingEnemyUnits(a,b),e=c.getAssaultActions(a);return e.forEach(function(a){d.forEach(function(b){a.targetId===b.id&&ra.push(b)})}),ra},allAssaultableUnits:function sa(a,b){for(var sa=[],c=this.playerPossibleUnits,d=0;d<c.length;d++){var e=c[d],f=[];f=this.assaultableUnits(a,b,e),sa[d]=[e,f]}return sa},enemyAssaultableUnits:function ta(a,b,c){for(var ta=[],d=0;d<this.playerAssaultableUnits.length;d++)this.playerAssaultableUnits[d][0]==c&&(ta=this.playerAssaultableUnits[d][1]);return ta},canShoot_:function(a,b,c,d){return!(b.isDead()||!b.isEnabled||c.isDead()||a.terrain.canShoot(b,c)==1/0)},canAssault:function(a,b,c){return!(b.isDead()||!b.isEnabled||c.isDead()||!(a.terrain.canShoot(b,c)<=12))},interForX:function(a,b,c,d){for(var e=[],f=c,g=a+1;g<b;g++)e.push([parseInt(g),parseInt(f)]),f+=d;return e},interForY:function(a,b,c,d){for(var e=[],f=c,g=a+1;g<b;g++)e.push([parseInt(f),parseInt(g)]),f+=d;return e},interpolation:function(a,b){var c,d,e=0,f=a[0],g=b[0],h=a[1],i=b[1],j=Math.min(f,g),k=Math.max(f,g),l=Math.min(h,i),m=Math.max(h,i);d=j===f?h:i,c=l===h?f:g;var n,o;return h===i?n=this.interForX(j,k,d,e):f===g?o=this.interForY(l,m,c,e):Math.abs(i-h)>=Math.abs(g-f)?(e=Math.abs(g-f)/Math.abs(i-h),o=this.interForY(l,m,c,e)):(e=Math.abs(i-h)/Math.abs(g-f),n=this.interForX(j,k,d,e))},blockSightMovements:function(a,b,c,d){for(var e=c.position,f=d.position,g=this.interpolation(e,f),h=[],i=b.getMoveActions(a),j=0;j<i.length;j++){var k=i[j].position;g.forEach(function(a){k[0]===a[0]&&k[1]===a[1]&&h.push(i[j])})}return h},canBlockSight:function(a,b,c,d){return this.blockSightMovements(a,b,c,d).length>0},canAssist:function ua(a,b,c,d){for(var e=this.dangerousUnits(a,b,d),ua=!1,f=0;f<e.length;f++){var g=e[f];if(!(this.canBlockSight(a,c,d,g)||this.canShoot_(a,c,g,!0)||this.canAssault(a,c,g))){ua=!1;break}ua=!0}return ua},mostDangerousUnits:function(a,b,c){for(var d=this.livingEnemyUnits(a,b),e=[],f=0;f<d.length;f++){var g=d[f];this.canKill(a,g,c)&&e.push(g)}return e},dangerousUnits:function(a,b,c){for(var d=this.livingEnemyUnits(a,b),e=[],f=0;f<d.length;f++){var g=d[f];(this.canShoot_(a,g,c,!0)||this.canAssault(a,g,c))&&e.push(g)}return e},canBeKilled:function(a,b,c){for(var d=this.armiesAndUnits(a,b)[3],e=0;e<d.length;e++)if(this.canKill(a,d[e],c))return!0;return!1},canKill:function(a,b,c){return!(b.isDead()||!b.isEnabled||c.isDead()||!this.canKillShooting(a,b,c)&&!this.canKillAssaulting(a,b,c))},canKillShooting:function(a,b,c){return!(b.isDead()||c.isDead()||!b.isEnabled||!(this.bestAttackResultShooting(a,b,c)>=100))},canKillAssaulting:function(a,b,c){return!(b.isDead()||c.isDead()||!b.isEnabled||!(this.bestAttackResultAssaulting(a,b,c)>=100))},bestAttackResult:function va(a,b,c){if(!b.isDead()&&b.isEnabled&&!c.isDead()){var d=this.bestAttackResultShooting(a,b,c),e=this.bestAttackResultAssaulting(a,b,c),va=Math.max(d,e);return va}return 0},bestAttackResultShooting:function(a,b,c){if(!b.isDead()&&b.isEnabled&&!c.isDead()){var d=a.terrain.distance(b.position,c.position),e=b.livingModels(),f=0;e.forEach(function(a){a.equipments.forEach(function(a){a.range>=d&&(f+=a.attacks)})});var g=c.livingModels().length,h=100*f/g;return h>100&&(h=100),h}return 0},bestAttackResultAssaulting:function(a,b,c){if(!b.isDead()&&b.isEnabled&&!c.isDead()&&this.canAssault(a,b,c)){var d=0,e=b.livingModels();e.forEach(function(a){a.equipments.forEach(function(a){0===a.range&&(d+=a.attacks)})});var f=c.livingModels().length,g=100*d/f;return g>100&&(g=100),g}return 0},shootingKillableUnits:function wa(a,b,c){for(var wa=[],d=this.shootableUnitsAux(a,b,c),e=0;e<d.length;e++){var f=d[e];this.willKillShooting(a,c,f)&&wa.push(f)}return wa},livingEnemyUnits:function(a,b){var c=this.armiesAndUnits(a,b)[2];return c.livingUnits()},armiesAndUnits:function(a,b){var c=a.armies[b],d=c.units,e=a.opponent(b),f=a.armies[e],g=f.units;return[c,d,f,g]},rule_100:f(100,function(a,b){for(var c=this.playerPossibleUnits,d=this.armiesAndUnits(a,b)[1],e=0;e<c.length;e++)for(var f=c[e],g=0;g<d.length;g++){var h=d[g];if(this.canAssist(a,b,f,h))return console.log("rule_100. assist"),this.assist(a,b,f,h)}return null}),rule_1:f(1,function(a,b){for(var c=this.playerPossibleUnits,d=0;d<c.length;d++){var e=c[d],f=e.getMoveActions(a),g=this.move(e,f[Math.floor(Math.random()*f.length)]);return console.log("rule_1. move"),g}return null})}),M=p.BasicRulePlayer_scape_then_shoot=h(d.Player,{constructor:function(a){d.Player.call(this,a),m(this,a).array("rules",{defaultValue:[]}),this.__pendingActions__=[],this.rules=this.ownRules(),this.playerPossibleUnits=[],this.playerShootableUnits=[]},ownRules:function(){var a=this;return Object.keys(Object.getPrototypeOf(this)).map(function(b){return[a[b],1]}).filter(function(a){var b=a[0];return"function"==typeof b&&b.name&&"rule"===b.name.substr(0,4)})},decision:function(a,b){a.synchronizeMetagame(),this.playerPossibleUnits=this.possibleUnits(a,b),this.playerShootableUnits=this.allShootableUnits(a,b);var c,d;if(this.__pendingActions__.length<1)for(var e=0;e<this.rules.length;e++)if(c=this.rules[e],d=c[0].call(this,a,b))return d.forEach(function(a){a.__rule__=c}),this.__pendingActions__=this.__pendingActions__.concat(d),this.__pendingActions__.shift();return n(this.__pendingActions__.length<1,"No rule applied to game!"),this.__pendingActions__.shift()},"static __SERMAT__":{identifier:"BasicRulePlayer_scape_then_shoot",serializer:function(a){return this.serializeAsProperties(a,["name","rules"])}},shoot:function(a,b){return[new u(a.id),new x(a.id,b.id)]},move:function(a,b,c){return c?[new u(a.id),b,new x(a.id,c.id)]:[new u(a.id),b,new v(a.id)]},scapeAux:function(a,b,c,d){for(var e=0;e<c.length;e++){var f=c[e],g=[];if(this.canHide(a,d,f)){for(var h=this.hideMoves(a,d,f),i=0;i<h.length;i++)if(a.terrain.distance(f.position,h[i].position)<=f.maxRange()+6)return this.move(d,h[i]);g=g.concat(h)}if(this.canRun(a,d,f)){for(var j=this.runMoves(a,d,f),k=0;k<j.length;k++)if(a.terrain.distance(f.position,j[k].position)<=f.maxRange()+6)return this.move(d,j[k]);g=g.concat(j)}if(g.length>0)return this.move(d,g[Math.floor(Math.random()*g.length)])}},scape:function(a,b,c){var d=this.mostDangerousUnits(a,b,c),e=this.scapeAux(a,b,d,c);if(e)return e;var f=(this.dangerousUnits(a,b,c),this.scapeAux(a,b,d,c));if(f)return f;console.log("no escapa cuando deberia");var g=c.getMoveActions(a),h=this.move(c,g[Math.floor(Math.random()*g.length)]);return h},possibleUnits:function xa(a,b){var c=this.armiesAndUnits(a,b)[1],xa=[];return c.forEach(function(a){a.isDead()||!a.isEnabled||a.isActive||xa.push(a)}),xa},shootableUnitsAux:function(a,b,c){var d=[],e=this.livingEnemyUnits(a,b),f=c.getShootActions(a);return f.forEach(function(a){e.forEach(function(b){a.targetId===b.id&&d.push(b)})}),d},allShootableUnits:function ya(a,b){for(var ya=[],c=this.playerPossibleUnits,d=0;d<c.length;d++){var e=c[d],f=[];f=this.shootableUnitsAux(a,b,e),ya[d]=[e,f]}return ya},enemyShootableUnits:function za(a,b,c){for(var za=[],d=0;d<this.playerShootableUnits.length;d++)this.playerShootableUnits[d][0]==c&&(za=this.playerShootableUnits[d][1]);return za},canShoot_:function(a,b,c,d){return!(b.isDead()||!b.isEnabled||c.isDead()||a.terrain.canShoot(b,c)==1/0)},canRun:function(a,b,c){var d=c.maxRange()+6;return!(b.isEnabled&&a.terrain.canShoot(c,b)<=d)},canHide:function(a,b,c){return!1},runMoves:function(a,b,c){for(var d=c.position,e=b.position,f=b.getMoveActions(a),g=f[Math.floor(Math.random()*f.length)],h=0;h<f.length;h++){var i=f[h].position;a.terrain.distance(i,d)>a.terrain.distance(e,d)&&(e=i,g=f[h])}return a.terrain.distance(c.position,e)<=c.maxRange()+6?(console.log("run y puede huir"),[g]):(console.log("run y huyo lo maximo q pudo pero igual lo alcanzan"),[g])},hideMoves:function(a,b,c){return[]},canScape:function Aa(a,b,c){var d=this.mostDangerousUnits(a,b,c);if(0===d.length)return!1;for(var Aa=!0,e=0;e<d.length;e++){var f=d[e];this.canRun(a,c,f)||this.canHide(a,c,f)||(Aa=!1)}return Aa},mostDangerousUnits:function(a,b,c){for(var d=this.livingEnemyUnits(a,b),e=[],f=0;f<d.length;f++){var g=d[f];
this.canKill(a,g,c)&&e.push(g)}return e},dangerousUnits:function(a,b,c){for(var d=this.livingEnemyUnits(a,b),e=[],f=0;f<d.length;f++){var g=d[f];(this.canShoot_(a,g,c,!0)||this.canAssault(a,g,c))&&e.push(g)}return e},canBeKilled:function(a,b,c){for(var d=this.armiesAndUnits(a,b)[3],e=0;e<d.length;e++)if(this.canKill(a,d[e],c))return!0;return!1},canKill:function(a,b,c){return!(b.isDead()||!b.isEnabled||c.isDead()||!this.canKillShooting(a,b,c)&&!this.canKillAssaulting(a,b,c))},canKillShooting:function(a,b,c){return!(b.isDead()||c.isDead()||!b.isEnabled||!(this.bestAttackResultShooting(a,b,c)>=100))},canKillAssaulting:function(a,b,c){return!(b.isDead()||c.isDead()||!b.isEnabled||!(this.bestAttackResultAssaulting(a,b,c)>=100))},bestAttackResult:function Ba(a,b,c){if(!b.isDead()&&b.isEnabled&&!c.isDead()){var d=this.bestAttackResultShooting(a,b,c),e=this.bestAttackResultAssaulting(a,b,c),Ba=Math.max(d,e);return Ba}return 0},bestAttackResultShooting:function(a,b,c){if(!b.isDead()&&b.isEnabled&&!c.isDead()){var d=a.terrain.distance(b.position,c.position),e=b.livingModels(),f=0;e.forEach(function(a){a.equipments.forEach(function(a){a.range>=d&&(f+=a.attacks)})});var g=c.livingModels().length,h=100*f/g;return h>100&&(h=100),h}return 0},bestAttackResultAssaulting:function(a,b,c){if(!b.isDead()&&b.isEnabled&&!c.isDead()&&this.canAssault(a,b,c)){var d=0,e=b.livingModels();e.forEach(function(a){a.equipments.forEach(function(a){0===a.range&&(d+=a.attacks)})});var f=c.livingModels().length,g=100*d/f;return g>100&&(g=100),g}return 0},livingEnemyUnits:function(a,b){var c=this.armiesAndUnits(a,b)[2];return c.livingUnits()},armiesAndUnits:function(a,b){var c=a.armies[b],d=c.units,e=a.opponent(b),f=a.armies[e],g=f.units;return[c,d,f,g]},rule_100:f(100,function(a,b){for(var c=this.playerPossibleUnits,d=0;d<c.length;d++){var e=c[d];if(this.canScape(a,b,e))return console.log("rule_100. scape"),this.scape(a,b,e)}return null}),rule_2:f(2,function(a,b){for(var c=this.playerPossibleUnits,d=0;d<c.length;d++)for(var e=c[d],f=this.enemyShootableUnits(a,b,e),g=0;g<f.length;g++){var h=f[g];return console.log("rule_2. shoot"),this.shoot(e,h)}return null}),rule_1:f(1,function(a,b){for(var c=this.playerPossibleUnits,d=0;d<c.length;d++){var e=c[d],f=e.getMoveActions(a),g=this.move(e,f[Math.floor(Math.random()*f.length)]);return console.log("rule_1. move"),g}return null})});p.Renderer=h({constructor:function(a){a=this.canvas=a||document.getElementById("wargame-canvas");var b=this.ctx=a.getContext("2d");b.fillStyle="white"},renderScope:function(a,b,c){var d=this.canvas,e=this.ctx;e.save(),e.scale(d.width/a,d.height/b);try{c.call(this,e)}finally{e.restore()}},render:function(a){var b=a.terrain;this.renderScope(b.width,b.height,function(c){c.clearRect(0,0,this.canvas.width,this.canvas.height);for(var d=0,e=b.width;d<e;d++)for(var f=0,g=b.height;f<g;f++)b.isPassable([d,f])?this.drawSquare(d,f,1,1,"#CCCCCC"):this.drawSquare(d,f,1,1,"black");var h=this,i=a.armies;c.strokeStyle="black",c.font="1px Arial";for(var j in i)i[j].units.forEach(function(a){a.isDead()||(h.drawSquare(a.position[0],a.position[1],1,1,a.army.player),c.fillStyle="black",c.fillText(a.id,a.position[0],a.position[1]))})})},renderSight:function(a,b){if(b=b||a.__activeUnit__){var c=a.terrain;this.renderScope(c.width,c.height,function(a){var d,e,f=b.maxRange(),g=c.areaOfSight(b,f);for(var h in g)d=.8*(1-g[h]/f)+.2,e=h.split(","),this.drawSquare(+e[0],+e[1],1,1,"rgba(255,255,0,"+d+")")})}},renderMoves:function(a,b){var c=this.canvas,d=this.ctx,e=a.terrain;e.world;this.render(a),d.save(),d.scale(c.width/e.WorldWidth,c.height/e.WorldHeight);for(var f in b)b[f].forEach(function(a){a.constructor==w&&(d.save(),d.fillStyle="#32CD32",d.beginPath(),d.arc(a.position[0],a.position[1],1,0,2*Math.PI),d.fill(),d.restore())});d.restore()},drawSquare:function(a,b,c,d,e){var f=this.ctx;f.fillStyle=e,f.fillRect(a,b,1,1)},renderInfluence:function(a,b){var c=a.terrain;this.renderScope(c.width,c.height,function(c){var d,e,f,g,h,i=b.length,j=b[0].length,k=(this.canvas,a.terrain),l=(k.world,Number.POSITIVE_INFINITY),m=Number.NEGATIVE_INFINITY,n=k.width,o=k.height;for(c.clearRect(0,0,this.canvas.width,this.canvas.height),g=0,n;g<n;g++)for(h=0,o;h<o;h++)k.isPassable([g,h])?this.drawSquare(g,h,1,1,"#CCCCCC"):this.drawSquare(g,h,1,1,"black");for(g=0;g<i;g++)for(h=0;h<j;h++)isNaN(b[g][h])||(m=Math.max(m,b[g][h]),l=Math.min(l,b[g][h]));for(e=Math.max(m,Math.abs(l)),g=0;g<i;g++)for(h=0;h<j;h++)d=b[g][h],"t"==d?this.drawSquare(g,h,1,1,"black"):d>0?(f=d/e,this.drawSquare(g,h,1,1,"rgba(255,0,0,"+f+")")):d<0&&(f=-d/e,this.drawSquare(g,h,1,1,"rgba(0,0,255,"+f+")"))})}});var N=p.StrategicAttackAction=h(t,{constructor:function(a,b){this.unitId=a,this.targetId=b},executeMovement:function(a,b,c){var d=a.activePlayer(),e=this.unitById(a,this.unitId),f=this.unitById(a,this.targetId),g=b.filter(function(b){return b instanceof w&&(b.__distance__=a.terrain.distance(b.position,f.position),!0)}),h=g.filter(function(b){return b.__range__=a.terrain.canShoot(e,f),b.__range__!==1/0});return h.length>0?(h.sort(function(a,b){return a.__range__-b.__range__}),a.next(o(d,h[0]),null,c)):(g.sort(function(a,b){return a.__distance__-b.__distance__}),a.next(o(d,g[0]),null,c))},getShots:function(a,b){var c=this;return b=b||a.moves()[a.activePlayer()],b.filter(function(a){return a instanceof x&&a.targetId===c.targetId})},execute:function(a,b){var c=a.concreteGame,d=this.unitById(c,this.unitId),e=this.unitById(c,this.targetId),f=c.activePlayer();c=c.next(o(f,new u(this.unitId)),null,b);var g=c.moves()[f],h=c.terrain.canShoot(d,e);this.getShots(c,g);return h||(c=this.executeMovement(c,g,b),c.__activeUnit__&&c.__activeUnit__.id===attack.unitId&&(h=c.terrain.canShoot(shooter,e))),h&&(c=c.next(o(f,new x(d.id,e.id))),c.isContingent&&(c=c.randomNext())),c.__activeUnit__&&c.__activeUnit__.id===attack.unitId&&(c=c.next(o(f,new v(d.id)),null,b)),n(!(c instanceof D),"Executing action ",this," did not yield a Wargame instance!"),a.concreteGame=c,a},"static __SERMAT__":{identifier:"StrategicAttackAction",serializer:function(a){return[a.unitId,a.targetId]}},toString:function(){return c.ser(this)}}),O=p.AbstractedWargame=h(d.Game,{constructor:function(a){n(!(a instanceof D),"Invalid concrete wargame ",a,"!"),this.players=a.players,d.Game.call(this,a.activePlayer()),this.concreteGame=a},result:function(){return this.concreteGame.result()},moves:function(){if(this.result())return null;var a=this.concreteGame,b=this.activePlayer(),c={};return c[b]=l.product(a.armies[b].units.filter(function(b){return!b.isDead(a)&&b.isEnabled}),a.armies[a.opponent()].units.filter(function(a){return!a.isDead()})).mapApply(function(a,b){return new N(a.id,b.id)}).toArray(),c},next:function(a,b,d){var e=d?this:c.clone(this),f=this.activePlayer(),g=a[f];return g.execute(e,d),e.activePlayers=e.concreteGame.activePlayers,e},"static __SERMAT__":{identifier:"AbstractedWargame",serializer:function(a){return[a.concreteGame]}}});return[].forEach(function(a){a.__SERMAT__.identifier=p.__package__+"."+a.__SERMAT__.identifier,p.__SERMAT__.include.push(a)}),c.include(p),p});
//# sourceMappingURL=ludorum-wargame.min.js.map