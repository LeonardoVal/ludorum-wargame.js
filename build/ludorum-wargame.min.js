//! ludorum-wargame 0.0.1

(function(t){"use strict";"function"==typeof define&&define.amd?define(["creatartis-base","sermat","ludorum"],t):"object"==typeof exports&&module.exports?module.exports=t(require("creatartis-base"),require("sermat"),require("ludorum")):this["ludorum-wargame"]=t(this.base,this.Sermat,this.ludorum)}).call(this,function t(n,s,e){"use strict";var r=n.declare,o=n.iterable,a=n.Iterable,l=n.initialize,h=n.raiseIf,u=n.obj,c={__package__:"ludorum-wargame",__name__:"ludorum_wargame",__init__:t,__dependencies__:[n,s,e],__SERMAT__:{include:[n]}},f=c.Army=r({constructor:function(t){var n=this;l(this,t).string("player",{ignore:!0}).number("score",{coerce:!0,defaultValue:0}).array("units"),this.units&&this.units.forEach(function(t,i){t.id=n.player+"#"+i,t.army=n})},isEnabled:function(){for(var t=0,n=this.units.length;t<n;t++)if(this.units[t].isEnabled)return!0;return!1},startRound:function(){return this.units.filter(function(t){return t.startRound()}).length},actions:function(t){var n=t.activeUnit();return n?n.getActions(t):this.units.filter(function(t){return t.isEnabled}).map(function(t){return new m(t.id)})},isEliminated:function(t){return this.units.filter(function(t){return!t.isDead()}).length<=0},livingUnits:function(){return this.units.filter(function(t){return!t.isDead()})},worth:function(){return o(this.units).map(function(t){return t.worth()}).sum()},"static __SERMAT__":{serializer:function(t){return[{player:t.player,units:t.units,score:t.score}]}}}),v=c.Unit=r({radius:.5,quality:3,defense:4,constructor:function(t){l(this,t).array("position").array("models").bool("isActive",{ignore:!0}).bool("hasMoved",{ignore:!0}).bool("isEnabled",{ignore:!0})},cost:function(){return o(this.models).map(function(t){return t.cost||0}).sum()},size:function(){return this.models.length},livingModels:function(){return this.models.filter(function(t){return t.health()>0})},health:function(){return this.livingModels().length},isDead:function(){return this.health()<=0},worth:function(){return o(this.models).map(function(t){return t.health()/t.toughness*t.cost}).sum()},getActions:function(t){var n=[new y(this.id)];return this.isActive&&(this.hasMoved||(n=n.concat(this.getMoveActions(t))),n=n.concat(this.getShootActions(t))),n},maxRange:function(){var t=-1/0;return this.livingModels().forEach(function(n){n.equipments.forEach(function(n){+n.range>t&&(t=+n.range)})}),t},getShootActions:function(t){var n=this;return t.armies[t.opponent()].units.filter(function(i){return t.terrain.canShoot(n,i)!=1/0}).map(function(t){return new U(n.id,t.id)})},getAssaultActions:function(t){var n=this;return t.armies[t.opponent()].units.filter(function(i){return t.terrain.canShoot(n,i)<=12}).map(function(t){return new b(n.id,t.id)})},getMoveActions:function(t){var n=this;return o(t.terrain.reachablePositions(n)).mapApply(function(t,i){var s=t.split(",");return new _(n.id,[+s[0],+s[1]],i>6)}).toArray()},startRound:function(){return this.isActive=!1,this.hasMoved=!1,this.isEnabled=this.health()>0,this.isEnabled},activate:function(t){h(!this.isEnabled,"Unit ",this.id," is not enabled!"),h(this.isActive,"Unit ",this.id," is already active!"),h(this.health()<=0,"Unit ",this.id," has been eliminated!"),this.isActive=!0,t.__activeUnit__=this},endTurn:function(t){this.isActive=!1,this.isEnabled=!1,t.__activeUnit__===this&&(t.__activeUnit__=null)},move:function(t,n,i){h(!this.isActive,"Unit ",this.id," is not active!"),this.position=n,this.hasMoved=!0,i&&this.endTurn(t)},suffer:function(t,n){var i,s,e,r=this.models;for(e=0;n>0&&e<r.length&&!((s=(i=r[e]).health())>0&&(i.wounds+=Math.min(n,s),(n-=s)<=0));e++);return this.isEnabled=this.isEnabled&&!this.isDead(),this.isEnabled},influence:function(t){},"static __SERMAT__":{serializer:function(t){var n={position:[t.position[0],t.position[1]],models:t.models};return["isActive","hasMoved","isEnabled"].forEach(function(i){t.hasOwnProperty(i)&&(n[i]=t[i])}),[n]}}}),d=c.Model=r({toughness:1,equipments:[],constructor:function(t){this.wounds=0|t},health:function(){return this.toughness-this.wounds},shooting:function(t){return t=t||1,equipments.filter(function(n){return n.range>=t})},melee:function(){return equipments.filter(function(t){return t.range<1})},"static __SERMAT__":{serializer:function(t){return[t.wounds]}}}),p=c.GameAction=r({aleatories:function(t){return null},execute:n.objects.unimplemented("GameAction","execute(game, haps)"),unitById:function(t,n){n=n||this.unitId;for(var i=null,s=0;!i&&s<t.players.length;s++)for(var e=t.armies[t.players[s]].units,r=0;r<e.length;r++)if(e[r].id==n){i=e[r];break}return h(!i,"Unit ",n," was not found!"),i},worth:function(){return 0},toString:function(){return s.ser(this)}}),m=c.ActivateAction=r(p,{constructor:function(t){this.unitId=t},execute:function(t){this.unitById(t).activate(t)},"static __SERMAT__":{identifier:"ActivateAction",serializer:function(t){return[t.unitId]}}}),y=c.EndTurnAction=r(p,{constructor:function(t){this.unitId=t},execute:function(t){this.unitById(t).endTurn(t)},"static __SERMAT__":{identifier:"EndTurnAction",serializer:function(t){return[t.unitId]}}}),_=c.MoveAction=r(p,{constructor:function(t,n,i){this.unitId=t,this.position=n,this.run=i},execute:function(t){this.unitById(t).move(t,this.position,this.run)},"static __SERMAT__":{identifier:"MoveAction",serializer:function(t){return[t.unitId,Array.apply(Array,t.position),t.run]}}}),U=c.ShootAction=r(p,{constructor:function(t,n){this.unitId=t,this.targetId=n},aleatories:function(t){var n=this.unitById(t),i=this.unitById(t,this.targetId),s=t.terrain.distance(n.position,i.position),e=0;return n.models.forEach(function(t){t.equipments.forEach(function(t){t.range>=s&&(e+=t.attacks)})}),{wounds:new E(n.quality,i.defense,e)}},execute:function(t,n){var i=n.wounds,s=this.unitById(t,this.targetId);if(i>0){var e=s.worth();s.suffer(t,i),this.worth=e-s.worth()}this.unitById(t,this.unitId).endTurn(t)},"static __SERMAT__":{identifier:"ShootAction",serializer:function(t){return[t.unitId,t.targetId]}}});var b=c.AssaultAction=r(p,{constructor:function(t,n){this.unitId=t,this.targetId=n},aleatories:function(t){var n=this.unitById(t),i=this.unitById(t,this.targetId),s=0;t.terrain.canShoot(n,i)<=12&&n.models.forEach(function(t){t.equipments.forEach(function(t){s+=t.attacks})});var e=i.defense,r=new E(n.quality,e,s),o=0;return i.models.forEach(function(t){t.equipments.forEach(function(t){o+=t.attacks})}),{wounds:r,enemyWounds:new E(i.quality,n.defense,o)}},execute:function(t,n){var i=n.wounds,s=this.unitById(t,this.targetId),e=this.unitById(t,this.unitId);this.worth=0,i>0&&s.suffer(t,i),s.isDead(t)&&(this.worth+=s.cost()),this.worth+=s.cost()*i/s.size();var r=n.enemyWounds,o=s.livingModels().length;(r=Math.round(o*r/s.size()))>0&&e.suffer(t,r),e.isDead(t)&&(this.worth-=e.cost()),this.worth-=e.cost()*r/e.size();var a,l,h=(a=e.position,l=s.position,a[0]<l[0]?[l[0]-1,l[1]]:a[0]>l[0]?[l[0]+1,l[1]]:a[1]<l[1]?[l[0],l[1]-1]:a[1]>=l[1]?[l[0],l[1]+1]:void 0);this.unitById(t).move(t,h,!1),this.unitById(t,this.unitId).endTurn(t)},"static __SERMAT__":{identifier:"AssaultAction",serializer:function(t){return[t.unitId,t.targetId]}}}),A=n.math.combinations,S=c.rolls=function(t,n){return n<=0?[1]:a.range(n+1).map(function(i){return Math.pow(t,i)*Math.pow(1-t,n-i)*A(n,i)}).toArray()},w=c.rerolls=function(t,n){var i=a.repeat(0,n.length).toArray();return n.forEach(function(n,s){0===s?i[0]+=n:S(t,s).forEach(function(t,s){i[s]+=n*t})}),i},E=(c.addRolls=function(t,n){var i=t.length,s=n.length;return a.range(i+s-1).map(function(e){return a.range(e+1).filter(function(t){return t<i&&e-t<s},function(i){return t[i]*n[e-i]}).sum()}).toArray()},c.ShootAleatory=r(e.aleatories.Aleatory,{constructor:function(t,n,i){this.shooterQuality=0|t,this.targetDefense=0|n,this.attackCount=0|i,this.__hitProb__=Math.max(0,Math.min(1,(6-t+1)/6)),this.__saveProb__=Math.max(0,Math.min(1,(6-n+1)/6));var s=w(this.__saveProb__,S(this.__hitProb__,i));this.__distribution__=o(s).map(function(t,n){return[n,t]}).toArray()},distribution:function(){return o(this.__distribution__)},value:function(t){return(t||n.Randomness.DEFAULT).weightedChoice(this.__distribution__)},"static __SERMAT__":{identifier:"ShootAleatory",serializer:function(t){return[t.shooterQuality,t.targetDefense,t.attackCount]}}})),P=(c.MoralAleatory=r(e.aleatories.Aleatory,{constructor:function(t){this.quality=0|t,this.__prob__=Math.max(0,Math.min(1,(6-t+1)/6));var n=w(this.__saveProb__,S(this.__hitProb__,attackCount));this.__distribution__=o(n).map(function(t,n){return[n,t]}).toArray()},distribution:function(){return o(this.__distribution__)},value:function(t){return(t||n.Randomness.DEFAULT).weightedChoice(this.__distribution__)},"static __SERMAT__":{identifier:"MoralAleatory",serializer:function(t){return[t.quality]}}}),c.Wargame=r(e.Game,{name:"Wargame",players:["Red","Blue"],rounds:4,constructor:function(t){e.Game.call(this,t.activePlayer||this.players[0]),l(this,t).object("armies").object("terrain").integer("round",{coerce:!0,defaultValue:-1}).number("rounds",{coerce:!0,ignore:!0}).object("__activeUnit__",{ignore:!0}),this.round<0?this.nextRound():this.nextTurn()},nextTurn:function(){var t=this.activePlayer();if(!this.armies[t].isEnabled()){var n=(this.players.indexOf(t)+1)%this.players.length;this.activePlayers=[this.players[n]],n||this.nextRound()}return this},nextRound:function(){this.round++;var t=this.armies;for(var n in t)t[n].startRound();return this},scores:function(){return o(this.armies).mapApply(function(t,n){return[t,n.worth()]}).toObject()},result:function(){var t=this.players[0],n=this.players[1];if(this.armies[t].isEliminated(this)||this.armies[n].isEliminated(this)||this.round>=this.rounds){var i=this.scores();return this.zerosumResult(i[t]-i[n],t)}return null},synchronizeMetagame:function(){this.terrain.resetTerrain(this)},activeUnit:function(){return this.__activeUnit__},moves:function(){if(!this.result()){this.synchronizeMetagame();var t=this.activePlayer();return u(t,this.armies[t].actions(this))}return null},next:function(t,n,i){var s=this.activePlayer(),r=t[s];h(!r,"Active player ",s," has no actions!");var o=r.aleatories(this);if(h(!o&&n,"Unexpected haps! ",n),o&&!n)return new e.Contingent(this,t,o,i);var a=i?this:this.clone();return r.execute(a,n),a.nextTurn()},clone:function(){var t=s.clone({__activeUnit__:this.__activeUnit__,armies:this.armies});return t.round=this.round,t.rounds=this.rounds,t.terrain=this.terrain,new this.constructor(t)},"static __SERMAT__":{serializer:function(t){var n={activePlayer:t.activePlayer(),armies:t.armies,terrain:t.terrain,round:t.round,rounds:t.rounds};return t.__activeUnit__&&(n.__activeUnit__=t.__activeUnit__),[n]}}})),M=c.Terrain=r({SURROUNDINGS:[{dx:-1,dy:-1,cost:Math.SQRT2},{dx:-1,dy:0,cost:1},{dx:-1,dy:1,cost:Math.SQRT2},{dx:0,dy:-1,cost:1},{dx:0,dy:1,cost:1},{dx:1,dy:-1,cost:Math.SQRT2},{dx:1,dy:0,cost:1},{dx:1,dy:1,cost:Math.SQRT2}],tileSet:[{passable:!0,visible:!0},{passable:!1,visible:!1}],map:["000000000000000000000001000000000000000000000000","000000000000000000000001000000000000000000000000","000000000000000000000001000000000000000000000000","000000000000000000000001000000000000000000000000","000000000000000000000000000000000000000000000000","000000000000000000000000000000000000000000000000","000000000000000000000000000000000000000000000000","000000000000000000000000000000000000000000000000","000000000000000000000000000000000000000000000000","000000000000000000000000000000000000000000000000","000000000000000000000000000000000000000000000000","000000000000000000000000000000000000000000000000","000000000000000000000000000000000000000000000000","000000000000000000000000000000000000000000000000","000000000000000000000000000000000000000000000000","000000000000000000000000000000000000000000000000","000000000000000000000000000000000000000000000000","000000000000000000000000000000000000000000000000","000000000000000000000000000000000000000000000000","000000000000000000000000000000000000000000000000","000000000000000000000000000000000000000000000000","000000000000000000000000000000000000000000000000","000000000000000000000000000000000000000000000000","111100000000000011110000000011110000000000001111","000000000000000000000000000000000000000000000000","000000000000000000000000000000000000000000000000","000000000000000000000000000000000000000000000000","000000000000000000000000000000000000000000000000","000000000000000000000000000000000000000000000000","000000000000000000000000000000000000000000000000","000000000000000000000000000000000000000000000000","000000000000000000000000000000000000000000000000","000000000000000000000000000000000000000000000000","000000000000000000000000000000000000000000000000","000000000000000000000000000000000000000000000000","000000000000000000000000000000000000000000000000","000000000000000000000000000000000000000000000000","000000000000000000000000000000000000000000000000","000000000000000000000000000000000000000000000000","000000000000000000000000000000000000000000000000","000000000000000000000000000000000000000000000000","000000000000000000000000000000000000000000000000","000000000000000000000000000000000000000000000000","000000000000000000000000000000000000000000000000","000000000000000000000001000000000000000000000000","000000000000000000000001000000000000000000000000","000000000000000000000001000000000000000000000000","000000000000000000000001000000000000000000000000"].map(function(t){return new Uint8Array(t.split(""))}),__unitsByPosition__:{},constructor:function(t){this.width=this.map.length,this.height=this.map[0].length},resetTerrain:function(t){this.__unitsByPosition__=this.unitsByPosition(t)},unitsByPosition:function(t){var n=t.armies,i={};for(var s in n)n[s].units.forEach(function(t){t.isDead()||(i[t.position]=t)});return i},tileAt:function(t){var n=this.map[t[0]]&&this.map[t[0]][t[1]];return this.tileSet[n]},isPassable:function(t,n){var i=this.tileAt(t);return!(!i||!i.passable||n&&this.__unitsByPosition__.hasOwnProperty(t))},isVisible:function(t,n){var i=this.tileAt(t);return!(!i||!i.visible||n&&this.__unitsByPosition__.hasOwnProperty(t))},distance:function(t,n){var i=Math.abs(t[0]-n[0]),s=Math.abs(t[1]-n[1]);return Math.sqrt(i*i+s*s)},reachablePositions:function(t,n){n=n||12;var i,s,e,r,o,a={},l=[t.position],h=(this.width,this.height,this.SURROUNDINGS);a[t.position]=0;for(var u=0;u<l.length;u++){e=a[i=l[u]];for(var c=0;c<h.length;c++)(r=e+(o=h[c]).cost)>n||(s=[i[0]+o.dx,i[1]+o.dy],!a.hasOwnProperty(s)&&this.isPassable(s,!0)&&(a[s]=r,l.push(s)))}return a},canReachAStarInf:function(t){var n=new G(this,{diagonal:!0,end:t.target.position,start:t.attacker.position}),i=n.grid[t.target.position[0]][t.target.position[1]],s=n.grid[t.attacker.position[0]][t.attacker.position[1]];return n.astar.search(n,s,i,{exitCondition:t.exitCondition,heuristic:this.heuristicInfluence,influenceMap:t.influenceMap,role:t.role})},canReachAStar:function(t){var n=new G(this,{diagonal:!0}),i=n.grid[t.target.position[0]][t.target.position[1]],s=n.grid[t.attacker.position[0]][t.attacker.position[1]];return n.astar.search(n,s,i,{exitCondition:t.exitCondition})},getInf:function(t,n,i){var s=t[0],e=t[1];return"Red"==n?i[s][e]:-i[s][e]},heuristicInfluence:function(t,n,i,s){return Math.abs(n.x-t.x)+Math.abs(n.y-t.y)+60*("Red"==s?i[t.x][t.y]:-i[t.x][t.y])},distanceToTurns:function(t){var n=0;return t<=6?n:t%12==0?t/12:t/12+1},undefinedAsignArray:function(t,n){t[n]=void 0!==t[n]?t[n]:[]},sparseMatrix:function(t,n,i,s){void 0!=s.value&&(t[i[0]]=void 0!==t[i[0]]?t[i[0]]:[],t[i[0]][[i[1]]]=void 0!==t[i[0]][[i[1]]]?t[i[0]][[i[1]]]:{},t[i[0]][[i[1]]][s.key]=s.value)},"dual bresenham":function(t,n,i){i=i||1/0;for(var s,e=[],r=Math.abs(n[0]-t[0]),o=Math.abs(n[1]-t[1]),a=t[0]<n[0]?1:-1,l=t[1]<n[1]?1:-1,h=t.slice(),u=r-o;i--&&(e.push(h.slice()),h[0]!==n[0]||h[1]!==n[1]);)(s=2*u)>-o&&(u-=o,h[0]+=a),s<r&&(u+=r,h[1]+=l);return e},canShoot:function(t,n){if(t.army===n.army)return 1/0;var i=this.distance(t.position,n.position);if(i>t.maxRange())return 1/0;for(var s,e=this.bresenham(t.position,n.position,i),r=0;r<e.length;r++)if(s=e[r],!this.isVisible(s)||this.__unitsByPosition__[s]&&this.__unitsByPosition__[s].id!==t.id&&this.__unitsByPosition__[s].id!==n.id)return 1/0;return i},canShootPos:function(t,n,i,s,e){var r=this.distance(t,n);if(r>e)return 1/0;for(var o,a=this.bresenham(t,n,r),l=0;l<a.length;l++)if(o=a[l],!this.isVisible(o)||this.__unitsByPosition__[o]&&this.__unitsByPosition__[o].id!==i&&this.__unitsByPosition__[o].id!==s)return 1/0;return r},areaOfSight:function(t,n){n=n||1/0;var i=t.position,s=this,e={};return o(this.BRESENHAM_CACHE).forEachApply(function(t,r){for(var o,a=1;a<r.length&&a<=n&&(o=r[a],o=[i[0]+o[0],i[1]+o[1]],s.isVisible(o))&&(e[o]=a,!s.__unitsByPosition__[o]);a++);}),e},"static __SERMAT__":{serializer:function(t){return[]}}});M.BRESENHAM_CACHE=M.prototype.BRESENHAM_CACHE=function(t){var n={radius:50};for(var i=-50;i<=50;i++)n[[i,-50]]=M.bresenham([0,0],[i,-50]),n[[i,50]]=M.bresenham([0,0],[i,50]),-50!==i&&50!==i&&(n[[-50,i]]=M.bresenham([0,0],[-50,i]),n[[50,i]]=M.bresenham([0,0],[50,i]));return n}();var R=c.InfluenceMap=r({momentum:.7,decay:.5,iterations:2,constructor:function(t){this.role=t.activePlayers[0],this.width=t.terrain.width,this.height=t.terrain.height,this.gridRed=this.gridRed||this.matrix(this.width),this.gridBlue=this.gridBlue||this.matrix(this.width),this.terrain=t.terrain},getGrid:function(){return"Red"==this.role?this.gridRed:this.gridBlue},setGrid:function(t){"Red"==this.role&&(this.gridRed=t),this.gridBlue=t},matrix:function(t){return Array(t).fill(0).map(function(n){return Array(t).fill(0).map(function(t){return 0})})},update:function(t,n){var i=this.getGrid();this.role=t.activePlayer(),this.unitsInfluences(t);for(var s=0;s<it;s++)i=this.spread(i);return this.setGrid(i),i},unitsInfluences:function(t){var n,i,s,e=this,r=this.getGrid();for(var o in t.armies)n="Red"===o?1:-1,t.armies[o].units.forEach(function(t){t.isDead()||(i=0|t.position[0],s=0|t.position[1],r[i]?r[i][s]||(r[i][s]=0):(r[i]=[],r[i][s]=0),r[i][s]=e.influence(t)*n)})},influence:function(t){return 1e3*t.worth()},getMomentumInf:function(t,n,i,s){var e,r,o,a=0;for(r=-1;r<2;r++)for(o=-1;o<2;o++)(0!==r||0!==o)&&t[n+r]&&(e=t[n+r][i+o])&&(e*=s[r*r+o*o],(a<0?-a:a)<(e<0?-e:e)&&(a=e));return a},spread:function(t){for(var n,i,s=this.decay,e=[NaN,Math.exp(-1*s),Math.exp(-Math.SQRT2*s)],r=this.momentum,o=[],a=this.terrain,l=0;l<t.length;l++)for(var h=0;h<t[l].length;h++)n=t[l][h],1===a.map[l][h]?(o[l]=o[l]?o[l]:[],o[l][h]="t"):(i=this.getMomentumInf(t,l,h,e),o[l]=o[l]?o[l]:[],o[l][h]=n*(1-r)+i*r);return o},serializer:function(t){return[{gridRed:t.gridRed,gridBlue:t.gridBlue}]}});c.test={example0:function(){var t=new M,n=x.BattleBrothers;return new P({terrain:t,armies:{Red:new x.BattleBrothers({player:"Red",units:[[3,10]].map(function(t){return new n.UNITS.BattleBrothers_Unit({position:t})})}),Blue:new x.BattleBrothers({player:"Blue",units:[[40,10],[40,20],[40,15],[40,2]].map(function(t){return new n.UNITS.BattleBrothers_Unit({position:t})})})}})},example1:function(){var t=new M,n=x.BattleBrothers;return new P({terrain:t,armies:{Red:new x.BattleBrothers({player:"Red",units:[[3,10],[3,20],[3,15],[3,2]].map(function(t){return new n.UNITS.BattleBrothers_Unit({position:t})})}),Blue:new x.BattleBrothers({player:"Blue",units:[[40,10],[40,20],[40,15],[40,2]].map(function(t){return new n.UNITS.BattleBrothers_Unit({position:t})})})}})},example2:function(){var t=new M,n=x.BattleBrothers;return new P({terrain:t,armies:{Red:new x.BattleBrothers({player:"Red",units:[new n.UNITS.BattleBrothers_Unit({position:[12,4],models:Array.apply(null,{length:5}).map(function(){return new n.MODELS.BattleBrother})}),new n.UNITS.AssaultBrothers_Unit({position:[12,6],models:Array.apply(null,{length:5}).map(function(){return new n.MODELS.AssaultBrother})}),new n.UNITS.Engineers_Unit({position:[12,8],models:[new n.MODELS.Engineer]}),new n.UNITS.SupportBikers_Unit({position:[2,7],models:[new n.MODELS.SupportBiker]}),new n.UNITS.NuevoFastAttacks_Unit({position:[12,10],models:Array.apply(null,{length:5}).map(function(){return new n.MODELS.NuevoFastAttack})}),new n.UNITS.NuevoMelees_Unit({position:[12,12],models:Array.apply(null,{length:3}).map(function(){return new n.MODELS.NuevoMelee})})]}),Blue:new x.BattleBrothers({player:"Blue",units:[new n.UNITS.BattleBrothers_Unit({position:[36,4],models:Array.apply(null,{length:5}).map(function(){return new n.MODELS.BattleBrother})}),new n.UNITS.AssaultBrothers_Unit({position:[36,6],models:Array.apply(null,{length:5}).map(function(){return new n.MODELS.AssaultBrother})}),new n.UNITS.Engineers_Unit({position:[36,8],models:[new n.MODELS.Engineer]}),new n.UNITS.SupportBikers_Unit({position:[46,7],models:[new n.MODELS.SupportBiker]}),new n.UNITS.NuevoFastAttacks_Unit({position:[36,10],models:Array.apply(null,{length:5}).map(function(){return new n.MODELS.NuevoFastAttack})}),new n.UNITS.NuevoMelees_Unit({position:[36,12],models:Array.apply(null,{length:3}).map(function(){return new n.MODELS.NuevoMelee})})]})}})},exampleAssault:function(){var t=new M,n=x.BattleBrothers;return new P({terrain:t,armies:{Red:new x.BattleBrothers({player:"Red",units:[[3,10],[3,20],[4,15],[3,2]].map(function(t){return new n.UNITS.BattleBrothers_Unit({position:t})})}),Blue:new x.BattleBrothers({player:"Blue",units:[[4,10],[4,20],[5,15],[4,2]].map(function(t){return new n.UNITS.BattleBrothers_Unit({position:t})})})}})},randomGame:function(){var t=e.players.RandomPlayer,n=[new t,new t];window.match=new e.Match(this.example1(),n),match.events.on("begin",function(t,n){window.RENDERER.render(t)}),match.events.on("move",function(t,n,i){console.log(s.ser(n))}),match.events.on("next",function(t,n,i){n instanceof P&&window.RENDERER.render(n)}),match.run().then(function(t){console.log(t.result())})},randomAbstractedGame:function(){var t=[new e.players.RandomPlayer,new e.players.RandomPlayer],n=new q(this.example1());window.match=new e.Match(n,t),match.events.on("begin",function(t,n){t.concreteGame.terrain;window.RENDERER.render(t.concreteGame)}),match.events.on("move",function(t,n,i){console.log(s.ser(n))}),match.events.on("next",function(t,n,i){try{n.concreteGame.terrain;window.RENDERER.render(n.concreteGame)}catch(t){console.log(t)}}),match.run().then(function(t){console.log("randomAbstractedGame"),console.log(t.result())})},randomAbstractedGameDiscrete:function(){console.time("randomAbstractedGameDiscrete");var t=[new e.players.MonteCarloPlayer({simulationCount:10,timeCap:1/0}),new e.players.RandomPlayer],n=new q(this.example1());window.match=new e.Match(n,t),match.events.on("begin",function(t,n){t.concreteGame.terrain;window.RENDERER.render(t.concreteGame)}),match.events.on("move",function(t,n,i){console.log(s.ser(n))}),match.events.on("next",function(t,n,i){n.concreteGame.terrain;window.RENDERER.render(n.concreteGame)}),match.run().then(function(t){console.timeEnd("randomAbstractedGameDiscrete"),console.log(t.result())})},testGame:function(t,n){var i=e.players.RandomPlayer,r=[t||new i,n||new i];window.match=new e.Match(this.example1(),r),match.events.on("begin",function(t,n){window.RENDERER.render(t)}),match.events.on("move",function(t,n,i){console.log(s.ser(n)),window.RENDERER.renderSight(t)}),match.events.on("next",function(t,n,i){n instanceof P&&window.RENDERER.render(n)}),match.run().then(function(t){console.log(t.result())})},conPesosDS_vs_sinPesosDS:function(){var t=[new I,new k];window.match=new e.Match(this.example2(),t),match.events.on("begin",function(t,n){window.RENDERER.render(t)}),match.events.on("move",function(t,n,i){console.log(s.ser(n)),window.RENDERER.renderSight(t)}),match.events.on("next",function(t,n,i){n instanceof P&&window.RENDERER.render(n)}),match.run().then(function(t){console.log(t.result())})},sinPesosDS_vs_conPesosDS:function(){var t=[new k,new I];window.match=new e.Match(this.example2(),t),match.events.on("begin",function(t,n){window.RENDERER.render(t)}),match.events.on("move",function(t,n,i){console.log(s.ser(n)),window.RENDERER.renderSight(t)}),match.events.on("next",function(t,n,i){n instanceof P&&window.RENDERER.render(n)}),match.run().then(function(t){console.log(t.result())})},conPesosDS_vs_random:function(){var t=e.players.RandomPlayer,n=[new I,new t];window.match=new e.Match(this.example2(),n),match.events.on("begin",function(t,n){window.RENDERER.render(t)}),match.events.on("move",function(t,n,i){window.RENDERER.renderSight(t)}),match.events.on("next",function(t,n,i){n instanceof P&&window.RENDERER.render(n)}),match.run().then(function(t){console.log(t.result())})},sinPesosDS_vs_random:function(){var t=e.players.RandomPlayer,n=[new k,new t];window.match=new e.Match(this.exampleAssault(),n),match.events.on("begin",function(t,n){window.RENDERER.render(t)}),match.events.on("move",function(t,n,i){console.log(s.ser(n)),window.RENDERER.renderSight(t)}),match.events.on("next",function(t,n,i){n instanceof P&&window.RENDERER.render(n)}),match.run().then(function(t){console.log(t.result())})},conPesosDS_vs_random_Abstracted:function(){var t=e.players.RandomPlayer,n=[new I,new t],i=new q(this.example2());window.match=new e.Match(i,n),match.events.on("begin",function(t,n){t.concreteGame.terrain;window.RENDERER.render(t.concreteGame)}),match.events.on("move",function(t,n,i){console.log(s.ser(n))}),match.events.on("next",function(t,n,i){n.concreteGame.terrain;window.RENDERER.render(n.concreteGame)}),match.run().then(function(t){console.log("conPesosDS_vs_random_Abstracted"),console.log(t.result())})},conPesosDS_vs_BasicRulePlayer_shoot:function(){var t=[new I,new K];window.match=new e.Match(this.example2(),t),match.events.on("begin",function(t,n){window.RENDERER.render(t)}),match.events.on("move",function(t,n,i){console.log(s.ser(n)),window.RENDERER.renderSight(t)}),match.events.on("next",function(t,n,i){n instanceof P&&window.RENDERER.render(n)}),match.run().then(function(t){console.log(t.result())})},conPesosDS_vs_BasicRulePlayer_assault:function(){var t=[new I,new W];window.match=new e.Match(this.exampleAssault(),t),match.events.on("begin",function(t,n){window.RENDERER.render(t)}),match.events.on("move",function(t,n,i){console.log(s.ser(n)),window.RENDERER.renderSight(t)}),match.events.on("next",function(t,n,i){n instanceof P&&window.RENDERER.render(n)}),match.run().then(function(t){console.log(t.result())})},conPesosDS_vs_BasicRulePlayer_assist:function(){var t=[new I,new N];window.match=new e.Match(this.example2(),t),match.events.on("begin",function(t,n){window.RENDERER.render(t)}),match.events.on("move",function(t,n,i){console.log(s.ser(n)),window.RENDERER.renderSight(t)}),match.events.on("next",function(t,n,i){n instanceof P&&window.RENDERER.render(n)}),match.run().then(function(t){console.log(t.result())})},conPesosDS_vs_BasicRulePlayer_scape_then_shoot:function(){var t=[new I,new T];window.match=new e.Match(this.example2(),t),match.events.on("begin",function(t,n){window.RENDERER.render(t)}),match.events.on("move",function(t,n,i){console.log(s.ser(n)),window.RENDERER.renderSight(t)}),match.events.on("next",function(t,n,i){n instanceof P&&window.RENDERER.render(n)}),match.run().then(function(t){console.log(t.result())})},randomAbstractedTest:function(t,n){var i=e.players.RandomPlayer,r=[t||new i,n||new i];game=new q(this.example1()),window.match=new e.Match(game,r),match.events.on("begin",function(t,n){t.concreteGame.terrain;window.RENDERER.render(t.concreteGame)}),match.events.on("move",function(t,n,i){console.log(s.ser(n))}),match.events.on("next",function(t,n,i){n.concreteGame.terrain;window.RENDERER.render(n.concreteGame)}),match.run().then(function(t){console.log("randomAbstractedGame"),console.log(t.result())})}};var x=c.GrimFuture=function(){var t={},n={LightClaws:{range:0,attacks:1},CClaws:{range:0,attacks:2},Pistol:{range:12,attacks:1},AssaultRifle:{range:24,attacks:1},HeavyFlamethrower:{range:12,attacks:6,ap:1},EnergyFist:{range:0,attacks:2,ap:4},LinkedAssaultRifle:{range:24,attacks:1},HeavyMachinegun:{range:36,attacks:3,ap:1}},i={BattleBrother:r(d,{cost:22,equipments:[n.AssaultRifle,n.LightClaws],constructor:function(t){d.call(this,t)}}),AssaultBrother:r(d,{cost:22,equipments:[n.Pistol,n.CClaws],constructor:function(t){d.call(this,t)}}),SupportBrother:r(d,{cost:50,equipments:[n.HeavyFlamethrower,n.LightClaws],constructor:function(t){d.call(this,t)}}),Engineer:r(d,{cost:140,equipments:[n.Pistol,n.EnergyFist],constructor:function(t){d.call(this,t)}}),SupportBiker:r(d,{cost:100,equipments:[n.LinkedAssaultRifle,n.HeavyMachinegun,n.LightClaws],constructor:function(t){d.call(this,t)}}),NuevoFastAttack:r(d,{cost:30,equipments:[n.AssaultRifle,n.LightClaws],constructor:function(t){d.call(this,t)}}),NuevoMelee:r(d,{cost:20,equipments:[n.LightClaws],constructor:function(t){d.call(this,t)}})},s={BattleBrothers_Unit:r(v,{quality:3,defense:6,fearless:!0,constructor:function(t){(t=t||{}).models||(t.models=a.range(5).map(function(){return new i.BattleBrother}).toArray()),v.call(this,t)}}),AssaultBrothers_Unit:r(v,{quality:3,defense:6,fearless:!0,constructor:function(t){(t=t||{}).models||(t.models=a.range(5).map(function(){return new i.AssaultBrother}).toArray()),v.call(this,t)}}),SupportBrothers_Unit:r(v,{quality:3,defense:6,fearless:!0,constructor:function(t){(t=t||{}).models||(t.models=a.range(5).map(function(){return new i.SupportBrother}).toArray()),v.call(this,t)}}),Engineers_Unit:r(v,{quality:3,defense:7,constructor:function(t){(t=t||{}).models||(t.models=a.range(1).map(function(){return new i.Engineer}).toArray()),v.call(this,t)}}),SupportBikers_Unit:r(v,{quality:3,defense:6,constructor:function(t){(t=t||{}).models||(t.models=a.range(1).map(function(){return new i.SupportBiker}).toArray()),v.call(this,t)}}),NuevoFastAttacks_Unit:r(v,{quality:4,defense:3,constructor:function(t){(t=t||{}).models||(t.models=a.range(5).map(function(){return new i.NuevoFastAttack}).toArray()),v.call(this,t)}}),NuevoMelees_Unit:r(v,{quality:3,defense:6,constructor:function(t){(t=t||{}).models||(t.models=a.range(3).map(function(){return new i.NuevoMelee}).toArray()),v.call(this,t)}})};t.BattleBrothers=r(f,{faction:"BattleBrothers","static MODELS":i,"static UNITS":s,constructor:function(t){f.call(this,t)}});return t}();function B(t,n){return n.priority=t,n}var D=[],I=c.DynamicScriptingPlayer=r(e.Player,{constructor:function(t){e.Player.call(this,t),l(this,t).array("rules",{defaultValue:[]}),this.__pendingActions__=[],this.rules=this.ownRules(),this.sortRules(),this.roundActions=[],this.playerPossibleUnits=[],this.playerShootableUnits=[],this.playerAssaultableUnits=[]},ownRules:function(){var t=this;return Object.keys(Object.getPrototypeOf(this)).map(function(n){return[t[n],1]}).filter(function(t){var n=t[0];return"function"==typeof n&&n.name&&"rule"===n.name.substr(0,4)})},sortRules:function(){this.rules.sort(function(t,n){return n[0].priority-t[0].priority||n[1]-t[1]})},sortRuleListByWeight:function(t){t.length>0&&t.sort(function(t,n){return n[1]-t[1]})},firstRules:function(t,n,i){for(var s,e=[],r=0,o=this.rules.length;r<o;r++)this.rules[r][0].priority==i&&(s=this.rules[r])[0].call(this,t,n)&&e.push(s);return this.sortRuleListByWeight(e),e},decision:function(t,n){if(t instanceof q)return this.decision(t.concreteGame,n);var i,s;t.synchronizeMetagame(),this.playerPossibleUnits=this.possibleUnits(t,n),this.playerShootableUnits=this.allShootableUnits(t,n),this.playerAssaultableUnits=this.allAssaultableUnits(t,n);for(var e=this.armiesAndUnits(t,n)[1],r=0,o=0;o<e.length;o++)(e[o].isEnabled||e[o].isActive)&&(r+=1);r===e.length&&this.gameWorth(t,n);var a=this.roundActions;if(this.__pendingActions__.length<1)for(var l=12;l>0;){var u=this.firstRules(t,n,l);if(u.length>0){for(var c=0,f=0;f<u.length;f++){c+=u[f][1]}if(c>u.length)for(var v=0,d=Math.random(),g=0;g<u.length;g++)d<=(v+=u[g][1]/c)&&(s=(i=u[g])[0].call(this,t,n));else s=(i=u[Math.floor(Math.random()*u.length)])[0].call(this,t,n);if(s){s.forEach(function(t){t.__rule__=i}),this.__pendingActions__=this.__pendingActions__.concat(s),a=a.concat(s),this.roundActions=a,D=D.concat(s);for(var p=0;p<e.length;p++)e[p].isEnabled&&!e[p].isActive||1;return this.__pendingActions__.shift()}}else l-=1}return h(this.__pendingActions__.length<1,"No rule applied to game!"),this.__pendingActions__.shift()},participate:function(t,n){return this.attachToMatch(t.state(),t),this},attachToMatch:function(t,n){var i=this,s=0,e=t;n.events.on("next",function(t,n,r){!n.isContingent&&n.round>s&&!t.isContingent&&(i.adjustWeights(t,t.players[0],D,e),s=n.round,D=[],e=t)})},adjustWeights:function(t,n,i,s){var e=this.rules,r=[];i.forEach(function(t){r.indexOf(t.__rule__)<0&&r.push(t.__rule__)});var o,a,l,h=this.gameWorth(s,n),u=(this.gameWorth(t,n)-h)/10;if(u<0)for(o=0;o<e.length;o++)r.indexOf(e[o])<0&&(e[o][1]+=-1*u);else for(o=0;o<e.length;o++)r.indexOf(e[o])>=0&&(e[o][1]+=u);for(var c=0;c<i.length;c++){var f=i[c];a=f.__rule__[0].name,f.__rule__[1]||(f.__rule__[1]=1);var v=0;for(v=(l=f.worth)&&"[object Function]"==={}.toString.call(l)?f.worth()/10:f.worth/10,o=0;o<this.rules.length;o++)v<0?this.rules[o][0].name!=a&&(this.rules[o][1]+=-1*v):this.rules[o][0].name==a&&(this.rules[o][1]+=v)}},gameWorth:function(t,n){var i=0,s=0,e=0,r=this.armiesAndUnits(t,n),o=r[1];return r[3].forEach(function(t){s=t.cost(),t.isDead()&&(i+=s),e=t.size()-t.livingModels().length,i+=s*e/t.size()}),o.forEach(function(t){s=t.cost(),t.isDead()&&(i-=s),e=t.size()-t.livingModels().length,i-=s*e/t.size()}),i},"static __SERMAT__":{identifier:"DynamicScriptingPlayer",serializer:function(t){return this.serializeAsProperties(t,["name","rules"])}},shoot:function(t,n){return[new m(t.id),new U(t.id,n.id)]},assault:function(t,n){return[new m(t.id),new b(t.id,n.id)]},move:function(t,n,i){return i?[new m(t.id),n,new U(t.id,i.id)]:[new m(t.id),n,new y(t.id)]},scapeAux:function(t,n,i,s){for(var e=0;e<i.length;e++){var r=i[e],o=[];if(this.canHide(t,s,r)){for(var a=this.hideMoves(t,s,r),l=0;l<a.length;l++)if(t.terrain.distance(r.position,a[l].position)<=r.maxRange()+6)return this.move(s,a[l]);o=o.concat(a)}if(this.canRun(t,s,r)){for(var h=this.runMoves(t,s,r),u=0;u<h.length;u++)if(t.terrain.distance(r.position,h[u].position)<=r.maxRange()+6)return this.move(s,h[u]);o=o.concat(h)}if(o.length>0)return this.move(s,o[Math.floor(Math.random()*o.length)])}},scape:function(t,n,i){var s=this.mostDangerousUnits(t,n,i),e=this.scapeAux(t,n,s,i);if(e)return e;this.dangerousUnits(t,n,i);var r=this.scapeAux(t,n,s,i);if(r)return r;var o=i.getMoveActions(t);return this.move(i,o[Math.floor(Math.random()*o.length)])},assistAux:function(t,n,i,s,e){for(var r=0;r<i.length;r++){var o,a=i[r];if(this.canAssault(t,s,a))return this.assault(s,a);if(this.canBlockSight(t,s,e,a)){var l=this.blockSightMovements(t,s,e,a);o=l[Math.floor(Math.random()*l.length)]}if(this.canShoot_(t,s,a,!0))return o?this.move(s,o,a):this.shoot(s,a);if(o)return this.move(s,o)}return null},assist:function(t,n,i,s){var e=this.mostDangerousUnits(t,n,s),r=this.assistAux(t,n,e,i,s);if(r)return r;var o=this.dangerousUnits(t,n,s),a=this.assistAux(t,n,o,i,s);if(a)return a;var l=i.getMoveActions(t);return this.move(i,l[Math.floor(Math.random()*l.length)])},getFewMoveActions:function(t,n){var i=[],s=n.position[0],e=n.position[1];return i.push(new _(n.id,[s+1,e+1],!1)),i},getCloseTo:function(t,n,i){for(var s=this.interpolation(n.position,i.position),e=n.getMoveActions(t),r=[],o=0;o<e.length;o++){var a=e[o].position;s.forEach(function(t){a[0]===t[0]&&a[1]===t[1]&&r.push(e[o])})}for(var l=n.position,h=e[Math.floor(Math.random()*e.length)],u=0;u<r.length;u++){var c=r[u].position;t.terrain.distance(c,i.position)<t.terrain.distance(l,i.position)&&(l=c,h=r[u])}return this.move(n,h)},possibleUnits:function(t,n){var i=[];return this.armiesAndUnits(t,n)[1].forEach(function(t){t.isDead()||!t.isEnabled||t.isActive||i.push(t)}),i},shootableUnitsAux:function(t,n,i){var s=[],e=this.livingEnemyUnits(t,n);return i.getShootActions(t).forEach(function(t){e.forEach(function(n){t.targetId===n.id&&s.push(n)})}),s},allShootableUnits:function(t,n){for(var i=[],s=this.playerPossibleUnits,e=0;e<s.length;e++){var r,o=s[e];r=this.shootableUnitsAux(t,n,o),i[e]=[o,r]}return i},enemyShootableUnits:function(t,n,i){for(var s=[],e=0;e<this.playerShootableUnits.length;e++)this.playerShootableUnits[e][0]==i&&(s=this.playerShootableUnits[e][1]);return s},assaultableUnits:function(t,n,i){var s=[],e=this.livingEnemyUnits(t,n);return i.getAssaultActions(t).forEach(function(t){e.forEach(function(n){t.targetId===n.id&&s.push(n)})}),s},allAssaultableUnits:function(t,n){for(var i=[],s=this.playerPossibleUnits,e=0;e<s.length;e++){var r,o=s[e];r=this.assaultableUnits(t,n,o),i[e]=[o,r]}return i},enemyAssaultableUnits:function(t,n,i){for(var s=[],e=0;e<this.playerAssaultableUnits.length;e++)this.playerAssaultableUnits[e][0]==i&&(s=this.playerAssaultableUnits[e][1]);return s},canShoot_:function(t,n,i,s){return!(n.isDead()||!n.isEnabled||i.isDead()||t.terrain.canShoot(n,i)==1/0)},canAssault:function(t,n,i){return!(n.isDead()||!n.isEnabled||i.isDead()||!(t.terrain.canShoot(n,i)<=12))},interForX:function(t,n,i,s){for(var e=[],r=i,o=t+1;o<n;o++)e.push([parseInt(o),parseInt(r)]),r+=s;return e},interForY:function(t,n,i,s){for(var e=[],r=i,o=t+1;o<n;o++)e.push([parseInt(r),parseInt(o)]),r+=s;return e},interpolation:function(t,n){var i,s,e=0,r=t[0],o=n[0],a=t[1],l=n[1],h=Math.min(r,o),u=Math.max(r,o),c=Math.min(a,l),f=Math.max(a,l);return s=h===r?a:l,i=c===a?r:o,a===l?this.interForX(h,u,s,e):r===o?this.interForY(c,f,i,e):Math.abs(l-a)>=Math.abs(o-r)?(e=Math.abs(o-r)/Math.abs(l-a),this.interForY(c,f,i,e)):(e=Math.abs(l-a)/Math.abs(o-r),this.interForX(h,u,s,e))},blockSightMovements:function(t,n,i,s){for(var e=i.position,r=s.position,o=this.interpolation(e,r),a=[],l=n.getMoveActions(t),h=0;h<l.length;h++){var u=l[h].position;o.forEach(function(t){u[0]===t[0]&&u[1]===t[1]&&a.push(l[h])})}return a},canBlockSight:function(t,n,i,s){return this.blockSightMovements(t,n,i,s).length>0},canAssist:function(t,n,i,s){for(var e=this.dangerousUnits(t,n,s),r=!1,o=0;o<e.length;o++){var a=e[o];if(!(this.canBlockSight(t,i,s,a)||this.canShoot_(t,i,a,!0)||this.canAssault(t,i,a))){r=!1;break}r=!0}return r},canRun:function(t,n,i){var s=i.maxRange()+6;return!(n.isEnabled&&t.terrain.canShoot(i,n)<=s)},canHide:function(t,n,i){return!1},runMoves:function(t,n,i){for(var s=i.position,e=n.position,r=n.getMoveActions(t),o=r[Math.floor(Math.random()*r.length)],a=0;a<r.length;a++){var l=r[a].position;t.terrain.distance(l,s)>t.terrain.distance(e,s)&&(e=l,o=r[a])}return t.terrain.distance(i.position,e),i.maxRange(),[o]},hideMoves:function(t,n,i){return[]},canScape:function(t,n,i){var s=this.mostDangerousUnits(t,n,i);if(0===s.length)return!1;for(var e=!0,r=0;r<s.length;r++){var o=s[r];this.canRun(t,i,o)||this.canHide(t,i,o)||(e=!1)}return e},mostDangerousUnits:function(t,n,i){for(var s=this.livingEnemyUnits(t,n),e=[],r=0;r<s.length;r++){var o=s[r];this.canKill(t,o,i)&&e.push(o)}return e},dangerousUnits:function(t,n,i){for(var s=this.livingEnemyUnits(t,n),e=[],r=0;r<s.length;r++){var o=s[r];(this.canShoot_(t,o,i,!0)||this.canAssault(t,o,i))&&e.push(o)}return e},canBeKilled:function(t,n,i){for(var s=this.armiesAndUnits(t,n)[3],e=0;e<s.length;e++)if(this.canKill(t,s[e],i))return!0;return!1},canKill:function(t,n,i){return!(n.isDead()||!n.isEnabled||i.isDead()||!this.canKillShooting(t,n,i)&&!this.canKillAssaulting(t,n,i))},canKillShooting:function(t,n,i){return!(n.isDead()||i.isDead()||!n.isEnabled||!(this.bestAttackResultShooting(t,n,i)>=100))},canKillAssaulting:function(t,n,i){return!(n.isDead()||i.isDead()||!n.isEnabled||!(this.bestAttackResultAssaulting(t,n,i)>=100))},bestAttackResult:function(t,n,i){if(!n.isDead()&&n.isEnabled&&!i.isDead()){var s=this.bestAttackResultShooting(t,n,i),e=this.bestAttackResultAssaulting(t,n,i),r=Math.max(s,e);return r}return 0},bestAttackResultShooting:function(t,n,i){if(!n.isDead()&&n.isEnabled&&!i.isDead()){var s=t.terrain.distance(n.position,i.position),e=0;n.livingModels().forEach(function(t){t.equipments.forEach(function(t){t.range>=s&&(e+=t.attacks)})});var r=i.livingModels().length,o=100*e/r;return o>100&&(o=100),o}return 0},bestAttackResultAssaulting:function(t,n,i){if(!n.isDead()&&n.isEnabled&&!i.isDead()&&this.canAssault(t,n,i)){var s=0;n.livingModels().forEach(function(t){t.equipments.forEach(function(t){0===t.range&&(s+=t.attacks)})});var e=i.livingModels().length,r=100*s/e;return r>100&&(r=100),r}return 0},shootingKillableUnits:function(t,n,i){for(var s=[],e=this.shootableUnitsAux(t,n,i),r=0;r<e.length;r++){var o=e[r];this.willKillShooting(t,i,o)&&s.push(o)}return s},livingEnemyUnits:function(t,n){return this.armiesAndUnits(t,n)[2].livingUnits()},armiesAndUnits:function(t,n){var i=t.armies[n],s=i.units,e=t.opponent(n),r=t.armies[e];return[i,s,r,r.units]},wounded:function(t){return t.livingModels().length<t.size()},canWoundALot:function(t,n,i){return!(n.isDead()||!n.isEnabled||i.isDead())&&this.bestAttackResult(t,n,i)>=75},canWound:function(t,n,i){return!(n.isDead()||!n.isEnabled||i.isDead())&&this.bestAttackResult(t,n,i)>0},maxCost:function(t){return o(t).map(function(t){t.cost()}).max(0)},mostExpensiveUnit:function(t){for(var n,i=0,s=0;s<t.length;s++)t[s].cost()>i&&(i=(n=t[s]).cost());return n},cheapestUnit:function(t){for(var n,i=0,s=0;s<t.length;s++)t[s].cost()>i&&(i=(n=t[s]).cost());return n},unitForce:function(t){var n=0;return t.livingModels().forEach(function(t){t.equipments.forEach(function(t){n+=t.attacks})}),t.quality*n+t.defense/2+t.cost()/10},unitIsStrongest:function(t,n){for(var i,s=0,e=0;e<t.length;e++)this.unitForce(t[e])>s&&(i=t[e],s=this.unitForce(i));return this.unitForce(n)===s},classification:function(t){return t.quality>=4&&t.defense<=3?"fastAttack":t.defense>=7?"heavySupport":t.size()>=5&&t.cost()<=130?"troop":t.maxRange()>=36?"sniper":""},maxRangeInUnits:function(t,n){var i=o(t).map(function(t){return t.maxRange()}).max(0);return n.maxRange()===i},easiestToKill:function(t,n){var i=o(t).map(function(t){return t.livingModels().length*t.defense}).max(0);return n.livingModels().length*n.defense===i},expectedResultShooting:function(t,n,i){if(this.canShoot_(t,n,i,!0)){var s=t.terrain.distance(n.position,i.position),e=0;n.livingModels().forEach(function(t){t.equipments.forEach(function(t){t.range>=s&&(e+=t.attacks)})});for(var r=0,o=0,a=0;a<e;a++)r=Math.floor(3+4*Math.random()),n.quality>r&&(o+=1);for(var l=0,h=0;h<o;h++)r=Math.floor(1+6*Math.random()),i.defense>r&&(l+=1);var u=100*(o-l)/i.livingModels().length;return u>100&&(u=100),u}return 0},expectedResultAssaulting:function(t,n,i){return 0},willKillShooting:function(t,n,i){return 100===this.expectedResultShooting(t,n,i)},willWoundALotShooting:function(t,n,i){return this.expectedResultShooting(t,n,i)>75},willWoundHalfShooting:function(t,n,i){return this.expectedResultShooting(t,n,i)>=50},willWoundShooting:function(t,n,i){return this.expectedResultShooting(t,n,i)>0},willKillAssaulting:function(t,n,i){return 100===this.expectedResultAssaulting(t,n,i)},willWoundALotAssaulting:function(t,n,i){return this.expectedResultAssaulting(t,n,i)>75},willWoundHalfAssaulting:function(t,n,i){return this.expectedResultAssaulting(t,n,i)>=50},willWoundAssaulting:function(t,n,i){return this.expectedResultAssaulting(t,n,i)>0},winning:function(t){var n=t.activePlayer(),i=t.players[0];return n===t.players[0]&&(i=t.players[1]),t.scores(n)>t.scores(i)},losingGameByUnitElimination:function(t,n){var i=t.activePlayer(),s=t.players[0];return i===t.players[0]&&(s=t.players[1]),t.scores(i)-n.cost()<t.scores(s)},winningActivation:function(t,n){if(4===t.round){var s=t.activePlayer(),e=t.players[0];s===t.players[0]&&(e=t.players[1]);var r=[];this.livingEnemyUnits(t,n).forEach(function(n){t.scores(s)>t.scores(e)-n.cost()&&r.push(n)});var o=this.possibleUnits(t,n);for(i=0;i<o.length;i++){var a=o[i];for(j=0;j<r.length;j++){var l=r[j];if(this.canKill(t,a,l)||this.canPin(t,a,l))return!0}}}return!1},canPin:function(t,n,i){if(this.canAssault(t,n,i)){var s=0;if(n.livingModels().forEach(function(t){t.equipments.forEach(function(t){0===t.range&&(s+=t.attacks)})}),s>=i.size()/2)return!0}return!1},isMelee:function(t){var n=0,i=0,s=t.livingModels();return s.forEach(function(t){t.equipments.forEach(function(t){t.range>=n&&(n=t.range,i=t.attacks)})}),0===n||(s.forEach(function(t){t.equipments.forEach(function(t){if(0===t.range&&t.attacks>i)return!0})}),!1)},rule_12A:B(12,function(t,n){if(3===t.round&&!this.winning(t))for(var i=this.playerPossibleUnits,s=this.armiesAndUnits(t,n)[1],e=this.livingEnemyUnits(t,n),r=0;r<i.length;r++){var o=i[r],a=this.enemyShootableUnits(t,n,o);if(this.canBeKilled(t,n,o))for(var l=0;l<e.length;l++){var h=e[l];if(this.willWoundShooting(t,h,o))for(var u=0;u<a.length;u++){var c=a[u];if(this.willWoundShooting(t,o,c)&&o.cost()>c.cost())for(var f=0;f<s.length;f++){var v=s[f];if(v.cost()>o.cost()&&this.canAssist(t,n,o,v))return this.assist(t,n,o,v)}}}}return null}),rule_12B:B(12,function(t,n){if(3===t.round&&!this.winning(t)&&this.winningActivation(t,n))for(var i=this.playerPossibleUnits,s=(this.armiesAndUnits(t,n)[1],this.livingEnemyUnits(t,n)),e=0;e<i.length;e++){var r=i[e],o=this.enemyAssaultableUnits(t,n,r);if(this.canBeKilled(t,n,r)&&!this.canScape(t,n,r))for(var a=0;a<s.length;a++){var l=s[a];if(this.willWoundShooting(t,l,r))for(var h=0;h<o.length;h++){var u=o[h];if(this.willWoundHalfAssaulting(t,r,u)&&r.cost()>u.cost())return this.assault(r,u)}}}return null}),rule_12C:B(12,function(t,n){if(3===t.round&&!this.winning(t)&&this.winningActivation(t,n))for(var i=this.playerPossibleUnits,s=(this.armiesAndUnits(t,n)[1],this.livingEnemyUnits(t,n)),e=0;e<i.length;e++){var r=i[e],o=this.enemyAssaultableUnits(t,n,r);if(this.canBeKilled(t,n,r)&&this.canScape(t,n,r))for(var a=0;a<s.length;a++){var l=s[a];if(this.willWoundShooting(t,l,r))for(var h=0;h<o.length;h++){var u=o[h];if(this.willWoundHalfAssaulting(t,r,u)&&r.cost()>u.cost())return this.scape(t,n,r)}}}return null}),rule_12D:B(12,function(t,n){if(3===t.round&&!this.winning(t)&&this.winningActivation(t,n))for(var i=this.playerPossibleUnits,s=(this.armiesAndUnits(t,n)[1],this.livingEnemyUnits(t,n)),e=0;e<i.length;e++){var r=i[e],o=this.enemyShootableUnits(t,n,r);if(this.canBeKilled(t,n,r)&&!this.canScape(t,n,r))for(var a=0;a<s.length;a++){var l=s[a];if(this.willWoundShooting(t,l,r))for(var h=0;h<o.length;h++){var u=o[h];if(this.willWoundShooting(t,r,u)&&this.canKill(t,r,u)&&r.cost()>u.cost())return this.shoot(r,u)}}}return null}),rule_11A:B(11,function(t,n){if(3===t.round&&!this.winning(t))for(var i=this.playerPossibleUnits,s=(this.armiesAndUnits(t,n)[1],this.livingEnemyUnits(t,n)),e=0;e<i.length;e++){var r=i[e],o=this.enemyAssaultableUnits(t,n,r);if(this.canBeKilled(t,n,r)&&this.canScape(t,n,r))for(var a=0;a<s.length;a++){var l=s[a];if(this.willWoundShooting(t,l,r))for(var h=0;h<o.length;h++){var u=o[h];if(this.willWoundHalfAssaulting(t,r,u)&&r.cost()>u.cost())return this.scape(t,n,r)}}}return null}),rule_11B:B(11,function(t,n){if(3===t.round&&this.winning(t)&&this.winningActivation(t,n))for(var i=this.playerPossibleUnits,s=(this.armiesAndUnits(t,n)[1],this.livingEnemyUnits(t,n)),e=0;e<i.length;e++){var r=i[e],o=this.enemyAssaultableUnits(t,n,r);if(this.canBeKilled(t,n,r)&&this.canScape(t,n,r))for(var a=0;a<s.length;a++){var l=s[a];if(this.willWoundShooting(t,l,r))for(var h=0;h<o.length;h++){var u=o[h];if(this.willWoundHalfAssaulting(t,r,u)&&r.cost()>u.cost())return this.scape(t,n,r)}}}return null}),rule_11C:B(11,function(t,n){if(3===t.round&&this.winning(t)&&this.winningActivation(t,n))for(var i=this.playerPossibleUnits,s=(this.armiesAndUnits(t,n)[1],this.livingEnemyUnits(t,n)),e=0;e<i.length;e++){var r=i[e],o=this.enemyAssaultableUnits(t,n,r);if(this.canBeKilled(t,n,r)&&!this.canScape(t,n,r))for(var a=0;a<s.length;a++){var l=s[a];if(this.willWoundShooting(t,l,r))for(var h=0;h<o.length;h++){var u=o[h];if(this.willWoundHalfAssaulting(t,r,u)&&r.cost()>u.cost())return this.assault(r,u)}}}return null}),rule_11D:B(11,function(t,n){if(3===t.round&&this.winning(t)&&this.winningActivation(t,n))for(var i=this.playerPossibleUnits,s=(this.armiesAndUnits(t,n)[1],this.livingEnemyUnits(t,n)),e=0;e<i.length;e++){var r=i[e],o=this.enemyAssaultableUnits(t,n,r);if(this.canBeKilled(t,n,r)&&!this.losingGameByUnitElimination(t,r))for(var a=0;a<s.length;a++){var l=s[a];if(this.willWoundShooting(t,l,r))for(var h=0;h<o.length;h++){var u=o[h];if(this.willWoundHalfAssaulting(t,r,u)&&r.cost()>u.cost())return this.assault(r,u)}}}return null}),rule_10A:B(1e6,function(t,n){if(1===t.round)for(var i=this.playerPossibleUnits,s=0;s<i.length;s++){var e=i[s],r=this.enemyAssaultableUnits(t,n,e);if(this.isMelee(e))for(var o=0;o<r.length;o++){var a=r[o];if(this.unitIsStrongest(r,a)&&this.willWoundHalfAssaulting(t,e,a))return this.assault(e,a)}}return null}),rule_10B:B(10,function(t,n){if(2===t.round)for(var i=this.playerPossibleUnits,s=0;s<i.length;s++){var e=i[s],r=this.enemyAssaultableUnits(t,n,e);if(this.isMelee(e))for(var o=0;o<r.length;o++){var a=r[o];if(this.unitIsStrongest(r,a)&&this.willWoundHalfAssaulting(t,e,a))return this.assault(e,a)}}return null}),rule_9A:B(9,function(t,n){if(2===t.round)for(var i=this.playerPossibleUnits,s=0;s<i.length;s++)for(var e=i[s],r=this.enemyAssaultableUnits(t,n,e),o=0;o<r.length;o++){var a=r[o];if(this.easiestToKill(r,a)&&this.willWoundHalfAssaulting(t,e,a))return this.assault(e,a)}return null}),rule_9B:B(9,function(t,n){if(1===t.round)for(var i=this.playerPossibleUnits,s=0;s<i.length;s++)for(var e=i[s],r=this.enemyAssaultableUnits(t,n,e),o=0;o<r.length;o++){var a=r[o];if(this.easiestToKill(r,a)&&this.willWoundHalfAssaulting(t,e,a))return this.assault(e,a)}return null}),rule_8A:B(8,function(t,n){if(3===t.round&&this.winning(t))for(var i=this.playerPossibleUnits,s=this.armiesAndUnits(t,n)[1],e=0;e<i.length;e++){var r=i[e],o=this.enemyShootableUnits(t,n,r);if(!this.canBeKilled(t,n,r))for(var a=0;a<s.length;a++){var l=s[a];if(l.cost()>r.cost()&&!this.canAssist(t,n,r,l))for(var h=0;h<o.length;h++){var u=o[h];if(this.willKillShooting(t,r,u)&&u.cost()===this.mostExpensiveUnit(o).cost())return this.shoot(r,u)}}}return null}),rule_8B:B(8,function(t,n){if(3===t.round&&this.winning(t))for(var i=this.playerPossibleUnits,s=(this.armiesAndUnits(t,n)[1],this.livingEnemyUnits(t,n)),e=0;e<i.length;e++){var r=i[e],o=this.enemyShootableUnits(t,n,r);if(this.canBeKilled(t,n,r))for(var a=0;a<s.length;a++){var l=s[a];if(r.cost()<l.cost()&&this.canKill(t,r,l)&&this.willWoundShooting(t,r,l))for(var h=0;h<o.length;h++){var u=o[h];if(this.willWoundShooting(t,u,r))return this.shoot(r,l)}}}return null}),rule_8C:B(8,function(t,n){if(3===t.round&&this.winning(t))for(var i=this.playerPossibleUnits,s=this.armiesAndUnits(t,n)[1],e=this.livingEnemyUnits(t,n),r=0;r<i.length;r++){var o=i[r],a=this.enemyShootableUnits(t,n,o);if(this.canBeKilled(t,n,o))for(var l=0;l<s.length;l++){var h=s[l];if(o.cost()<h.cost()&&this.canAssist(t,n,o,h))for(var u=0;u<e.length;u++){var c=e[u];if(this.willWoundShooting(t,c,o))for(var f=0;f<a.length;f++){var v=a[f];if(this.willWoundShooting(t,o,v)&&o.cost()>v.cost())return this.assist(t,n,o,h)}}}}return null}),rule_7A:B(7,function(t,n){if(3===t.round)for(var i=this.playerPossibleUnits,s=this.armiesAndUnits(t,n)[1],e=0;e<i.length;e++){var r=i[e];if(!this.canBeKilled(t,n,r))for(var o=0;o<s.length;o++){if(s[o].cost()>r.cost())for(var a=this.enemyShootableUnits(t,n,r),l=0;l<a.length;l++){var h=a[l];if(this.easiestToKill(a,h)&&this.canWound(t,r,h))return this.shoot(r,h)}}}return null}),rule_7B:B(7,function(t,n){if(3===t.round)for(var i=this.playerPossibleUnits,s=(this.armiesAndUnits(t,n)[1],this.livingEnemyUnits(t,n)),e=0;e<i.length;e++){var r=i[e];if(this.canBeKilled(t,n,r))for(var o=this.enemyShootableUnits(t,n,r),a=0;a<o.length;a++){var l=o[a];if(l.cost()===this.mostExpensiveUnit(s).cost()&&this.canKill(t,r,l)&&this.willWoundShooting(t,r,l))for(var h=0;h<s.length;h++){var u=s[h];if(this.willWoundShooting(t,u,r))return this.shoot(r,l)}}}return null}),rule_7C:B(7,function(t,n){if(3===t.round)for(var i=this.playerPossibleUnits,s=(this.armiesAndUnits(t,n)[1],this.livingEnemyUnits(t,n)),e=0;e<i.length;e++){var r=i[e];if(this.canBeKilled(t,n,r))for(var o=this.enemyShootableUnits(t,n,r),a=0;a<o.length;a++){var l=o[a];if(r.cost()<l.cost()&&this.canKill(t,r,l)&&this.willWoundShooting(t,r,l))for(var h=0;h<s.length;h++){var u=s[h];if(this.willWoundShooting(t,u,r))return this.shoot(r,l)}}}return null}),rule_7D:B(7,function(t,n){if(3===t.round&&!this.winning(t))for(var i=this.playerPossibleUnits,s=(this.armiesAndUnits(t,n)[1],this.livingEnemyUnits(t,n)),e=0;e<i.length;e++){var r=i[e];if(this.canBeKilled(t,n,r))for(var o=0;o<s.length;o++){var a=s[o];if(r.cost()<a.cost()&&this.willWoundShooting(t,r,a))for(var l=this.enemyShootableUnits(t,n,r),h=0;h<l.length;h++){var u=l[h];if(this.willWoundShooting(t,u,r))return this.shoot(r,a)}}}return null}),rule_7E:B(7,function(t,n){if(3===t.round)for(var i=this.playerPossibleUnits,s=0;s<i.length;s++){var e=i[s],r=this.enemyShootableUnits(t,n,e);if(this.canBeKilled(t,n,e))for(var o=0;o<r.length;o++){var a=r[o];if(!this.willWoundShooting(t,e,a))for(var l=0;l<r.length;l++){var h=r[l];if(this.willWoundShooting(t,h,e))for(var u=0;u<i.length;u++){var c=i[u];if(e.cost()<c.cost()&&this.canAssist(t,n,e,c))return this.assist(t,n,e,c)}}}}return null}),rule_7F:B(7,function(t,n){if(3===t.round)for(var i=this.playerPossibleUnits,s=0;s<i.length;s++){var e=i[s],r=this.enemyShootableUnits(t,n,e);if(this.canBeKilled(t,n,e)&&this.canScape(t,n,e))for(var o=0;o<r.length;o++){var a=r[o];if(!this.willWoundShooting(t,e,a))for(var l=0;l<r.length;l++){var h=r[l];if(this.willWoundShooting(t,h,e))for(var u=0;u<i.length;u++){var c=i[u];if(e.cost()<c.cost()&&!this.canAssist(t,n,e,c))return this.scape(t,n,e)}}}}return null}),rule_6A:B(6,function(t,n){if(3===t.round)for(var i=this.playerPossibleUnits,s=0;s<i.length;s++){var e=i[s],r=this.shootingKillableUnits(t,n,e);if(!this.canBeKilled(t,n,e))for(var o=0;o<r.length;o++){var a=r[o];if(a.cost()===this.mostExpensiveUnit(r).cost())return this.shoot(e,a)}}return null}),rule_6B:B(6,function(t,n){if(3===t.round)for(var i=this.playerPossibleUnits,s=0;s<i.length;s++){var e=i[s],r=this.shootingKillableUnits(t,n,e);if(this.canBeKilled(t,n,e))for(var o=this.enemyShootableUnits(t,n,e),a=0;a<o.length;a++){var l=o[a];if(this.willWoundShooting(t,l,e))for(var h=0;h<r.length;h++){var u=r[h];if(e.cost()>u.cost()&&this.willWoundShooting(t,e,u))return this.shoot(e,l)}}}return null}),rule_6C:B(6,function(t,n){if(3===t.round)for(var i=this.playerPossibleUnits,s=0;s<i.length;s++){var e=i[s];if(this.canBeKilled(t,n,e))for(var r=this.enemyShootableUnits(t,n,e),o=0;o<r.length;o++){var a=r[o];if(this.willWoundShooting(t,a,e)&&this.canScape(t,n,e))return this.scape(t,n,e)}}return null}),rule_5A:B(5,function(t,n){if(0===t.round)for(var i=this.playerPossibleUnits,s=0;s<i.length;s++)for(var e=i[s],r=this.enemyShootableUnits(t,n,e),o=0;o<r.length;o++){var a=r[o];if(this.canKillShooting(t,e,a)&&this.willWoundALotShooting(t,e,a))return this.shoot(e,a)}return null}),rule_5B:B(5,function(t,n){if(1===t.round)for(var i=this.playerPossibleUnits,s=0;s<i.length;s++)for(var e=i[s],r=this.enemyShootableUnits(t,n,e),o=0;o<r.length;o++){var a=r[o];if(this.canKillShooting(t,e,a)&&this.willWoundALotShooting(t,e,a))return this.shoot(e,a)}return null}),rule_5C:B(5,function(t,n){if(2===t.round)for(var i=this.playerPossibleUnits,s=0;s<i.length;s++)for(var e=i[s],r=this.enemyShootableUnits(t,n,e),o=0;o<r.length;o++){var a=r[o];if(this.canKillShooting(t,e,a)&&this.willWoundALotShooting(t,e,a))return this.shoot(e,a)}return null}),rule_5D:B(5,function(t,n){if(1===t.round)for(var i=this.playerPossibleUnits,s=0;s<i.length;s++)for(var e=i[s],r=this.enemyShootableUnits(t,n,e),o=0;o<r.length;o++){var a=r[o];if(this.canKill(t,a,e)&&this.willWoundShooting(t,e,a))return this.shoot(e,a)}return null}),rule_5E:B(5,function(t,n){if(2===t.round)for(var i=this.playerPossibleUnits,s=0;s<i.length;s++)for(var e=i[s],r=this.enemyShootableUnits(t,n,e),o=0;o<r.length;o++){var a=r[o];if(this.canKill(t,a,e)&&this.willWoundShooting(t,e,a))return this.shoot(e,a)}return null}),rule_5F:B(5,function(t,n){if(1===t.round)for(var i=this.playerPossibleUnits,s=0;s<i.length;s++)for(var e=i[s],r=this.enemyShootableUnits(t,n,e),o=0;o<r.length;o++){var a=r[o];if(this.canKill(t,a,e)&&this.canScape(t,n,e))return this.scape(t,n,e)}return null}),rule_5G:B(5,function(t,n){if(2===t.round)for(var i=this.playerPossibleUnits,s=0;s<i.length;s++)for(var e=i[s],r=this.enemyShootableUnits(t,n,e),o=0;o<r.length;o++){var a=r[o];if(this.canKill(t,a,e)&&this.canScape(t,n,e))return this.scape(t,n,e)}return null}),rule_4A:B(4,function(t,n){if(0===t.round)for(var i=this.playerPossibleUnits,s=0;s<i.length;s++)for(var e=i[s],r=this.enemyShootableUnits(t,n,e),o=0;o<r.length;o++){var a=r[o];if(this.canKillShooting(t,e,a))return this.shoot(e,a)}return null}),rule_4B:B(4,function(t,n){if(1===t.round)for(var i=this.playerPossibleUnits,s=0;s<i.length;s++)for(var e=i[s],r=this.enemyShootableUnits(t,n,e),o=0;o<r.length;o++){var a=r[o];if(this.canKillShooting(t,e,a))return this.shoot(e,a)}return null}),rule_4C:B(4,function(t,n){if(2===t.round)for(var i=this.playerPossibleUnits,s=0;s<i.length;s++)for(var e=i[s],r=this.enemyShootableUnits(t,n,e),o=0;o<r.length;o++){var a=r[o];if(this.canKillShooting(t,e,a))return this.shoot(e,a)}return null}),rule_4D:B(4,function(t,n){if(3===t.round&&this.winning(t))for(var i=this.playerPossibleUnits,s=this.armiesAndUnits(t,n)[1],e=0;e<i.length;e++){var r=i[e];if(!this.canBeKilled(t,n,r))for(var o=0;o<s.length;o++){var a=s[o];if(a.cost()>r.cost()&&this.canAssist(t,n,r,a))return this.assist(t,n,r,a)}}return null}),rule_4E:B(4,function(t,n){if(3===t.round&&this.winning(t))for(var i=this.playerPossibleUnits,s=this.armiesAndUnits(t,n)[1],e=0;e<i.length;e++){var r=i[e];if(!this.canBeKilled(t,n,r))for(var o=this.enemyShootableUnits(t,n,r),a=0;a<o.length;a++){var l=o[a];if(this.canWound(t,r,l)&&this.easiestToKill(o,l))for(var h=0;h<s.length;h++){var u=s[h];if(u.cost()>r.cost()&&!this.canAssist(t,n,r,u))return this.shoot(r,l)}}}return null}),rule_3A:B(3,function(t,n){if(0===t.round)for(var i=this.playerPossibleUnits,s=0;s<i.length;s++)for(var e=i[s],r=this.enemyShootableUnits(t,n,e),o=0;o<r.length;o++){var a=r[o];if("sniper"===this.classification(e)&&this.unitIsStrongest(r,a))return this.shoot(e,a)}return null}),rule_3B:B(3,function(t,n){if(0===t.round)for(var i=this.playerPossibleUnits,s=0;s<i.length;s++)for(var e=i[s],r=this.enemyShootableUnits(t,n,e),o=0;o<r.length;o++){var a=r[o];if(this.maxRangeInUnits(i,e)&&this.unitIsStrongest(r,a))return this.shoot(e,a)}return null}),rule_3C:B(3,function(t,n){if(0===t.round)for(var i=this.playerPossibleUnits,s=this.armiesAndUnits(t,n)[1],e=0;e<i.length;e++)for(var r=i[e],o=0;o<s.length;o++){var a=s[o];if(this.wounded(a)&&this.canAssist(t,n,r,a))return this.assist(t,n,r,a)}return null}),rule_3D:B(3,function(t,n){if(1===t.round)for(var i=this.playerPossibleUnits,s=this.armiesAndUnits(t,n)[1],e=0;e<i.length;e++)for(var r=i[e],o=0;o<s.length;o++){var a=s[o];if(this.wounded(a)&&this.canAssist(t,n,r,a))return this.assist(t,n,r,a)}return null}),rule_3E:B(3,function(t,n){if(2===t.round)for(var i=this.playerPossibleUnits,s=this.armiesAndUnits(t,n)[1],e=0;e<i.length;e++)for(var r=i[e],o=0;o<s.length;o++){var a=s[o];if(this.wounded(a)&&this.canAssist(t,n,r,a))return this.assist(t,n,r,a)}return null}),rule_3F:B(3,function(t,n){if(3===t.round)for(var i=this.playerPossibleUnits,s=this.livingEnemyUnits(t,n),e=this.armiesAndUnits(t,n)[1],r=0;r<i.length;r++)for(var o=i[r],a=0;a<e.length;a++){var l=e[a];if(l.cost()>o.cost()&&this.canAssist(t,n,o,l))for(var h=0;h<s.length;h++){var u=s[h];if(!this.canKill(t,u,o))return this.assist(t,n,o,l)}}return null}),rule_3G:B(3,function(t,n){var i=this.playerPossibleUnits;if(0===t.round)for(var s=0;s<i.length;s++){var e=i[s],r=this.enemyShootableUnits(t,n,e);if(r.length>1)for(var o=0;o<r.length;o++){var a=r[o];if(a.cost()===this.mostExpensiveUnit(r).cost())return this.shoot(e,a)}}return null}),rule_3H:B(3,function(t,n){if(2===t.round)for(var i=this.playerPossibleUnits,s=this.armiesAndUnits(t,n)[1],e=0;e<i.length;e++)for(var r=i[e],o=0;o<s.length;o++){var a=s[o];if(a.livingModels().length<a.size()&&this.canAssist(t,n,r,a))return this.assist(t,n,r,a)}return null}),rule_3I:B(3,function(t,n){if(1===t.round)for(var i=this.playerPossibleUnits,s=this.armiesAndUnits(t,n)[1],e=0;e<i.length;e++)for(var r=i[e],o=0;o<s.length;o++){var a=s[o];if(a.livingModels().length<a.size()&&this.canAssist(t,n,r,a))return this.assist(t,n,r,a)}return null}),rule_3J:B(3,function(t,n){if(0===t.round)for(var i=this.playerPossibleUnits,s=this.armiesAndUnits(t,n)[1],e=0;e<i.length;e++)for(var r=i[e],o=0;o<s.length;o++){var a=s[o];if(a.livingModels().length<a.size()&&this.canAssist(t,n,r,a))return this.assist(t,n,r,a)}return null}),rule_3K:B(3,function(t,n){if(0===t.round)for(var i=this.playerPossibleUnits,s=0;s<i.length;s++)for(var e=i[s],r=this.enemyShootableUnits(t,n,e),o=0;o<r.length;o++){var a=r[o];if(this.canShoot_(t,e,a,!1)&&this.unitIsStrongest(r,a))return this.shoot(e,a)}return null}),rule_3L:B(3,function(t,n){if(0===t.round)for(var i=this.playerPossibleUnits,s=this.armiesAndUnits(t,n)[1].concat(this.armiesAndUnits(t,n)[3]),e=0;e<i.length;e++)for(var r=i[e],o=this.enemyShootableUnits(t,n,r),a=0;a<o.length;a++){var l=o[a];if(this.willWoundShooting(t,r,l)&&this.unitIsStrongest(s,l))return this.shoot(r,l)}return null}),rule_3M:B(3,function(t,n){if(1===t.round)for(var i=this.playerPossibleUnits,s=0;s<i.length;s++)for(var e=i[s],r=this.enemyShootableUnits(t,n,e),o=0;o<r.length;o++){var a=r[o];if(this.willWoundShooting(t,e,a)&&this.unitIsStrongest(r,a))return this.shoot(e,a)}return null}),rule_3N:B(3,function(t,n){if(1===t.round)for(var i=this.playerPossibleUnits,s=this.armiesAndUnits(t,n)[1].concat(this.armiesAndUnits(t,n)[3]),e=0;e<i.length;e++)for(var r=i[e],o=this.enemyShootableUnits(t,n,r),a=0;a<o.length;a++){var l=o[a];if(this.willWoundShooting(t,r,l)&&this.unitIsStrongest(s,l))return this.shoot(r,l)}return null}),rule_3O:B(3,function(t,n){if(2===t.round)for(var i=this.playerPossibleUnits,s=0;s<i.length;s++)for(var e=i[s],r=this.enemyShootableUnits(t,n,e),o=0;o<r.length;o++){var a=r[o];if(this.willWoundShooting(t,e,a)&&this.unitIsStrongest(r,a))return this.shoot(e,a)}return null}),rule_3P:B(3,function(t,n){if(2===t.round)for(var i=this.playerPossibleUnits,s=0;s<i.length;s++)for(var e=i[s],r=this.enemyShootableUnits(t,n,e),o=0;o<r.length;o++){var a=r[o];if(this.willWoundShooting(t,e,a)&&this.easiestToKill(r,a))return this.shoot(e,a)}return null}),rule_3Q:B(3,function(t,n){if(0===t.round)for(var i=this.playerPossibleUnits,s=0;s<i.length;s++){var e=i[s];if("troop"===this.classification(e))for(var r=this.enemyShootableUnits(t,n,e),o=0;o<r.length;o++){var a=r[o];if(this.willWoundShooting(t,e,a)&&this.unitIsStrongest(r,a))return this.shoot(e,a)}}return null}),rule_3R:B(3,function(t,n){if(0===t.round)for(var i=this.playerPossibleUnits,s=this.armiesAndUnits(t,n)[1],e=0;e<i.length;e++){var r=i[e];if(r.cost()===this.cheapestUnit(s).cost())for(var o=this.enemyShootableUnits(t,n,r),a=0;a<o.length;a++){var l=o[a];if(this.willWoundShooting(t,r,l)&&this.unitIsStrongest(o,l))return this.shoot(r,l)}}return null}),rule_3S:B(3,function(t,n){if(0===t.round)for(var i=this.playerPossibleUnits,s=this.armiesAndUnits(t,n)[1].concat(this.armiesAndUnits(t,n)[3]),e=0;e<i.length;e++){var r=i[e];if("troop"===this.classification(r))for(var o=this.enemyShootableUnits(t,n,r),a=0;a<o.length;a++){var l=o[a];if(this.willWoundShooting(t,r,l)&&this.unitIsStrongest(s,l))return this.shoot(r,l)}}return null}),rule_3T:B(3,function(t,n){for(var i=this.playerPossibleUnits,s=this.armiesAndUnits(t,n),e=s[1],r=e.concat(s[3]),o=0;o<i.length;o++)for(var a=i[o],l=0;l<e.length;l++){var h=e[l];if(this.wounded(h)&&this.canAssist(t,n,a,h))for(var u=this.enemyShootableUnits(t,n,a),c=0;c<u.length;c++){var f=u[c];if(this.willWoundShooting(t,a,f)&&this.unitIsStrongest(r,f))return this.assist(t,n,a,h)}}return null}),rule_2A:B(2,function(t,n){if(0===t.round)for(var i=this.playerPossibleUnits,s=0;s<i.length;s++){var e=i[s],r=this.enemyAssaultableUnits(t,n,e);if(r.length>0)for(var o=0;o<r.length;o++){var a=r[o];if(this.wounded(a))return this.assault(e,a)}}return null}),rule_2B:B(2,function(t,n){if(0===t.round)for(var i=this.playerPossibleUnits,s=0;s<i.length;s++){var e=i[s];if("fastAttack"===this.classification(e))for(var r=this.enemyShootableUnits(t,n,e),o=0;o<r.length;o++){var a=r[o];return this.shoot(e,a)}}return null}),rule_2C:B(2,function(t,n){if(1===t.round)for(var i=this.playerPossibleUnits,s=0;s<i.length;s++){var e=i[s];if("fastAttack"===this.classification(e))for(var r=this.enemyShootableUnits(t,n,e),o=0;o<r.length;o++){var a=r[o];return this.shoot(e,a)}}return null}),rule_2D:B(2,function(t,n){if(2===t.round)for(var i=this.playerPossibleUnits,s=0;s<i.length;s++){var e=i[s];if("fastAttack"===this.classification(e))for(var r=this.enemyShootableUnits(t,n,e),o=0;o<r.length;o++){var a=r[o];return this.shoot(e,a)}}return null}),rule_2E:B(2,function(t,n){if(0===t.round)for(var i=this.playerPossibleUnits,s=this.armiesAndUnits(t,n)[1],e=0;e<i.length;e++){var r=i[e];if("heavySupport"===this.classification(r))for(var o=0;o<s.length;o++){var a=s[o];if(!a.isEnabled&&this.canAssist(t,n,r,a))return this.assist(t,n,r,a)}}return null}),rule_2F:B(2,function(t,n){if(0===t.round)for(var i=this.playerPossibleUnits,s=this.armiesAndUnits(t,n)[1],e=0;e<i.length;e++){var r=i[e];if("heavySupport"===this.classification(r))for(var o=0;o<s.length;o++){var a=s[o];if(this.canAssist(t,n,r,a))return this.assist(t,n,r,a)}}return null}),rule_2G:B(2,function(t,n){if(1===t.round)for(var i=this.playerPossibleUnits,s=this.armiesAndUnits(t,n)[1],e=0;e<i.length;e++){var r=i[e];if("heavySupport"===this.classification(r))for(var o=0;o<s.length;o++){var a=s[o];if(!a.isEnabled&&this.canAssist(t,n,r,a))return this.assist(t,n,r,a)}}return null}),rule_2H:B(2,function(t,n){if(1===t.round)for(var i=this.playerPossibleUnits,s=this.armiesAndUnits(t,n)[1],e=0;e<i.length;e++){var r=i[e];if("heavySupport"===this.classification(r))for(var o=0;o<s.length;o++){var a=s[o];if(this.canAssist(t,n,r,a))return this.assist(t,n,r,a)}}return null}),rule_2I:B(2,function(t,n){if(2===t.round)for(var i=this.playerPossibleUnits,s=this.armiesAndUnits(t,n)[1],e=0;e<i.length;e++){var r=i[e];if("heavySupport"===this.classification(r))for(var o=0;o<s.length;o++){var a=s[o];if(!a.isEnabled&&this.canAssist(t,n,r,a))return this.assist(t,n,r,a)}}return null}),rule_2J:B(2,function(t,n){if(2===t.round)for(var i=this.playerPossibleUnits,s=this.armiesAndUnits(t,n)[1],e=0;e<i.length;e++){var r=i[e];if("heavySupport"===this.classification(r))for(var o=0;o<s.length;o++){var a=s[o];if(this.canAssist(t,n,r,a))return this.assist(t,n,r,a)}}return null}),rule_2K:B(2,function(t,n){if(0===t.round)for(var i=this.playerPossibleUnits,s=this.armiesAndUnits(t,n)[1],e=0;e<i.length;e++){var r=i[e];if("troop"===this.classification(r))for(var o=0;o<s.length;o++){var a=s[o];if(!a.isEnabled&&this.canAssist(t,n,r,a))return this.assist(t,n,r,a)}}return null}),rule_2L:B(2,function(t,n){if(0===t.round)for(var i=this.playerPossibleUnits,s=this.armiesAndUnits(t,n)[1],e=0;e<i.length;e++){var r=i[e];if("troop"===this.classification(r))for(var o=0;o<s.length;o++){var a=s[o];if(this.canAssist(t,n,r,a))return this.assist(t,n,r,a)}}return null}),rule_2M:B(2,function(t,n){if(1===t.round)for(var i=this.playerPossibleUnits,s=this.armiesAndUnits(t,n)[1],e=0;e<i.length;e++){var r=i[e];if("troop"===this.classification(r))for(var o=0;o<s.length;o++){var a=s[o];if(!a.isEnabled&&this.canAssist(t,n,r,a))return this.assist(t,n,r,a)}}return null}),rule_2N:B(1,function(t,n){if(0===t.round)for(var i=this.playerPossibleUnits,s=this.armiesAndUnits(t,n)[1],e=0;e<i.length;e++){var r=i[e];if("troop"===this.classification(r))for(var o=0;o<s.length;o++){var a=s[o];if(this.canAssist(t,n,r,a))return this.assist(t,n,r,a)}}return null}),rule_2O:B(2,function(t,n){if(2===t.round)for(var i=this.playerPossibleUnits,s=this.armiesAndUnits(t,n)[1],e=0;e<i.length;e++){var r=i[e];if("troop"===this.classification(r))for(var o=0;o<s.length;o++){var a=s[o];if(!a.isEnabled&&this.canAssist(t,n,r,a))return this.assist(t,n,r,a)}}return null}),rule_2P:B(2,function(t,n){if(2===t.round)for(var i=this.playerPossibleUnits,s=this.armiesAndUnits(t,n)[1],e=0;e<i.length;e++){var r=i[e];if("troop"===this.classification(r))for(var o=0;o<s.length;o++){var a=s[o];if(this.canAssist(t,n,r,a))return this.assist(t,n,r,a)}}return null}),rule_2Q:B(2,function(t,n){if(0===t.round)for(var i=this.playerPossibleUnits,s=0;s<i.length;s++){var e=i[s];if("sniper"===this.classification(e))for(var r=this.enemyShootableUnits(t,n,e),o=0;o<r.length;o++){var a=r[o];return this.shoot(e,a)}}return null}),rule_2R:B(2,function(t,n){if(1===t.round)for(var i=this.playerPossibleUnits,s=0;s<i.length;s++){var e=i[s];if("sniper"===this.classification(e))for(var r=this.enemyShootableUnits(t,n,e),o=0;o<r.length;o++){var a=r[o];return this.shoot(e,a)}}return null}),rule_2S:B(2,function(t,n){if(2===t.round)for(var i=this.playerPossibleUnits,s=0;s<i.length;s++){var e=i[s];if("sniper"===this.classification(e))for(var r=this.enemyShootableUnits(t,n,e),o=0;o<r.length;o++){var a=r[o];return this.shoot(e,a)}}return null}),rule_1A:B(1,function(t,n){if(0===t.round)for(var i=this.playerPossibleUnits,s=0;s<i.length;s++){var e=i[s];if(this.canScape(t,n,e))return this.scape(t,n,e)}return null}),rule_1B:B(1,function(t,n){if(1===t.round)for(var i=this.playerPossibleUnits,s=0;s<i.length;s++){var e=i[s];if(this.canScape(t,n,e))return this.scape(t,n,e)}return null}),rule_1C:B(1,function(t,n){if(2===t.round)for(var i=this.playerPossibleUnits,s=0;s<i.length;s++)for(var e=i[s],r=this.enemyShootableUnits(t,n,e),o=0;o<r.length;o++){var a=r[o];return this.shoot(e,a)}return null}),rule_1D:B(1,function(t,n){if(3===t.round)for(var i=this.playerPossibleUnits,s=0;s<i.length;s++)for(var e=i[s],r=this.enemyAssaultableUnits(t,n,e),o=0;o<r.length;o++){var a=r[o];return this.assault(e,a)}return null}),rule_1E:B(1,function(t,n){for(var i=this.playerPossibleUnits,s=0;s<i.length;s++)for(var e=i[s],r=this.enemyShootableUnits(t,n,e),o=0;o<r.length;o++){var a=r[o];return this.shoot(e,a)}return null}),rule_1F:B(1,function(t,n){for(var i=this.playerPossibleUnits,s=0;s<i.length;s++){var e=i[s];if(0==this.enemyShootableUnits(t,n,e).length)for(var r=this.livingEnemyUnits(t,n),o=0;o<r.length;o++){var a=r[o];if(this.easiestToKill(r,a))return this.getCloseTo(t,e,a)}}return null})}),k=c.DynamicScriptingSinPesosPlayer=r(e.Player,{constructor:function(t){e.Player.call(this,t),l(this,t).array("rules",{defaultValue:[]}),this.__pendingActions__=[],this.rules=this.ownRules(),this.sortRules(),this.playerPossibleUnits=[],this.playerShootableUnits=[],this.playerAssaultableUnits=[]},ownRules:function(){var t=this;return Object.keys(Object.getPrototypeOf(this)).map(function(n){return[t[n],1]}).filter(function(t){var n=t[0];return"function"==typeof n&&n.name&&"rule"===n.name.substr(0,4)})},sortRules:function(){this.rules.sort(function(t,n){return n[0].priority-t[0].priority||n[1]-t[1]})},firstRules:function(t,n,i){for(var s,e=[],r=0,o=this.rules.length;r<o;r++)this.rules[r][0].priority==i&&(s=this.rules[r])[0].call(this,t,n)&&e.push(s);return e},decision:function(t,n){var i,s;if(t.synchronizeMetagame(),this.playerPossibleUnits=this.possibleUnits(t,n),this.playerShootableUnits=this.allShootableUnits(t,n),this.playerAssaultableUnits=this.allAssaultableUnits(t,n),this.__pendingActions__.length<1)for(var e=12;e>0;){var r=this.firstRules(t,n,e);if(r.length>0){if(s=(i=r[Math.floor(Math.random()*r.length)])[0].call(this,t,n))return s.forEach(function(t){t.__rule__=i}),this.__pendingActions__=this.__pendingActions__.concat(s),this.__pendingActions__.shift()}else e-=1}return h(this.__pendingActions__.length<1,"No rule applied to game!"),this.__pendingActions__.shift()},"static __SERMAT__":{identifier:"DynamicScriptingSinPesosPlayer",serializer:function(t){return this.serializeAsProperties(t,["name","rules"])}},shoot:function(t,n){return[new m(t.id),new U(t.id,n.id)]},assault:function(t,n){return[new m(t.id),new b(t.id,n.id)]},move:function(t,n,i){return i?[new m(t.id),n,new U(t.id,i.id)]:[new m(t.id),n,new y(t.id)]},scapeAux:function(t,n,i,s){for(var e=0;e<i.length;e++){var r=i[e],o=[];if(this.canHide(t,s,r)){for(var a=this.hideMoves(t,s,r),l=0;l<a.length;l++)if(t.terrain.distance(r.position,a[l].position)<=r.maxRange()+6)return this.move(s,a[l]);o=o.concat(a)}if(this.canRun(t,s,r)){for(var h=this.runMoves(t,s,r),u=0;u<h.length;u++)if(t.terrain.distance(r.position,h[u].position)<=r.maxRange()+6)return this.move(s,h[u]);o=o.concat(h)}if(o.length>0)return this.move(s,o[Math.floor(Math.random()*o.length)])}},scape:function(t,n,i){var s=this.mostDangerousUnits(t,n,i),e=this.scapeAux(t,n,s,i);if(e)return e;this.dangerousUnits(t,n,i);var r=this.scapeAux(t,n,s,i);if(r)return r;console.log("no escapa cuando deberia");var o=i.getMoveActions(t);return this.move(i,o[Math.floor(Math.random()*o.length)])},assistAux:function(t,n,i,s,e){for(var r=0;r<i.length;r++){var o,a=i[r];if(this.canAssault(t,s,a))return this.assault(s,a);if(this.canBlockSight(t,s,e,a)){var l=this.blockSightMovements(t,s,e,a);o=l[Math.floor(Math.random()*l.length)]}if(this.canShoot_(t,s,a,!0))return o?this.move(s,o,a):this.shoot(s,a);if(o)return this.move(s,o)}return null},assist:function(t,n,i,s){var e=this.mostDangerousUnits(t,n,s),r=this.assistAux(t,n,e,i,s);if(r)return r;var o=this.dangerousUnits(t,n,s),a=this.assistAux(t,n,o,i,s);if(a)return a;console.log("no asiste cuando deberia");var l=i.getMoveActions(t);return this.move(i,l[Math.floor(Math.random()*l.length)])},getFewMoveActions:function(t,n){var i=[],s=n.position[0],e=n.position[1];return i.push(new _(n.id,[s+1,e+1],!1)),i},getCloseTo:function(t,n,i){for(var s=this.interpolation(n.position,i.position),e=n.getMoveActions(t),r=[],o=0;o<e.length;o++){var a=e[o].position;s.forEach(function(t){a[0]===t[0]&&a[1]===t[1]&&r.push(e[o])})}for(var l=n.position,h=e[Math.floor(Math.random()*e.length)],u=0;u<r.length;u++){var c=r[u].position;t.terrain.distance(c,i.position)<t.terrain.distance(l,i.position)&&(l=c,h=r[u])}return this.move(n,h)},possibleUnits:function(t,n){var i=[];return this.armiesAndUnits(t,n)[1].forEach(function(t){t.isDead()||!t.isEnabled||t.isActive||i.push(t)}),i},shootableUnitsAux:function(t,n,i){var s=[],e=this.livingEnemyUnits(t,n);return i.getShootActions(t).forEach(function(t){e.forEach(function(n){t.targetId===n.id&&s.push(n)})}),s},allShootableUnits:function(t,n){for(var i=[],s=this.playerPossibleUnits,e=0;e<s.length;e++){var r,o=s[e];r=this.shootableUnitsAux(t,n,o),i[e]=[o,r]}return i},enemyShootableUnits:function(t,n,i){for(var s=[],e=0;e<this.playerShootableUnits.length;e++)this.playerShootableUnits[e][0]==i&&(s=this.playerShootableUnits[e][1]);return s},assaultableUnits:function(t,n,i){var s=[],e=this.livingEnemyUnits(t,n);return i.getAssaultActions(t).forEach(function(t){e.forEach(function(n){t.targetId===n.id&&s.push(n)})}),s},allAssaultableUnits:function(t,n){for(var i=[],s=this.playerPossibleUnits,e=0;e<s.length;e++){var r,o=s[e];r=this.assaultableUnits(t,n,o),i[e]=[o,r]}return i},enemyAssaultableUnits:function(t,n,i){for(var s=[],e=0;e<this.playerAssaultableUnits.length;e++)this.playerAssaultableUnits[e][0]==i&&(s=this.playerAssaultableUnits[e][1]);return s},canShoot_:function(t,n,i,s){return!(n.isDead()||!n.isEnabled||i.isDead()||t.terrain.canShoot(n,i)==1/0)},canAssault:function(t,n,i){return!(n.isDead()||!n.isEnabled||i.isDead()||!(t.terrain.canShoot(n,i)<=12))},interForX:function(t,n,i,s){for(var e=[],r=i,o=t+1;o<n;o++)e.push([parseInt(o),parseInt(r)]),r+=s;return e},interForY:function(t,n,i,s){for(var e=[],r=i,o=t+1;o<n;o++)e.push([parseInt(r),parseInt(o)]),r+=s;return e},interpolation:function(t,n){var i,s,e=0,r=t[0],o=n[0],a=t[1],l=n[1],h=Math.min(r,o),u=Math.max(r,o),c=Math.min(a,l),f=Math.max(a,l);return s=h===r?a:l,i=c===a?r:o,a===l?this.interForX(h,u,s,e):r===o?this.interForY(c,f,i,e):Math.abs(l-a)>=Math.abs(o-r)?(e=Math.abs(o-r)/Math.abs(l-a),this.interForY(c,f,i,e)):(e=Math.abs(l-a)/Math.abs(o-r),this.interForX(h,u,s,e))},blockSightMovements:function(t,n,i,s){for(var e=i.position,r=s.position,o=this.interpolation(e,r),a=[],l=n.getMoveActions(t),h=0;h<l.length;h++){var u=l[h].position;o.forEach(function(t){u[0]===t[0]&&u[1]===t[1]&&a.push(l[h])})}return a},canBlockSight:function(t,n,i,s){return this.blockSightMovements(t,n,i,s).length>0},canAssist:function(t,n,i,s){for(var e=this.dangerousUnits(t,n,s),r=!1,o=0;o<e.length;o++){var a=e[o];if(!(this.canBlockSight(t,i,s,a)||this.canShoot_(t,i,a,!0)||this.canAssault(t,i,a))){r=!1;break}r=!0}return r},canRun:function(t,n,i){var s=i.maxRange()+6;return!(n.isEnabled&&t.terrain.canShoot(i,n)<=s)},canHide:function(t,n,i){return!1},runMoves:function(t,n,i){for(var s=i.position,e=n.position,r=n.getMoveActions(t),o=r[Math.floor(Math.random()*r.length)],a=0;a<r.length;a++){var l=r[a].position;t.terrain.distance(l,s)>t.terrain.distance(e,s)&&(e=l,o=r[a])}return t.terrain.distance(i.position,e)<=i.maxRange()+6?(console.log("run y puede huir"),[o]):(console.log("run y huyo lo maximo q pudo pero igual lo alcanzan"),[o])},hideMoves:function(t,n,i){return[]},canScape:function(t,n,i){var s=this.mostDangerousUnits(t,n,i);if(0===s.length)return!1;for(var e=!0,r=0;r<s.length;r++){var o=s[r];this.canRun(t,i,o)||this.canHide(t,i,o)||(e=!1)}return e},mostDangerousUnits:function(t,n,i){for(var s=this.livingEnemyUnits(t,n),e=[],r=0;r<s.length;r++){var o=s[r];this.canKill(t,o,i)&&e.push(o)}return e},dangerousUnits:function(t,n,i){for(var s=this.livingEnemyUnits(t,n),e=[],r=0;r<s.length;r++){var o=s[r];(this.canShoot_(t,o,i,!0)||this.canAssault(t,o,i))&&e.push(o)}return e},canBeKilled:function(t,n,i){for(var s=this.armiesAndUnits(t,n)[3],e=0;e<s.length;e++)if(this.canKill(t,s[e],i))return!0;return!1},canKill:function(t,n,i){return!(n.isDead()||!n.isEnabled||i.isDead()||!this.canKillShooting(t,n,i)&&!this.canKillAssaulting(t,n,i))},canKillShooting:function(t,n,i){return!(n.isDead()||i.isDead()||!n.isEnabled||!(this.bestAttackResultShooting(t,n,i)>=100))},canKillAssaulting:function(t,n,i){return!(n.isDead()||i.isDead()||!n.isEnabled||!(this.bestAttackResultAssaulting(t,n,i)>=100))},bestAttackResult:function(t,n,i){if(!n.isDead()&&n.isEnabled&&!i.isDead()){var s=this.bestAttackResultShooting(t,n,i),e=this.bestAttackResultAssaulting(t,n,i),r=Math.max(s,e);return r}return 0},bestAttackResultShooting:function(t,n,i){if(!n.isDead()&&n.isEnabled&&!i.isDead()){var s=t.terrain.distance(n.position,i.position),e=0;n.livingModels().forEach(function(t){t.equipments.forEach(function(t){t.range>=s&&(e+=t.attacks)})});var r=i.livingModels().length,o=100*e/r;return o>100&&(o=100),o}return 0},bestAttackResultAssaulting:function(t,n,i){if(!n.isDead()&&n.isEnabled&&!i.isDead()&&this.canAssault(t,n,i)){var s=0;n.livingModels().forEach(function(t){t.equipments.forEach(function(t){0===t.range&&(s+=t.attacks)})});var e=i.livingModels().length,r=100*s/e;return r>100&&(r=100),r}return 0},shootingKillableUnits:function(t,n,i){for(var s=[],e=this.shootableUnitsAux(t,n,i),r=0;r<e.length;r++){var o=e[r];this.willKillShooting(t,i,o)&&s.push(o)}return s},livingEnemyUnits:function(t,n){return this.armiesAndUnits(t,n)[2].livingUnits()},armiesAndUnits:function(t,n){var i=t.armies[n],s=i.units,e=t.opponent(n),r=t.armies[e];return[i,s,r,r.units]},wounded:function(t){return t.livingModels().length<t.size()},canWoundALot:function(t,n,i){return!(n.isDead()||!n.isEnabled||i.isDead())&&this.bestAttackResult(t,n,i)>=75},canWound:function(t,n,i){return!(n.isDead()||!n.isEnabled||i.isDead())&&this.bestAttackResult(t,n,i)>0},maxCost:function(t){return o(t).map(function(t){t.cost()}).max(0)},mostExpensiveUnit:function(t){for(var n,i=0,s=0;s<t.length;s++)t[s].cost()>i&&(i=(n=t[s]).cost());return n},cheapestUnit:function(t){for(var n,i=0,s=0;s<t.length;s++)t[s].cost()>i&&(i=(n=t[s]).cost());return n},unitForce:function(t){var n=0;return t.livingModels().forEach(function(t){t.equipments.forEach(function(t){n+=t.attacks})}),t.quality*n+t.defense/2+t.cost()/10},unitIsStrongest:function(t,n){for(var i,s=0,e=0;e<t.length;e++)this.unitForce(t[e])>s&&(i=t[e],s=this.unitForce(i));return this.unitForce(n)===s},classification:function(t){return t.quality>=4&&t.defense<=3?"fastAttack":t.defense>=7?"heavySupport":t.size()>=5&&t.cost()<=130?"troop":t.maxRange()>=36?"sniper":""},maxRangeInUnits:function(t,n){var i=o(t).map(function(t){return t.maxRange()}).max(0);return n.maxRange()===i},easiestToKill:function(t,n){var i=o(t).map(function(t){return t.livingModels().length*t.defense}).max(0);return n.livingModels().length*n.defense===i},expectedResultShooting:function(t,n,i){if(this.canShoot_(t,n,i,!0)){var s=t.terrain.distance(n.position,i.position),e=0;n.livingModels().forEach(function(t){t.equipments.forEach(function(t){t.range>=s&&(e+=t.attacks)})});for(var r=0,o=0,a=0;a<e;a++)r=Math.floor(3+4*Math.random()),n.quality>r&&(o+=1);for(var l=0,h=0;h<o;h++)r=Math.floor(1+6*Math.random()),i.defense>r&&(l+=1);var u=100*(o-l)/i.livingModels().length;return u>100&&(u=100),u}return 0},expectedResultAssaulting:function(t,n,i){return 0},willKillShooting:function(t,n,i){return 100===this.expectedResultShooting(t,n,i)},willWoundALotShooting:function(t,n,i){return this.expectedResultShooting(t,n,i)>75},willWoundHalfShooting:function(t,n,i){return this.expectedResultShooting(t,n,i)>=50},willWoundShooting:function(t,n,i){return this.expectedResultShooting(t,n,i)>0},willKillAssaulting:function(t,n,i){return 100===this.expectedResultAssaulting(t,n,i)},willWoundALotAssaulting:function(t,n,i){return this.expectedResultAssaulting(t,n,i)>75},willWoundHalfAssaulting:function(t,n,i){return this.expectedResultAssaulting(t,n,i)>=50},willWoundAssaulting:function(t,n,i){return this.expectedResultAssaulting(t,n,i)>0},winning:function(t){var n=t.activePlayer(),i=t.players[0];return n===t.players[0]&&(i=t.players[1]),t.scores(n)>t.scores(i)},losingGameByUnitElimination:function(t,n){var i=t.activePlayer(),s=t.players[0];return i===t.players[0]&&(s=t.players[1]),t.scores(i)-n.cost()<t.scores(s)},winningActivation:function(t,n){if(4===t.round){var s=t.activePlayer(),e=t.players[0];s===t.players[0]&&(e=t.players[1]);var r=[];this.livingEnemyUnits(t,n).forEach(function(n){t.scores(s)>t.scores(e)-n.cost()&&r.push(n)});var o=this.possibleUnits(t,n);for(i=0;i<o.length;i++){var a=o[i];for(j=0;j<r.length;j++){var l=r[j];if(this.canKill(t,a,l)||this.canPin(t,a,l))return!0}}}return!1},canPin:function(t,n,i){if(this.canAssault(t,n,i)){var s=0;if(n.livingModels().forEach(function(t){t.equipments.forEach(function(t){0===t.range&&(s+=t.attacks)})}),s>=i.size()/2)return!0}return!1},isMelee:function(t){var n=0,i=0,s=t.livingModels();return s.forEach(function(t){t.equipments.forEach(function(t){t.range>=n&&(n=t.range,i=t.attacks)})}),0===n||(s.forEach(function(t){t.equipments.forEach(function(t){if(0===t.range&&t.attacks>i)return!0})}),!1)},rule_12A:B(12,function(t,n){if(3===t.round&&!this.winning(t))for(var i=this.playerPossibleUnits,s=this.armiesAndUnits(t,n)[1],e=this.livingEnemyUnits(t,n),r=0;r<i.length;r++){var o=i[r],a=this.enemyShootableUnits(t,n,o);if(this.canBeKilled(t,n,o))for(var l=0;l<e.length;l++){var h=e[l];if(this.willWoundShooting(t,h,o))for(var u=0;u<a.length;u++){var c=a[u];if(this.willWoundShooting(t,o,c)&&o.cost()>c.cost())for(var f=0;f<s.length;f++){var v=s[f];if(v.cost()>o.cost()&&this.canAssist(t,n,o,v))return this.assist(t,n,o,v)}}}}return null}),rule_12B:B(12,function(t,n){if(3===t.round&&!this.winning(t)&&this.winningActivation(t,n))for(var i=this.playerPossibleUnits,s=(this.armiesAndUnits(t,n)[1],this.livingEnemyUnits(t,n)),e=0;e<i.length;e++){var r=i[e],o=this.enemyAssaultableUnits(t,n,r);if(this.canBeKilled(t,n,r)&&!this.canScape(t,n,r))for(var a=0;a<s.length;a++){var l=s[a];if(this.willWoundShooting(t,l,r))for(var h=0;h<o.length;h++){var u=o[h];if(this.willWoundHalfAssaulting(t,r,u)&&r.cost()>u.cost())return this.assault(r,u)}}}return null}),rule_12C:B(12,function(t,n){if(3===t.round&&!this.winning(t)&&this.winningActivation(t,n))for(var i=this.playerPossibleUnits,s=(this.armiesAndUnits(t,n)[1],this.livingEnemyUnits(t,n)),e=0;e<i.length;e++){var r=i[e],o=this.enemyAssaultableUnits(t,n,r);if(this.canBeKilled(t,n,r)&&this.canScape(t,n,r))for(var a=0;a<s.length;a++){var l=s[a];if(this.willWoundShooting(t,l,r))for(var h=0;h<o.length;h++){var u=o[h];if(this.willWoundHalfAssaulting(t,r,u)&&r.cost()>u.cost())return this.scape(t,n,r)}}}return null}),rule_12D:B(12,function(t,n){if(3===t.round&&!this.winning(t)&&this.winningActivation(t,n))for(var i=this.playerPossibleUnits,s=(this.armiesAndUnits(t,n)[1],this.livingEnemyUnits(t,n)),e=0;e<i.length;e++){var r=i[e],o=this.enemyShootableUnits(t,n,r);if(this.canBeKilled(t,n,r)&&!this.canScape(t,n,r))for(var a=0;a<s.length;a++){var l=s[a];if(this.willWoundShooting(t,l,r))for(var h=0;h<o.length;h++){var u=o[h];if(this.willWoundShooting(t,r,u)&&this.canKill(t,r,u)&&r.cost()>u.cost())return this.shoot(r,u)}}}return null}),rule_11A:B(11,function(t,n){if(3===t.round&&!this.winning(t))for(var i=this.playerPossibleUnits,s=(this.armiesAndUnits(t,n)[1],this.livingEnemyUnits(t,n)),e=0;e<i.length;e++){var r=i[e],o=this.enemyAssaultableUnits(t,n,r);if(this.canBeKilled(t,n,r)&&this.canScape(t,n,r))for(var a=0;a<s.length;a++){var l=s[a];if(this.willWoundShooting(t,l,r))for(var h=0;h<o.length;h++){var u=o[h];if(this.willWoundHalfAssaulting(t,r,u)&&r.cost()>u.cost())return this.scape(t,n,r)}}}return null}),rule_11B:B(11,function(t,n){if(3===t.round&&this.winning(t)&&this.winningActivation(t,n))for(var i=this.playerPossibleUnits,s=(this.armiesAndUnits(t,n)[1],this.livingEnemyUnits(t,n)),e=0;e<i.length;e++){var r=i[e],o=this.enemyAssaultableUnits(t,n,r);if(this.canBeKilled(t,n,r)&&this.canScape(t,n,r))for(var a=0;a<s.length;a++){var l=s[a];if(this.willWoundShooting(t,l,r))for(var h=0;h<o.length;h++){var u=o[h];if(this.willWoundHalfAssaulting(t,r,u)&&r.cost()>u.cost())return this.scape(t,n,r)}}}return null}),rule_11C:B(11,function(t,n){if(3===t.round&&this.winning(t)&&this.winningActivation(t,n))for(var i=this.playerPossibleUnits,s=(this.armiesAndUnits(t,n)[1],this.livingEnemyUnits(t,n)),e=0;e<i.length;e++){var r=i[e],o=this.enemyAssaultableUnits(t,n,r);if(this.canBeKilled(t,n,r)&&!this.canScape(t,n,r))for(var a=0;a<s.length;a++){var l=s[a];if(this.willWoundShooting(t,l,r))for(var h=0;h<o.length;h++){var u=o[h];if(this.willWoundHalfAssaulting(t,r,u)&&r.cost()>u.cost())return this.assault(r,u)}}}return null}),rule_11D:B(11,function(t,n){if(3===t.round&&this.winning(t)&&this.winningActivation(t,n))for(var i=this.playerPossibleUnits,s=(this.armiesAndUnits(t,n)[1],this.livingEnemyUnits(t,n)),e=0;e<i.length;e++){var r=i[e],o=this.enemyAssaultableUnits(t,n,r);if(this.canBeKilled(t,n,r)&&!this.losingGameByUnitElimination(t,r))for(var a=0;a<s.length;a++){var l=s[a];if(this.willWoundShooting(t,l,r))for(var h=0;h<o.length;h++){var u=o[h];if(this.willWoundHalfAssaulting(t,r,u)&&r.cost()>u.cost())return this.assault(r,u)}}}return null}),rule_10A:B(10,function(t,n){if(1===t.round)for(var i=this.playerPossibleUnits,s=0;s<i.length;s++){var e=i[s],r=this.enemyAssaultableUnits(t,n,e);if(this.isMelee(e))for(var o=0;o<r.length;o++){var a=r[o];if(this.unitIsStrongest(r,a)&&this.willWoundHalfAssaulting(t,e,a))return this.assault(e,a)}}return null}),rule_10B:B(10,function(t,n){if(2===t.round)for(var i=this.playerPossibleUnits,s=0;s<i.length;s++){var e=i[s],r=this.enemyAssaultableUnits(t,n,e);if(this.isMelee(e))for(var o=0;o<r.length;o++){var a=r[o];if(this.unitIsStrongest(r,a)&&this.willWoundHalfAssaulting(t,e,a))return this.assault(e,a)}}return null}),rule_9A:B(9,function(t,n){if(2===t.round)for(var i=this.playerPossibleUnits,s=0;s<i.length;s++)for(var e=i[s],r=this.enemyAssaultableUnits(t,n,e),o=0;o<r.length;o++){var a=r[o];if(this.easiestToKill(r,a)&&this.willWoundHalfAssaulting(t,e,a))return this.assault(e,a)}return null}),rule_9B:B(9,function(t,n){if(1===t.round)for(var i=this.playerPossibleUnits,s=0;s<i.length;s++)for(var e=i[s],r=this.enemyAssaultableUnits(t,n,e),o=0;o<r.length;o++){var a=r[o];if(this.easiestToKill(r,a)&&this.willWoundHalfAssaulting(t,e,a))return this.assault(e,a)}return null}),rule_8A:B(8,function(t,n){if(3===t.round&&this.winning(t))for(var i=this.playerPossibleUnits,s=this.armiesAndUnits(t,n)[1],e=0;e<i.length;e++){var r=i[e],o=this.enemyShootableUnits(t,n,r);if(!this.canBeKilled(t,n,r))for(var a=0;a<s.length;a++){var l=s[a];if(l.cost()>r.cost()&&!this.canAssist(t,n,r,l))for(var h=0;h<o.length;h++){var u=o[h];if(this.willKillShooting(t,r,u)&&u.cost()===this.mostExpensiveUnit(o).cost())return this.shoot(r,u)}}}return null}),rule_8B:B(8,function(t,n){if(3===t.round&&this.winning(t))for(var i=this.playerPossibleUnits,s=(this.armiesAndUnits(t,n)[1],this.livingEnemyUnits(t,n)),e=0;e<i.length;e++){var r=i[e],o=this.enemyShootableUnits(t,n,r);if(this.canBeKilled(t,n,r))for(var a=0;a<s.length;a++){var l=s[a];if(r.cost()<l.cost()&&this.canKill(t,r,l)&&this.willWoundShooting(t,r,l))for(var h=0;h<o.length;h++){var u=o[h];if(this.willWoundShooting(t,u,r))return this.shoot(r,l)}}}return null}),rule_8C:B(8,function(t,n){if(3===t.round&&this.winning(t))for(var i=this.playerPossibleUnits,s=this.armiesAndUnits(t,n)[1],e=this.livingEnemyUnits(t,n),r=0;r<i.length;r++){var o=i[r],a=this.enemyShootableUnits(t,n,o);if(this.canBeKilled(t,n,o))for(var l=0;l<s.length;l++){var h=s[l];if(o.cost()<h.cost()&&this.canAssist(t,n,o,h))for(var u=0;u<e.length;u++){var c=e[u];if(this.willWoundShooting(t,c,o))for(var f=0;f<a.length;f++){var v=a[f];if(this.willWoundShooting(t,o,v)&&o.cost()>v.cost())return this.assist(t,n,o,h)}}}}return null}),rule_7A:B(7,function(t,n){if(3===t.round)for(var i=this.playerPossibleUnits,s=this.armiesAndUnits(t,n)[1],e=0;e<i.length;e++){var r=i[e];if(!this.canBeKilled(t,n,r))for(var o=0;o<s.length;o++){if(s[o].cost()>r.cost())for(var a=this.enemyShootableUnits(t,n,r),l=0;l<a.length;l++){var h=a[l];if(this.easiestToKill(a,h)&&this.canWound(t,r,h))return this.shoot(r,h)}}}return null}),rule_7B:B(7,function(t,n){if(3===t.round)for(var i=this.playerPossibleUnits,s=(this.armiesAndUnits(t,n)[1],this.livingEnemyUnits(t,n)),e=0;e<i.length;e++){var r=i[e];if(this.canBeKilled(t,n,r))for(var o=this.enemyShootableUnits(t,n,r),a=0;a<o.length;a++){var l=o[a];if(l.cost()===this.mostExpensiveUnit(s).cost()&&this.canKill(t,r,l)&&this.willWoundShooting(t,r,l))for(var h=0;h<s.length;h++){var u=s[h];if(this.willWoundShooting(t,u,r))return this.shoot(r,l)}}}return null}),rule_7C:B(7,function(t,n){if(3===t.round)for(var i=this.playerPossibleUnits,s=(this.armiesAndUnits(t,n)[1],this.livingEnemyUnits(t,n)),e=0;e<i.length;e++){var r=i[e];if(this.canBeKilled(t,n,r))for(var o=this.enemyShootableUnits(t,n,r),a=0;a<o.length;a++){var l=o[a];if(r.cost()<l.cost()&&this.canKill(t,r,l)&&this.willWoundShooting(t,r,l))for(var h=0;h<s.length;h++){var u=s[h];if(this.willWoundShooting(t,u,r))return this.shoot(r,l)}}}return null}),rule_7D:B(7,function(t,n){if(3===t.round&&!this.winning(t))for(var i=this.playerPossibleUnits,s=(this.armiesAndUnits(t,n)[1],this.livingEnemyUnits(t,n)),e=0;e<i.length;e++){var r=i[e];if(this.canBeKilled(t,n,r))for(var o=0;o<s.length;o++){var a=s[o];if(r.cost()<a.cost()&&this.willWoundShooting(t,r,a))for(var l=this.enemyShootableUnits(t,n,r),h=0;h<l.length;h++){var u=l[h];if(this.willWoundShooting(t,u,r))return this.shoot(r,a)}}}return null}),rule_7E:B(7,function(t,n){if(3===t.round)for(var i=this.playerPossibleUnits,s=0;s<i.length;s++){var e=i[s],r=this.enemyShootableUnits(t,n,e);if(this.canBeKilled(t,n,e))for(var o=0;o<r.length;o++){var a=r[o];if(!this.willWoundShooting(t,e,a))for(var l=0;l<r.length;l++){var h=r[l];if(this.willWoundShooting(t,h,e))for(var u=0;u<i.length;u++){var c=i[u];if(e.cost()<c.cost()&&this.canAssist(t,n,e,c))return this.assist(t,n,e,c)}}}}return null}),rule_7F:B(7,function(t,n){if(3===t.round)for(var i=this.playerPossibleUnits,s=0;s<i.length;s++){var e=i[s],r=this.enemyShootableUnits(t,n,e);if(this.canBeKilled(t,n,e)&&this.canScape(t,n,e))for(var o=0;o<r.length;o++){var a=r[o];if(!this.willWoundShooting(t,e,a))for(var l=0;l<r.length;l++){var h=r[l];if(this.willWoundShooting(t,h,e))for(var u=0;u<i.length;u++){var c=i[u];if(e.cost()<c.cost()&&!this.canAssist(t,n,e,c))return this.scape(t,n,e)}}}}return null}),rule_6A:B(6,function(t,n){if(3===t.round)for(var i=this.playerPossibleUnits,s=0;s<i.length;s++){var e=i[s],r=this.shootingKillableUnits(t,n,e);if(!this.canBeKilled(t,n,e))for(var o=0;o<r.length;o++){var a=r[o];if(a.cost()===this.mostExpensiveUnit(r).cost())return this.shoot(e,a)}}return null}),rule_6B:B(6,function(t,n){if(3===t.round)for(var i=this.playerPossibleUnits,s=0;s<i.length;s++){var e=i[s],r=this.shootingKillableUnits(t,n,e);if(this.canBeKilled(t,n,e))for(var o=this.enemyShootableUnits(t,n,e),a=0;a<o.length;a++){var l=o[a];if(this.willWoundShooting(t,l,e))for(var h=0;h<r.length;h++){var u=r[h];if(e.cost()>u.cost()&&this.willWoundShooting(t,e,u))return this.shoot(e,l)}}}return null}),rule_6C:B(6,function(t,n){if(3===t.round)for(var i=this.playerPossibleUnits,s=0;s<i.length;s++){var e=i[s];if(this.canBeKilled(t,n,e))for(var r=this.enemyShootableUnits(t,n,e),o=0;o<r.length;o++){var a=r[o];if(this.willWoundShooting(t,a,e)&&this.canScape(t,n,e))return this.scape(t,n,e)}}return null}),rule_5A:B(5,function(t,n){if(0===t.round)for(var i=this.playerPossibleUnits,s=0;s<i.length;s++)for(var e=i[s],r=this.enemyShootableUnits(t,n,e),o=0;o<r.length;o++){var a=r[o];if(this.canKillShooting(t,e,a)&&this.willWoundALotShooting(t,e,a))return this.shoot(e,a)}return null}),rule_5B:B(5,function(t,n){if(1===t.round)for(var i=this.playerPossibleUnits,s=0;s<i.length;s++)for(var e=i[s],r=this.enemyShootableUnits(t,n,e),o=0;o<r.length;o++){var a=r[o];if(this.canKillShooting(t,e,a)&&this.willWoundALotShooting(t,e,a))return this.shoot(e,a)}return null}),rule_5C:B(5,function(t,n){if(2===t.round)for(var i=this.playerPossibleUnits,s=0;s<i.length;s++)for(var e=i[s],r=this.enemyShootableUnits(t,n,e),o=0;o<r.length;o++){var a=r[o];if(this.canKillShooting(t,e,a)&&this.willWoundALotShooting(t,e,a))return this.shoot(e,a)}return null}),rule_5D:B(5,function(t,n){if(1===t.round)for(var i=this.playerPossibleUnits,s=0;s<i.length;s++)for(var e=i[s],r=this.enemyShootableUnits(t,n,e),o=0;o<r.length;o++){var a=r[o];if(this.canKill(t,a,e)&&this.willWoundShooting(t,e,a))return this.shoot(e,a)}return null}),rule_5E:B(5,function(t,n){if(2===t.round)for(var i=this.playerPossibleUnits,s=0;s<i.length;s++)for(var e=i[s],r=this.enemyShootableUnits(t,n,e),o=0;o<r.length;o++){var a=r[o];if(this.canKill(t,a,e)&&this.willWoundShooting(t,e,a))return this.shoot(e,a)}return null}),rule_5F:B(5,function(t,n){if(1===t.round)for(var i=this.playerPossibleUnits,s=0;s<i.length;s++)for(var e=i[s],r=this.enemyShootableUnits(t,n,e),o=0;o<r.length;o++){var a=r[o];if(this.canKill(t,a,e)&&this.canScape(t,n,e))return this.scape(t,n,e)}return null}),rule_5G:B(5,function(t,n){if(2===t.round)for(var i=this.playerPossibleUnits,s=0;s<i.length;s++)for(var e=i[s],r=this.enemyShootableUnits(t,n,e),o=0;o<r.length;o++){var a=r[o];if(this.canKill(t,a,e)&&this.canScape(t,n,e))return this.scape(t,n,e)}return null}),rule_4A:B(4,function(t,n){if(0===t.round)for(var i=this.playerPossibleUnits,s=0;s<i.length;s++)for(var e=i[s],r=this.enemyShootableUnits(t,n,e),o=0;o<r.length;o++){var a=r[o];if(this.canKillShooting(t,e,a))return this.shoot(e,a)}return null}),rule_4B:B(4,function(t,n){if(1===t.round)for(var i=this.playerPossibleUnits,s=0;s<i.length;s++)for(var e=i[s],r=this.enemyShootableUnits(t,n,e),o=0;o<r.length;o++){var a=r[o];if(this.canKillShooting(t,e,a))return this.shoot(e,a)}return null}),rule_4C:B(4,function(t,n){if(2===t.round)for(var i=this.playerPossibleUnits,s=0;s<i.length;s++)for(var e=i[s],r=this.enemyShootableUnits(t,n,e),o=0;o<r.length;o++){var a=r[o];if(this.canKillShooting(t,e,a))return this.shoot(e,a)}return null}),rule_4D:B(4,function(t,n){if(3===t.round&&this.winning(t))for(var i=this.playerPossibleUnits,s=this.armiesAndUnits(t,n)[1],e=0;e<i.length;e++){var r=i[e];if(!this.canBeKilled(t,n,r))for(var o=0;o<s.length;o++){var a=s[o];if(a.cost()>r.cost()&&this.canAssist(t,n,r,a))return this.assist(t,n,r,a)}}return null}),rule_4E:B(4,function(t,n){if(3===t.round&&this.winning(t))for(var i=this.playerPossibleUnits,s=this.armiesAndUnits(t,n)[1],e=0;e<i.length;e++){var r=i[e];if(!this.canBeKilled(t,n,r))for(var o=this.enemyShootableUnits(t,n,r),a=0;a<o.length;a++){var l=o[a];if(this.canWound(t,r,l)&&this.easiestToKill(o,l))for(var h=0;h<s.length;h++){var u=s[h];if(u.cost()>r.cost()&&!this.canAssist(t,n,r,u))return this.shoot(r,l)}}}return null}),rule_3A:B(3,function(t,n){if(0===t.round)for(var i=this.playerPossibleUnits,s=0;s<i.length;s++)for(var e=i[s],r=this.enemyShootableUnits(t,n,e),o=0;o<r.length;o++){var a=r[o];if("sniper"===this.classification(e)&&this.unitIsStrongest(r,a))return this.shoot(e,a)}return null}),rule_3B:B(3,function(t,n){if(0===t.round)for(var i=this.playerPossibleUnits,s=0;s<i.length;s++)for(var e=i[s],r=this.enemyShootableUnits(t,n,e),o=0;o<r.length;o++){var a=r[o];if(this.maxRangeInUnits(i,e)&&this.unitIsStrongest(r,a))return this.shoot(e,a)}return null}),rule_3C:B(3,function(t,n){if(0===t.round)for(var i=this.playerPossibleUnits,s=this.armiesAndUnits(t,n)[1],e=0;e<i.length;e++)for(var r=i[e],o=0;o<s.length;o++){var a=s[o];if(this.wounded(a)&&this.canAssist(t,n,r,a))return this.assist(t,n,r,a)}return null}),rule_3D:B(3,function(t,n){if(1===t.round)for(var i=this.playerPossibleUnits,s=this.armiesAndUnits(t,n)[1],e=0;e<i.length;e++)for(var r=i[e],o=0;o<s.length;o++){var a=s[o];if(this.wounded(a)&&this.canAssist(t,n,r,a))return this.assist(t,n,r,a)}return null}),rule_3E:B(3,function(t,n){if(2===t.round)for(var i=this.playerPossibleUnits,s=this.armiesAndUnits(t,n)[1],e=0;e<i.length;e++)for(var r=i[e],o=0;o<s.length;o++){var a=s[o];if(this.wounded(a)&&this.canAssist(t,n,r,a))return this.assist(t,n,r,a)}return null}),rule_3F:B(3,function(t,n){if(3===t.round)for(var i=this.playerPossibleUnits,s=this.livingEnemyUnits(t,n),e=this.armiesAndUnits(t,n)[1],r=0;r<i.length;r++)for(var o=i[r],a=0;a<e.length;a++){var l=e[a];if(l.cost()>o.cost()&&this.canAssist(t,n,o,l))for(var h=0;h<s.length;h++){var u=s[h];if(!this.canKill(t,u,o))return this.assist(t,n,o,l)}}return null}),rule_3G:B(3,function(t,n){var i=this.playerPossibleUnits;if(0===t.round)for(var s=0;s<i.length;s++){var e=i[s],r=this.enemyShootableUnits(t,n,e);if(r.length>1)for(var o=0;o<r.length;o++){var a=r[o];if(a.cost()===this.mostExpensiveUnit(r).cost())return this.shoot(e,a)}}return null}),rule_3H:B(3,function(t,n){if(2===t.round)for(var i=this.playerPossibleUnits,s=this.armiesAndUnits(t,n)[1],e=0;e<i.length;e++)for(var r=i[e],o=0;o<s.length;o++){var a=s[o];if(a.livingModels().length<a.size()&&this.canAssist(t,n,r,a))return this.assist(t,n,r,a)}return null}),rule_3I:B(3,function(t,n){if(1===t.round)for(var i=this.playerPossibleUnits,s=this.armiesAndUnits(t,n)[1],e=0;e<i.length;e++)for(var r=i[e],o=0;o<s.length;o++){var a=s[o];if(a.livingModels().length<a.size()&&this.canAssist(t,n,r,a))return this.assist(t,n,r,a)}return null}),rule_3J:B(3,function(t,n){if(0===t.round)for(var i=this.playerPossibleUnits,s=this.armiesAndUnits(t,n)[1],e=0;e<i.length;e++)for(var r=i[e],o=0;o<s.length;o++){var a=s[o];if(a.livingModels().length<a.size()&&this.canAssist(t,n,r,a))return this.assist(t,n,r,a)}return null}),rule_3K:B(3,function(t,n){if(0===t.round)for(var i=this.playerPossibleUnits,s=0;s<i.length;s++)for(var e=i[s],r=this.enemyShootableUnits(t,n,e),o=0;o<r.length;o++){var a=r[o];if(this.canShoot_(t,e,a,!1)&&this.unitIsStrongest(r,a))return this.shoot(e,a)}return null}),rule_3L:B(3,function(t,n){if(0===t.round)for(var i=this.playerPossibleUnits,s=this.armiesAndUnits(t,n)[1].concat(this.armiesAndUnits(t,n)[3]),e=0;e<i.length;e++)for(var r=i[e],o=this.enemyShootableUnits(t,n,r),a=0;a<o.length;a++){var l=o[a];if(this.willWoundShooting(t,r,l)&&this.unitIsStrongest(s,l))return this.shoot(r,l)}return null}),rule_3M:B(3,function(t,n){if(1===t.round)for(var i=this.playerPossibleUnits,s=0;s<i.length;s++)for(var e=i[s],r=this.enemyShootableUnits(t,n,e),o=0;o<r.length;o++){var a=r[o];if(this.willWoundShooting(t,e,a)&&this.unitIsStrongest(r,a))return this.shoot(e,a)}return null}),rule_3N:B(3,function(t,n){if(1===t.round)for(var i=this.playerPossibleUnits,s=this.armiesAndUnits(t,n)[1].concat(this.armiesAndUnits(t,n)[3]),e=0;e<i.length;e++)for(var r=i[e],o=this.enemyShootableUnits(t,n,r),a=0;a<o.length;a++){var l=o[a];if(this.willWoundShooting(t,r,l)&&this.unitIsStrongest(s,l))return this.shoot(r,l)}return null}),rule_3O:B(3,function(t,n){if(2===t.round)for(var i=this.playerPossibleUnits,s=0;s<i.length;s++)for(var e=i[s],r=this.enemyShootableUnits(t,n,e),o=0;o<r.length;o++){var a=r[o];if(this.willWoundShooting(t,e,a)&&this.unitIsStrongest(r,a))return this.shoot(e,a)}return null}),rule_3P:B(3,function(t,n){if(2===t.round)for(var i=this.playerPossibleUnits,s=0;s<i.length;s++)for(var e=i[s],r=this.enemyShootableUnits(t,n,e),o=0;o<r.length;o++){var a=r[o];if(this.willWoundShooting(t,e,a)&&this.easiestToKill(r,a))return this.shoot(e,a)}return null}),rule_3Q:B(3,function(t,n){if(0===t.round)for(var i=this.playerPossibleUnits,s=0;s<i.length;s++){var e=i[s];if("troop"===this.classification(e))for(var r=this.enemyShootableUnits(t,n,e),o=0;o<r.length;o++){var a=r[o];if(this.willWoundShooting(t,e,a)&&this.unitIsStrongest(r,a))return this.shoot(e,a)}}return null}),rule_3R:B(3,function(t,n){if(0===t.round)for(var i=this.playerPossibleUnits,s=this.armiesAndUnits(t,n)[1],e=0;e<i.length;e++){var r=i[e];if(r.cost()===this.cheapestUnit(s).cost())for(var o=this.enemyShootableUnits(t,n,r),a=0;a<o.length;a++){var l=o[a];if(this.willWoundShooting(t,r,l)&&this.unitIsStrongest(o,l))return this.shoot(r,l)}}return null}),rule_3S:B(3,function(t,n){if(0===t.round)for(var i=this.playerPossibleUnits,s=this.armiesAndUnits(t,n)[1].concat(this.armiesAndUnits(t,n)[3]),e=0;e<i.length;e++){var r=i[e];if("troop"===this.classification(r))for(var o=this.enemyShootableUnits(t,n,r),a=0;a<o.length;a++){var l=o[a];if(this.willWoundShooting(t,r,l)&&this.unitIsStrongest(s,l))return this.shoot(r,l)}}return null}),rule_3T:B(3,function(t,n){for(var i=this.playerPossibleUnits,s=this.armiesAndUnits(t,n),e=s[1],r=e.concat(s[3]),o=0;o<i.length;o++)for(var a=i[o],l=0;l<e.length;l++){var h=e[l];if(this.wounded(h)&&this.canAssist(t,n,a,h))for(var u=this.enemyShootableUnits(t,n,a),c=0;c<u.length;c++){var f=u[c];if(this.willWoundShooting(t,a,f)&&this.unitIsStrongest(r,f))return this.assist(t,n,a,h)}}return null}),rule_2A:B(2,function(t,n){if(0===t.round)for(var i=this.playerPossibleUnits,s=0;s<i.length;s++){var e=i[s],r=this.enemyAssaultableUnits(t,n,e);if(r.length>0)for(var o=0;o<r.length;o++){var a=r[o];if(this.wounded(a))return this.assault(e,a)}}return null}),rule_2B:B(2,function(t,n){if(0===t.round)for(var i=this.playerPossibleUnits,s=0;s<i.length;s++){var e=i[s];if("fastAttack"===this.classification(e))for(var r=this.enemyShootableUnits(t,n,e),o=0;o<r.length;o++){var a=r[o];return this.shoot(e,a)}}return null}),rule_2C:B(2,function(t,n){if(1===t.round)for(var i=this.playerPossibleUnits,s=0;s<i.length;s++){var e=i[s];if("fastAttack"===this.classification(e))for(var r=this.enemyShootableUnits(t,n,e),o=0;o<r.length;o++){var a=r[o];return this.shoot(e,a)}}return null}),rule_2D:B(2,function(t,n){if(2===t.round)for(var i=this.playerPossibleUnits,s=0;s<i.length;s++){var e=i[s];if("fastAttack"===this.classification(e))for(var r=this.enemyShootableUnits(t,n,e),o=0;o<r.length;o++){var a=r[o];return this.shoot(e,a)}}return null}),rule_2E:B(2,function(t,n){if(0===t.round)for(var i=this.playerPossibleUnits,s=this.armiesAndUnits(t,n)[1],e=0;e<i.length;e++){var r=i[e];if("heavySupport"===this.classification(r))for(var o=0;o<s.length;o++){var a=s[o];if(!a.isEnabled&&this.canAssist(t,n,r,a))return this.assist(t,n,r,a)}}return null}),rule_2F:B(2,function(t,n){if(0===t.round)for(var i=this.playerPossibleUnits,s=this.armiesAndUnits(t,n)[1],e=0;e<i.length;e++){var r=i[e];if("heavySupport"===this.classification(r))for(var o=0;o<s.length;o++){var a=s[o];if(this.canAssist(t,n,r,a))return this.assist(t,n,r,a)}}return null}),rule_2G:B(2,function(t,n){if(1===t.round)for(var i=this.playerPossibleUnits,s=this.armiesAndUnits(t,n)[1],e=0;e<i.length;e++){var r=i[e];if("heavySupport"===this.classification(r))for(var o=0;o<s.length;o++){var a=s[o];if(!a.isEnabled&&this.canAssist(t,n,r,a))return this.assist(t,n,r,a)}}return null}),rule_2H:B(2,function(t,n){if(1===t.round)for(var i=this.playerPossibleUnits,s=this.armiesAndUnits(t,n)[1],e=0;e<i.length;e++){var r=i[e];if("heavySupport"===this.classification(r))for(var o=0;o<s.length;o++){var a=s[o];if(this.canAssist(t,n,r,a))return this.assist(t,n,r,a)}}return null}),rule_2I:B(2,function(t,n){if(2===t.round)for(var i=this.playerPossibleUnits,s=this.armiesAndUnits(t,n)[1],e=0;e<i.length;e++){var r=i[e];if("heavySupport"===this.classification(r))for(var o=0;o<s.length;o++){var a=s[o];if(!a.isEnabled&&this.canAssist(t,n,r,a))return this.assist(t,n,r,a)}}return null}),rule_2J:B(2,function(t,n){if(2===t.round)for(var i=this.playerPossibleUnits,s=this.armiesAndUnits(t,n)[1],e=0;e<i.length;e++){var r=i[e];if("heavySupport"===this.classification(r))for(var o=0;o<s.length;o++){var a=s[o];if(this.canAssist(t,n,r,a))return this.assist(t,n,r,a)}}return null}),rule_2K:B(2,function(t,n){if(0===t.round)for(var i=this.playerPossibleUnits,s=this.armiesAndUnits(t,n)[1],e=0;e<i.length;e++){var r=i[e];if("troop"===this.classification(r))for(var o=0;o<s.length;o++){var a=s[o];if(!a.isEnabled&&this.canAssist(t,n,r,a))return this.assist(t,n,r,a)}}return null}),rule_2L:B(2,function(t,n){if(0===t.round)for(var i=this.playerPossibleUnits,s=this.armiesAndUnits(t,n)[1],e=0;e<i.length;e++){var r=i[e];if("troop"===this.classification(r))for(var o=0;o<s.length;o++){var a=s[o];if(this.canAssist(t,n,r,a))return this.assist(t,n,r,a)}}return null}),rule_2M:B(2,function(t,n){if(1===t.round)for(var i=this.playerPossibleUnits,s=this.armiesAndUnits(t,n)[1],e=0;e<i.length;e++){var r=i[e];if("troop"===this.classification(r))for(var o=0;o<s.length;o++){var a=s[o];if(!a.isEnabled&&this.canAssist(t,n,r,a))return this.assist(t,n,r,a)}}return null}),rule_2N:B(1,function(t,n){if(0===t.round)for(var i=this.playerPossibleUnits,s=this.armiesAndUnits(t,n)[1],e=0;e<i.length;e++){var r=i[e];if("troop"===this.classification(r))for(var o=0;o<s.length;o++){var a=s[o];if(this.canAssist(t,n,r,a))return this.assist(t,n,r,a)}}return null}),rule_2O:B(2,function(t,n){if(2===t.round)for(var i=this.playerPossibleUnits,s=this.armiesAndUnits(t,n)[1],e=0;e<i.length;e++){var r=i[e];if("troop"===this.classification(r))for(var o=0;o<s.length;o++){var a=s[o];if(!a.isEnabled&&this.canAssist(t,n,r,a))return this.assist(t,n,r,a)}}return null}),rule_2P:B(2,function(t,n){if(2===t.round)for(var i=this.playerPossibleUnits,s=this.armiesAndUnits(t,n)[1],e=0;e<i.length;e++){var r=i[e];if("troop"===this.classification(r))for(var o=0;o<s.length;o++){var a=s[o];if(this.canAssist(t,n,r,a))return this.assist(t,n,r,a)}}return null}),rule_2Q:B(2,function(t,n){if(0===t.round)for(var i=this.playerPossibleUnits,s=0;s<i.length;s++){var e=i[s];if("sniper"===this.classification(e))for(var r=this.enemyShootableUnits(t,n,e),o=0;o<r.length;o++){var a=r[o];return this.shoot(e,a)}}return null}),rule_2R:B(2,function(t,n){if(1===t.round)for(var i=this.playerPossibleUnits,s=0;s<i.length;s++){var e=i[s];if("sniper"===this.classification(e))for(var r=this.enemyShootableUnits(t,n,e),o=0;o<r.length;o++){var a=r[o];return this.shoot(e,a)}}return null}),rule_2S:B(2,function(t,n){if(2===t.round)for(var i=this.playerPossibleUnits,s=0;s<i.length;s++){var e=i[s];if("sniper"===this.classification(e))for(var r=this.enemyShootableUnits(t,n,e),o=0;o<r.length;o++){var a=r[o];return this.shoot(e,a)}}return null}),rule_1A:B(1,function(t,n){if(0===t.round)for(var i=this.playerPossibleUnits,s=0;s<i.length;s++){var e=i[s];if(this.canScape(t,n,e))return this.scape(t,n,e)}return null}),rule_1B:B(1,function(t,n){if(1===t.round)for(var i=this.playerPossibleUnits,s=0;s<i.length;s++){var e=i[s];if(this.canScape(t,n,e))return this.scape(t,n,e)}return null}),rule_1C:B(1,function(t,n){if(2===t.round)for(var i=this.playerPossibleUnits,s=0;s<i.length;s++)for(var e=i[s],r=this.enemyShootableUnits(t,n,e),o=0;o<r.length;o++){var a=r[o];return this.shoot(e,a)}return null}),rule_1D:B(1,function(t,n){if(3===t.round)for(var i=this.playerPossibleUnits,s=0;s<i.length;s++)for(var e=i[s],r=this.enemyAssaultableUnits(t,n,e),o=0;o<r.length;o++){var a=r[o];return this.assault(e,a)}return null}),rule_1E:B(1,function(t,n){for(var i=this.playerPossibleUnits,s=0;s<i.length;s++)for(var e=i[s],r=this.enemyShootableUnits(t,n,e),o=0;o<r.length;o++){var a=r[o];return this.shoot(e,a)}return null}),rule_1F:B(1,function(t,n){for(var i=this.playerPossibleUnits,s=0;s<i.length;s++){var e=i[s];if(0==this.enemyShootableUnits(t,n,e).length)for(var r=this.livingEnemyUnits(t,n),o=0;o<r.length;o++){var a=r[o];if(this.easiestToKill(r,a))return this.getCloseTo(t,e,a)}}return null})}),K=c.BasicRulePlayer_shoot=r(e.Player,{constructor:function(t){e.Player.call(this,t),l(this,t).array("rules",{defaultValue:[]}),this.__pendingActions__=[],this.rules=this.ownRules(),this.playerPossibleUnits=[],this.playerShootableUnits=[]},ownRules:function(){var t=this;return Object.keys(Object.getPrototypeOf(this)).map(function(n){return[t[n],1]}).filter(function(t){var n=t[0];return"function"==typeof n&&n.name&&"rule"===n.name.substr(0,4)})},decision:function(t,n){var i,s;if(t.synchronizeMetagame(),this.playerPossibleUnits=this.possibleUnits(t,n),this.playerShootableUnits=this.allShootableUnits(t,n),this.__pendingActions__.length<1)for(var e=0;e<this.rules.length;e++)if(s=(i=this.rules[e])[0].call(this,t,n))return s.forEach(function(t){t.__rule__=i}),this.__pendingActions__=this.__pendingActions__.concat(s),this.__pendingActions__.shift();return h(this.__pendingActions__.length<1,"No rule applied to game!"),this.__pendingActions__.shift()},"static __SERMAT__":{identifier:"BasicRulePlayer_shoot",serializer:function(t){return this.serializeAsProperties(t,["name","rules"])}},shoot:function(t,n){return[new m(t.id),new U(t.id,n.id)]},move:function(t,n,i){return i?[new m(t.id),n,new U(t.id,i.id)]:[new m(t.id),n,new y(t.id)]},possibleUnits:function(t,n){var i=[];return this.armiesAndUnits(t,n)[1].forEach(function(t){t.isDead()||!t.isEnabled||t.isActive||i.push(t)}),i},shootableUnitsAux:function(t,n,i){var s=[],e=this.livingEnemyUnits(t,n);return i.getShootActions(t).forEach(function(t){e.forEach(function(n){t.targetId===n.id&&s.push(n)})}),s},allShootableUnits:function(t,n){for(var i=[],s=this.playerPossibleUnits,e=0;e<s.length;e++){var r,o=s[e];r=this.shootableUnitsAux(t,n,o),i[e]=[o,r]}return i},enemyShootableUnits:function(t,n,i){for(var s=[],e=0;e<this.playerShootableUnits.length;e++)this.playerShootableUnits[e][0]==i&&(s=this.playerShootableUnits[e][1]);return s},canShoot_:function(t,n,i,s){return!(n.isDead()||!n.isEnabled||i.isDead()||t.terrain.canShoot(n,i)==1/0)},livingEnemyUnits:function(t,n){return this.armiesAndUnits(t,n)[2].livingUnits()},armiesAndUnits:function(t,n){var i=t.armies[n],s=i.units,e=t.opponent(n),r=t.armies[e];return[i,s,r,r.units]},easiestToKill:function(t,n){var i=o(t).map(function(t){return t.livingModels().length*t.defense}).max(0);return n.livingModels().length*n.defense===i},interForX:function(t,n,i,s){for(var e=[],r=i,o=t+1;o<n;o++)e.push([parseInt(o),parseInt(r)]),r+=s;return e},interForY:function(t,n,i,s){for(var e=[],r=i,o=t+1;o<n;o++)e.push([parseInt(r),parseInt(o)]),r+=s;return e},interpolation:function(t,n){var i,s,e=0,r=t[0],o=n[0],a=t[1],l=n[1],h=Math.min(r,o),u=Math.max(r,o),c=Math.min(a,l),f=Math.max(a,l);return s=h===r?a:l,i=c===a?r:o,a===l?this.interForX(h,u,s,e):r===o?this.interForY(c,f,i,e):Math.abs(l-a)>=Math.abs(o-r)?(e=Math.abs(o-r)/Math.abs(l-a),this.interForY(c,f,i,e)):(e=Math.abs(l-a)/Math.abs(o-r),this.interForX(h,u,s,e))},getCloseTo:function(t,n,i){for(var s=this.interpolation(n.position,i.position),e=n.getMoveActions(t),r=[],o=0;o<e.length;o++){var a=e[o].position;s.forEach(function(t){a[0]===t[0]&&a[1]===t[1]&&r.push(e[o])})}for(var l=n.position,h=e[Math.floor(Math.random()*e.length)],u=0;u<r.length;u++){var c=r[u].position;t.terrain.distance(c,i.position)<t.terrain.distance(l,i.position)&&(l=c,h=r[u])}return this.move(n,h)},rule_100:B(100,function(t,n){for(var i=this.playerPossibleUnits,s=0;s<i.length;s++)for(var e=i[s],r=this.enemyShootableUnits(t,n,e),o=0;o<r.length;o++){var a=r[o];return this.shoot(e,a)}return null}),rule_1F:B(1,function(t,n){for(var i=this.playerPossibleUnits,s=0;s<i.length;s++){var e=i[s];if(0==this.enemyShootableUnits(t,n,e).length)for(var r=this.livingEnemyUnits(t,n),o=0;o<r.length;o++){var a=r[o];if(this.easiestToKill(r,a))return this.getCloseTo(t,e,a)}}return null})}),W=c.BasicRulePlayer_assault=r(e.Player,{constructor:function(t){e.Player.call(this,t),l(this,t).array("rules",{defaultValue:[]}),this.__pendingActions__=[],this.rules=this.ownRules(),this.playerPossibleUnits=[],this.playerAssaultableUnits=[]},ownRules:function(){var t=this;return Object.keys(Object.getPrototypeOf(this)).map(function(n){return[t[n],1]}).filter(function(t){var n=t[0];return"function"==typeof n&&n.name&&"rule"===n.name.substr(0,4)})},decision:function(t,n){var i,s;if(t.synchronizeMetagame(),this.playerPossibleUnits=this.possibleUnits(t,n),this.playerAssaultableUnits=this.allAssaultableUnits(t,n),this.__pendingActions__.length<1)for(var e=0;e<this.rules.length;e++)if(s=(i=this.rules[e])[0].call(this,t,n))return s.forEach(function(t){t.__rule__=i}),this.__pendingActions__=this.__pendingActions__.concat(s),this.__pendingActions__.shift();return h(this.__pendingActions__.length<1,"No rule applied to game!"),this.__pendingActions__.shift()},"static __SERMAT__":{identifier:"BasicRulePlayer_assault",serializer:function(t){return this.serializeAsProperties(t,["name","rules"])}},assault:function(t,n){return[new m(t.id),new b(t.id,n.id)]},move:function(t,n,i){return i?[new m(t.id),n,new U(t.id,i.id)]:[new m(t.id),n,new y(t.id)]},possibleUnits:function(t,n){var i=[];return this.armiesAndUnits(t,n)[1].forEach(function(t){t.isDead()||!t.isEnabled||t.isActive||i.push(t)}),i},assaultableUnits:function(t,n,i){var s=[],e=this.livingEnemyUnits(t,n);return i.getAssaultActions(t).forEach(function(t){e.forEach(function(n){t.targetId===n.id&&s.push(n)})}),s},allAssaultableUnits:function(t,n){for(var i=[],s=this.playerPossibleUnits,e=0;e<s.length;e++){var r,o=s[e];r=this.assaultableUnits(t,n,o),i[e]=[o,r]}return i},enemyAssaultableUnits:function(t,n,i){for(var s=[],e=0;e<this.playerAssaultableUnits.length;e++)this.playerAssaultableUnits[e][0]==i&&(s=this.playerAssaultableUnits[e][1]);return s},canAssault:function(t,n,i){return!(n.isDead()||!n.isEnabled||i.isDead()||!(t.terrain.canShoot(n,i)<=12))},livingEnemyUnits:function(t,n){return this.armiesAndUnits(t,n)[2].livingUnits()},armiesAndUnits:function(t,n){var i=t.armies[n],s=i.units,e=t.opponent(n),r=t.armies[e];return[i,s,r,r.units]},rule_100:B(100,function(t,n){for(var i=this.playerPossibleUnits,s=0;s<i.length;s++)for(var e=i[s],r=this.enemyAssaultableUnits(t,n,e),o=0;o<r.length;o++){var a=r[o];return this.assault(e,a)}return null}),rule_1:B(1,function(t,n){for(var i=this.playerPossibleUnits,s=0;s<i.length;s++){var e=i[s],r=e.getMoveActions(t);return this.move(e,r[Math.floor(Math.random()*r.length)])}return null})}),N=c.BasicRulePlayer_assist=r(e.Player,{constructor:function(t){e.Player.call(this,t),l(this,t).array("rules",{defaultValue:[]}),this.__pendingActions__=[],this.rules=this.ownRules(),this.playerPossibleUnits=[],this.playerShootableUnits=[],this.playerAssaultableUnits=[]},ownRules:function(){var t=this;return Object.keys(Object.getPrototypeOf(this)).map(function(n){return[t[n],1]}).filter(function(t){var n=t[0];return"function"==typeof n&&n.name&&"rule"===n.name.substr(0,4)})},decision:function(t,n){var i,s;if(t.synchronizeMetagame(),this.playerPossibleUnits=this.possibleUnits(t,n),this.playerShootableUnits=this.allShootableUnits(t,n),this.playerAssaultableUnits=this.allAssaultableUnits(t,n),this.__pendingActions__.length<1)for(var e=0;e<this.rules.length;e++)if(s=(i=this.rules[e])[0].call(this,t,n))return s.forEach(function(t){t.__rule__=i}),this.__pendingActions__=this.__pendingActions__.concat(s),this.__pendingActions__.shift();return h(this.__pendingActions__.length<1,"No rule applied to game!"),this.__pendingActions__.shift()},"static __SERMAT__":{identifier:"BasicRulePlayer_assist",serializer:function(t){return this.serializeAsProperties(t,["name","rules"])}},shoot:function(t,n){return[new m(t.id),new U(t.id,n.id)]},assault:function(t,n){return[new m(t.id),new b(t.id,n.id)]},move:function(t,n,i){return i?[new m(t.id),n,new U(t.id,i.id)]:[new m(t.id),n,new y(t.id)]},assistAux:function(t,n,i,s,e){for(var r=0;r<i.length;r++){var o,a=i[r];if(this.canAssault(t,s,a))return this.assault(s,a);if(this.canBlockSight(t,s,e,a)){var l=this.blockSightMovements(t,s,e,a);o=l[Math.floor(Math.random()*l.length)]}if(this.canShoot_(t,s,a,!0))return o?this.move(s,o,a):this.shoot(s,a);if(o)return this.move(s,o)}return null},assist:function(t,n,i,s){var e=this.mostDangerousUnits(t,n,s),r=this.assistAux(t,n,e,i,s);if(r)return r;var o=this.dangerousUnits(t,n,s),a=this.assistAux(t,n,o,i,s);if(a)return a;console.log("no asiste cuando deberia");var l=i.getMoveActions(t);return this.move(i,l[Math.floor(Math.random()*l.length)])},possibleUnits:function(t,n){var i=[];return this.armiesAndUnits(t,n)[1].forEach(function(t){t.isDead()||!t.isEnabled||t.isActive||i.push(t)}),i},shootableUnitsAux:function(t,n,i){var s=[],e=this.livingEnemyUnits(t,n);return i.getShootActions(t).forEach(function(t){e.forEach(function(n){t.targetId===n.id&&s.push(n)})}),s},allShootableUnits:function(t,n){for(var i=[],s=this.playerPossibleUnits,e=0;e<s.length;e++){var r,o=s[e];r=this.shootableUnitsAux(t,n,o),i[e]=[o,r]}return i},enemyShootableUnits:function(t,n,i){for(var s=[],e=0;e<this.playerShootableUnits.length;e++)this.playerShootableUnits[e][0]==i&&(s=this.playerShootableUnits[e][1]);return s},assaultableUnits:function(t,n,i){var s=[],e=this.livingEnemyUnits(t,n);return i.getAssaultActions(t).forEach(function(t){e.forEach(function(n){t.targetId===n.id&&s.push(n)})}),s},allAssaultableUnits:function(t,n){for(var i=[],s=this.playerPossibleUnits,e=0;e<s.length;e++){var r,o=s[e];r=this.assaultableUnits(t,n,o),i[e]=[o,r]}return i},enemyAssaultableUnits:function(t,n,i){for(var s=[],e=0;e<this.playerAssaultableUnits.length;e++)this.playerAssaultableUnits[e][0]==i&&(s=this.playerAssaultableUnits[e][1]);return s},canShoot_:function(t,n,i,s){return!(n.isDead()||!n.isEnabled||i.isDead()||t.terrain.canShoot(n,i)==1/0)},canAssault:function(t,n,i){return!(n.isDead()||!n.isEnabled||i.isDead()||!(t.terrain.canShoot(n,i)<=12))},interForX:function(t,n,i,s){for(var e=[],r=i,o=t+1;o<n;o++)e.push([parseInt(o),parseInt(r)]),r+=s;return e},interForY:function(t,n,i,s){for(var e=[],r=i,o=t+1;o<n;o++)e.push([parseInt(r),parseInt(o)]),r+=s;return e},interpolation:function(t,n){var i,s,e=0,r=t[0],o=n[0],a=t[1],l=n[1],h=Math.min(r,o),u=Math.max(r,o),c=Math.min(a,l),f=Math.max(a,l);return s=h===r?a:l,i=c===a?r:o,a===l?this.interForX(h,u,s,e):r===o?this.interForY(c,f,i,e):Math.abs(l-a)>=Math.abs(o-r)?(e=Math.abs(o-r)/Math.abs(l-a),this.interForY(c,f,i,e)):(e=Math.abs(l-a)/Math.abs(o-r),this.interForX(h,u,s,e))},blockSightMovements:function(t,n,i,s){for(var e=i.position,r=s.position,o=this.interpolation(e,r),a=[],l=n.getMoveActions(t),h=0;h<l.length;h++){var u=l[h].position;o.forEach(function(t){u[0]===t[0]&&u[1]===t[1]&&a.push(l[h])})}return a},canBlockSight:function(t,n,i,s){return this.blockSightMovements(t,n,i,s).length>0},canAssist:function(t,n,i,s){for(var e=this.dangerousUnits(t,n,s),r=!1,o=0;o<e.length;o++){var a=e[o];if(!(this.canBlockSight(t,i,s,a)||this.canShoot_(t,i,a,!0)||this.canAssault(t,i,a))){r=!1;break}r=!0}return r},mostDangerousUnits:function(t,n,i){for(var s=this.livingEnemyUnits(t,n),e=[],r=0;r<s.length;r++){var o=s[r];this.canKill(t,o,i)&&e.push(o)}return e},dangerousUnits:function(t,n,i){for(var s=this.livingEnemyUnits(t,n),e=[],r=0;r<s.length;r++){var o=s[r];(this.canShoot_(t,o,i,!0)||this.canAssault(t,o,i))&&e.push(o)}return e},canBeKilled:function(t,n,i){for(var s=this.armiesAndUnits(t,n)[3],e=0;e<s.length;e++)if(this.canKill(t,s[e],i))return!0;return!1},canKill:function(t,n,i){return!(n.isDead()||!n.isEnabled||i.isDead()||!this.canKillShooting(t,n,i)&&!this.canKillAssaulting(t,n,i))},canKillShooting:function(t,n,i){return!(n.isDead()||i.isDead()||!n.isEnabled||!(this.bestAttackResultShooting(t,n,i)>=100))},canKillAssaulting:function(t,n,i){return!(n.isDead()||i.isDead()||!n.isEnabled||!(this.bestAttackResultAssaulting(t,n,i)>=100))},bestAttackResult:function(t,n,i){if(!n.isDead()&&n.isEnabled&&!i.isDead()){var s=this.bestAttackResultShooting(t,n,i),e=this.bestAttackResultAssaulting(t,n,i),r=Math.max(s,e);return r}return 0},bestAttackResultShooting:function(t,n,i){if(!n.isDead()&&n.isEnabled&&!i.isDead()){var s=t.terrain.distance(n.position,i.position),e=0;n.livingModels().forEach(function(t){t.equipments.forEach(function(t){t.range>=s&&(e+=t.attacks)})});var r=i.livingModels().length,o=100*e/r;return o>100&&(o=100),o}return 0},bestAttackResultAssaulting:function(t,n,i){if(!n.isDead()&&n.isEnabled&&!i.isDead()&&this.canAssault(t,n,i)){var s=0;n.livingModels().forEach(function(t){t.equipments.forEach(function(t){0===t.range&&(s+=t.attacks)})});var e=i.livingModels().length,r=100*s/e;return r>100&&(r=100),r}return 0},shootingKillableUnits:function(t,n,i){for(var s=[],e=this.shootableUnitsAux(t,n,i),r=0;r<e.length;r++){var o=e[r];this.willKillShooting(t,i,o)&&s.push(o)}return s},livingEnemyUnits:function(t,n){return this.armiesAndUnits(t,n)[2].livingUnits()},armiesAndUnits:function(t,n){var i=t.armies[n],s=i.units,e=t.opponent(n),r=t.armies[e];return[i,s,r,r.units]},rule_100:B(100,function(t,n){for(var i=this.playerPossibleUnits,s=this.armiesAndUnits(t,n)[1],e=0;e<i.length;e++)for(var r=i[e],o=0;o<s.length;o++){var a=s[o];if(this.canAssist(t,n,r,a))return this.assist(t,n,r,a)}return null}),rule_1:B(1,function(t,n){for(var i=this.playerPossibleUnits,s=0;s<i.length;s++){var e=i[s],r=e.getMoveActions(t);return this.move(e,r[Math.floor(Math.random()*r.length)])}return null})}),T=c.BasicRulePlayer_scape_then_shoot=r(e.Player,{constructor:function(t){e.Player.call(this,t),l(this,t).array("rules",{defaultValue:[]}),this.__pendingActions__=[],this.rules=this.ownRules(),this.playerPossibleUnits=[],this.playerShootableUnits=[]},ownRules:function(){var t=this;return Object.keys(Object.getPrototypeOf(this)).map(function(n){return[t[n],1]}).filter(function(t){var n=t[0];return"function"==typeof n&&n.name&&"rule"===n.name.substr(0,4)})},decision:function(t,n){var i,s;if(t.synchronizeMetagame(),this.playerPossibleUnits=this.possibleUnits(t,n),this.playerShootableUnits=this.allShootableUnits(t,n),this.__pendingActions__.length<1)for(var e=0;e<this.rules.length;e++)if(s=(i=this.rules[e])[0].call(this,t,n))return s.forEach(function(t){t.__rule__=i}),this.__pendingActions__=this.__pendingActions__.concat(s),this.__pendingActions__.shift();return h(this.__pendingActions__.length<1,"No rule applied to game!"),this.__pendingActions__.shift()},"static __SERMAT__":{identifier:"BasicRulePlayer_scape_then_shoot",serializer:function(t){return this.serializeAsProperties(t,["name","rules"])}},shoot:function(t,n){return[new m(t.id),new U(t.id,n.id)]},move:function(t,n,i){return i?[new m(t.id),n,new U(t.id,i.id)]:[new m(t.id),n,new y(t.id)]},scapeAux:function(t,n,i,s){for(var e=0;e<i.length;e++){var r=i[e],o=[];if(this.canHide(t,s,r)){for(var a=this.hideMoves(t,s,r),l=0;l<a.length;l++)if(t.terrain.distance(r.position,a[l].position)<=r.maxRange()+6)return this.move(s,a[l]);o=o.concat(a)}if(this.canRun(t,s,r)){for(var h=this.runMoves(t,s,r),u=0;u<h.length;u++)if(t.terrain.distance(r.position,h[u].position)<=r.maxRange()+6)return this.move(s,h[u]);o=o.concat(h)}if(o.length>0)return this.move(s,o[Math.floor(Math.random()*o.length)])}},scape:function(t,n,i){var s=this.mostDangerousUnits(t,n,i),e=this.scapeAux(t,n,s,i);if(e)return e;this.dangerousUnits(t,n,i);var r=this.scapeAux(t,n,s,i);if(r)return r;console.log("no escapa cuando deberia");var o=i.getMoveActions(t);return this.move(i,o[Math.floor(Math.random()*o.length)])},possibleUnits:function(t,n){var i=[];return this.armiesAndUnits(t,n)[1].forEach(function(t){t.isDead()||!t.isEnabled||t.isActive||i.push(t)}),i},shootableUnitsAux:function(t,n,i){var s=[],e=this.livingEnemyUnits(t,n);return i.getShootActions(t).forEach(function(t){e.forEach(function(n){t.targetId===n.id&&s.push(n)})}),s},allShootableUnits:function(t,n){for(var i=[],s=this.playerPossibleUnits,e=0;e<s.length;e++){var r,o=s[e];r=this.shootableUnitsAux(t,n,o),i[e]=[o,r]}return i},enemyShootableUnits:function(t,n,i){for(var s=[],e=0;e<this.playerShootableUnits.length;e++)this.playerShootableUnits[e][0]==i&&(s=this.playerShootableUnits[e][1]);return s},canShoot_:function(t,n,i,s){return!(n.isDead()||!n.isEnabled||i.isDead()||t.terrain.canShoot(n,i)==1/0)},canRun:function(t,n,i){var s=i.maxRange()+6;return!(n.isEnabled&&t.terrain.canShoot(i,n)<=s)},canHide:function(t,n,i){return!1},runMoves:function(t,n,i){for(var s=i.position,e=n.position,r=n.getMoveActions(t),o=r[Math.floor(Math.random()*r.length)],a=0;a<r.length;a++){var l=r[a].position;t.terrain.distance(l,s)>t.terrain.distance(e,s)&&(e=l,o=r[a])}return t.terrain.distance(i.position,e)<=i.maxRange()+6?(console.log("run y puede huir"),[o]):(console.log("run y huyo lo maximo q pudo pero igual lo alcanzan"),[o])},hideMoves:function(t,n,i){return[]},canScape:function(t,n,i){var s=this.mostDangerousUnits(t,n,i);if(0===s.length)return!1;for(var e=!0,r=0;r<s.length;r++){var o=s[r];this.canRun(t,i,o)||this.canHide(t,i,o)||(e=!1)}return e},mostDangerousUnits:function(t,n,i){for(var s=this.livingEnemyUnits(t,n),e=[],r=0;r<s.length;r++){var o=s[r];this.canKill(t,o,i)&&e.push(o)}return e},dangerousUnits:function(t,n,i){for(var s=this.livingEnemyUnits(t,n),e=[],r=0;r<s.length;r++){var o=s[r];(this.canShoot_(t,o,i,!0)||this.canAssault(t,o,i))&&e.push(o)}return e},canBeKilled:function(t,n,i){for(var s=this.armiesAndUnits(t,n)[3],e=0;e<s.length;e++)if(this.canKill(t,s[e],i))return!0;return!1},canKill:function(t,n,i){return!(n.isDead()||!n.isEnabled||i.isDead()||!this.canKillShooting(t,n,i)&&!this.canKillAssaulting(t,n,i))},canKillShooting:function(t,n,i){return!(n.isDead()||i.isDead()||!n.isEnabled||!(this.bestAttackResultShooting(t,n,i)>=100))},canKillAssaulting:function(t,n,i){return!(n.isDead()||i.isDead()||!n.isEnabled||!(this.bestAttackResultAssaulting(t,n,i)>=100))},bestAttackResult:function(t,n,i){if(!n.isDead()&&n.isEnabled&&!i.isDead()){var s=this.bestAttackResultShooting(t,n,i),e=this.bestAttackResultAssaulting(t,n,i),r=Math.max(s,e);return r}return 0},bestAttackResultShooting:function(t,n,i){if(!n.isDead()&&n.isEnabled&&!i.isDead()){var s=t.terrain.distance(n.position,i.position),e=0;n.livingModels().forEach(function(t){t.equipments.forEach(function(t){t.range>=s&&(e+=t.attacks)})});var r=i.livingModels().length,o=100*e/r;return o>100&&(o=100),o}return 0},canAssault:function(t,n,i){return!(n.isDead()||!n.isEnabled||i.isDead()||!(t.terrain.canShoot(n,i)<=12))},bestAttackResultAssaulting:function(t,n,i){if(!n.isDead()&&n.isEnabled&&!i.isDead()&&this.canAssault(t,n,i)){var s=0;n.livingModels().forEach(function(t){t.equipments.forEach(function(t){0===t.range&&(s+=t.attacks)})});var e=i.livingModels().length,r=100*s/e;return r>100&&(r=100),r}return 0},livingEnemyUnits:function(t,n){return this.armiesAndUnits(t,n)[2].livingUnits()},armiesAndUnits:function(t,n){var i=t.armies[n],s=i.units,e=t.opponent(n),r=t.armies[e];return[i,s,r,r.units]},rule_100:B(100,function(t,n){for(var i=this.playerPossibleUnits,s=0;s<i.length;s++){var e=i[s];if(this.canScape(t,n,e))return this.scape(t,n,e)}return null}),rule_2:B(2,function(t,n){for(var i=this.playerPossibleUnits,s=0;s<i.length;s++)for(var e=i[s],r=this.enemyShootableUnits(t,n,e),o=0;o<r.length;o++){var a=r[o];return this.shoot(e,a)}return null}),rule_1:B(1,function(t,n){for(var i=this.playerPossibleUnits,s=0;s<i.length;s++){var e=i[s],r=e.getMoveActions(t);return this.move(e,r[Math.floor(Math.random()*r.length)])}return null})});c.Renderer=r({constructor:function(t){t=this.canvas=t||document.getElementById("wargame-canvas"),(this.ctx=t.getContext("2d")).fillStyle="white"},renderScope:function(t,n,i){var s=this.canvas,e=this.ctx;e.save(),e.scale(s.width/t,s.height/n);try{i.call(this,e)}finally{e.restore()}},render:function(t){var n=t.terrain;this.renderScope(n.width,n.height,function(i){i.clearRect(0,0,this.canvas.width,this.canvas.height);for(var s=0,e=n.width;s<e;s++)for(var r=0,o=n.height;r<o;r++)n.isPassable([s,r])?this.drawSquare(s,r,1,1,"#CCCCCC"):this.drawSquare(s,r,1,1,"black");var a=this,l=t.armies;for(var h in i.strokeStyle="black",i.font="1px Arial",l)l[h].units.forEach(function(t){t.isDead()||(a.drawSquare(t.position[0],t.position[1],1,1,t.army.player),i.fillStyle="black",i.fillText(t.id,t.position[0],t.position[1]))})})},renderPath:function(t,n,i){var s=t.terrain;this.renderScope(s.width,s.height,function(e){e.clearRect(0,0,this.canvas.width,this.canvas.height);for(var r=0,o=s.width;r<o;r++)for(var a=0,l=s.height;a<l;a++)s.isPassable([r,a])?this.drawSquare(r,a,1,1,"#CCCCCC"):this.drawSquare(r,a,1,1,"black");var h=this,u=t.armies;for(var c in e.strokeStyle="black",e.font="1px Arial",u)u[c].units.forEach(function(t){t.isDead()||(h.drawSquare(t.position[0],t.position[1],1,1,t.army.player),e.fillStyle="black",e.fillText(t.id,t.position[0],t.position[1]))});for(var f in n)h.drawSquare(n[f].x,n[f].y,1,1,i||"red")})},renderSight:function(t,n){if(n=n||t.__activeUnit__){var i=t.terrain;this.renderScope(i.width,i.height,function(t){var s,e,r=n.maxRange(),o=i.areaOfSight(n,r);for(var a in o)s=.8*(1-o[a]/r)+.2,e=a.split(","),this.drawSquare(+e[0],+e[1],1,1,"rgba(255,255,0,"+s+")")})}},renderMoves:function(t,n){var i=this.canvas,s=this.ctx,e=t.terrain;e.world;for(var r in this.render(t),s.save(),s.scale(i.width/e.WorldWidth,i.height/e.WorldHeight),n)n[r].forEach(function(t){t.constructor==_&&(s.save(),s.fillStyle="#32CD32",s.beginPath(),s.arc(t.position[0],t.position[1],1,0,2*Math.PI),s.fill(),s.restore())});s.restore()},drawSquare:function(t,n,i,s,e){var r=this.ctx;r.fillStyle=e,r.fillRect(t,n,1,1)},renderInfluence:function(t,n){var i=t.terrain;this.renderScope(i.width,i.height,function(i){var s,e,r,o,a,l=n.length,h=n[0].length,u=(this.canvas,t.terrain),c=(u.world,Number.POSITIVE_INFINITY),f=Number.NEGATIVE_INFINITY,v=u.width,d=u.height;for(i.clearRect(0,0,this.canvas.width,this.canvas.height),o=0;o<v;o++)for(a=0;a<d;a++)u.isPassable([o,a])?this.drawSquare(o,a,1,1,"#CCCCCC"):this.drawSquare(o,a,1,1,"black");for(o=0;o<l;o++)for(a=0;a<h;a++)isNaN(n[o][a])||(f=Math.max(f,n[o][a]),c=Math.min(c,n[o][a]));for(e=Math.max(f,Math.abs(c)),o=0;o<l;o++)for(a=0;a<h;a++)"t"==(s=n[o][a])?this.drawSquare(o,a,1,1,"black"):s>0?(r=s/e,this.drawSquare(o,a,1,1,"rgba(255,0,0,"+r+")")):s<0&&(r=-s/e,this.drawSquare(o,a,1,1,"rgba(0,0,255,"+r+")"))})}});var C=c.StrategicAttackAction=r(p,{constructor:function(t,n){this.unitId=t,this.targetId=n},executeMovement:function(t,n,i){var s=t.activePlayer(),e=this.unitById(t,this.unitId),r=this.unitById(t,this.targetId),o=n.shootPositions,a=(n.assaultPositions,n.movePositions);return o.length>0?(o.sort(function(t,n){return n.influence-t.influence}),(t=(t=t.next(u(s,new _(e.id,o[0].position,!1)),null,i)).next(u(s,new U(e.id,r.id)))).isContingent&&(t=t.randomNext())):t=t.next(u(s,new _(e.id,a[a.length-1].position,!0)),null,i),t.__activeUnit__&&g.__activeUnit__.id===attack.unitId&&(t=t.next(u(s,new y(e.id)),null,i)),t},synchronizeMetagame:function(){this.terrain.resetTerrain(this)},strategicPositions:function(t,n){var i,s=t,e=this.unitById(s,this.unitId),r=this.unitById(s,this.targetId),o=s.activePlayer(),a={movePositions:[],shootPositions:[],assaultPositions:[]};n?(i=s.terrain.canReachAStarInf({target:r,attacker:e,influenceMap:n,role:o}),RENDERER.renderInfluence(s,n)):i=s.terrain.canReachAStar({target:r,attacker:e}),i.unshift({x:e.position[0],y:e.position[1]});for(var l=0;l<i.length;l++){var h=i[l],u=s.terrain.canShootPos([h.x,h.y],r.position,this.unitId,this.targetId,e.maxRange()),c=u!==1/0?u:void 0,f=this.getInf([h.x,h.y],o,n),v=l<=6&&void 0!==c,d=c<=2,g=l<=12;r.position[0]==h.x&&r.position[1]==h.y||(v?a.shootPositions.push({position:[h.x,h.y],influence:f,shootDistance:c}):g?a.movePositions.push({position:[h.x,h.y],influence:f,shootDistance:c}):d&&a.assaultPositions.push({position:[h.x,h.y],influence:f,shootDistance:c}))}return a},getInf:function(t,n,i){var s=t[0],e=t[1];return"Red"==n?i[s][e]:-i[s][e]},execute:function(t,n){t.concreteGame.synchronizeMetagame();var i=t.concreteGame,s=this.unitById(i,this.unitId),e=this.unitById(i,this.targetId),r=i.activePlayer();this.strategicPositions(i,t.concreteInfluence);if(i.result())return null;var o=(i=i.next(u(r,new m(this.unitId)),null,n)).moves()[r],a=i.terrain.canShoot(s,e);this.getShots(i,o);return a||(i=this.executeMovement(i,o,n)).__activeUnit__&&i.__activeUnit__.id===this.unitId&&(a=i.terrain.canShoot(shooter,e)),a&&(i=i.next(u(r,new U(s.id,e.id)))).isContingent&&(i=i.randomNext()),i.__activeUnit__&&i.__activeUnit__.id===this.unitId&&(i=i.next(u(r,new y(s.id)),null,n)),h(!(i instanceof P),"Executing action ",this," did not yield a Wargame instance!"),t.concreteGame=i,t},"static __SERMAT__":{identifier:"StrategicAttackAction",serializer:function(t){return[t.unitId,t.targetId]}},toString:function(){return s.ser(this)}}),q=c.AbstractedWargame=r(e.Game,{constructor:function(t){h(!(t instanceof P),"Invalid concrete wargame ",t,"!"),this.players=t.players,e.Game.call(this,t.activePlayer()),this.concreteGame=t,this.influenceMap=new R(t),this.concreteInfluence=this.influenceMap.update(t)},result:function(){return this.concreteGame.result()},moves:function(){if(this.result())return null;var t=this.concreteGame,n=this.activePlayer(),i={};return i[n]=a.product(t.armies[n].units.filter(function(n){return!n.isDead(t)&&n.isEnabled}),t.armies[t.opponent()].units.filter(function(t){return!t.isDead()})).mapApply(function(t,n){return new C(t.id,n.id)}).toArray(),i},next:function(t,n,i){var s=i?this:this.clone(),e=t[this.activePlayer()];return e instanceof C?e.execute(s,i):(s.concreteGame=s.concreteGame.next(t,n,!0),s.concreteGame.isContingent&&(s.concreteGame=s.concreteGame.randomNext())),s.activePlayers=s.concreteGame.activePlayers,s.concreteInfluence=s.influenceMap.update(s.concreteGame,1),s},clone:function(){return new this.constructor(this.concreteGame.clone())},"static __SERMAT__":{identifier:"AbstractedWargame",serializer:function(t){return[t.concreteGame]}}}),F=(c.ConcreteRandomPlayer=r(e.players.RandomPlayer,{decision:function(t,n){return t instanceof C&&(t=t.concreteGame),e.players.RandomPlayer.prototype.decision.call(this,t,n)}}),c.astar=r({pathTo:function(t){for(var n=t,i=[];n.parent;)i.unshift(n),n=n.parent;return i},getHeap:function(){return new H(function(t){return t.f})},search:function(t,n,i,s){t.cleanDirty();var e=(s=s||{}).heuristic||this.heuristics.manhattan,r=s.closest||!1,o=this.getHeap(),a=s.exitCondition,l=n;for(n.h=e(n,i,s.influenceMap,s.role),t.markDirty(n),o.push(n);o.size()>0;){var h=o.pop();if(h===i||a&&a[h.x+","+h.y])return this.pathTo(h);h.closed=!0;for(var u=t.neighbors(h),c=0,f=u.length;c<f;++c){var v=u[c];if(!v.closed&&!v.isWall()){var d=h.g+v.getCost(h),g=v.visited;(!g||d<v.g)&&(v.visited=!0,v.parent=h,v.h=v.h||e(v,i,s.influenceMap),v.g=d,v.f=v.g+v.h,t.markDirty(v),r&&(v.h<l.h||v.h===l.h&&v.g<l.g)&&(l=v),g?o.rescoreElement(v):o.push(v))}}}return r?this.pathTo(l):[]},heuristics:{manhattan:function(t,n){return Math.abs(n.x-t.x)+Math.abs(n.y-t.y)},diagonal:function(t,n){var i=Math.sqrt(2),s=Math.abs(n.x-t.x),e=Math.abs(n.y-t.y);return 1*(s+e)+(i-2)*Math.min(s,e)}},cleanNode:function(t){t.f=0,t.g=0,t.h=0,t.visited=!1,t.closed=!1,t.parent=null}})),G=c.Graph=r({constructor:function(t,n){var i,s,e,r,o;for(n=n||{},this.nodes=[],this.diagonal=!!n.diagonal,this.grid=[],this.astar=new F,s=0;s<t.width;s++)for(this.grid[s]=[],e=0;e<t.height;e++)o=n.start[0]==s&&n.start[1]==e,o=n.end[0]==s&&n.end[1]==e,r=!0===(t.isPassable([s,e],!0)||o||void 0)?1:0,i=new z(s,e,r),this.grid[s][e]=i,this.nodes.push(i);this.init()},init:function(){this.dirtyNodes=[];for(var t=0;t<this.nodes.length;t++)this.astar.cleanNode(this.nodes[t])},cleanDirty:function(){for(var t=0;t<this.dirtyNodes.length;t++)this.astar.cleanNode(this.dirtyNodes[t]);this.dirtyNodes=[]},markDirty:function(t){this.dirtyNodes.push(t)},neighbors:function(t){var n=[],i=t.x,s=t.y,e=this.grid;return e[i-1]&&e[i-1][s]&&n.push(e[i-1][s]),e[i+1]&&e[i+1][s]&&n.push(e[i+1][s]),e[i]&&e[i][s-1]&&n.push(e[i][s-1]),e[i]&&e[i][s+1]&&n.push(e[i][s+1]),this.diagonal&&(e[i-1]&&e[i-1][s-1]&&n.push(e[i-1][s-1]),e[i+1]&&e[i+1][s-1]&&n.push(e[i+1][s-1]),e[i-1]&&e[i-1][s+1]&&n.push(e[i-1][s+1]),e[i+1]&&e[i+1][s+1]&&n.push(e[i+1][s+1])),n},toString:function(){for(var t=[],n=this.grid,i=0;i<n.length;i++){for(var s=[],e=n[i],r=0;r<e.length;r++)s.push(e[r].weight);t.push(s.join(" "))}return t.join("\n")}}),z=c.GridNode=r({constructor:function(t,n,i){this.x=t,this.y=n,this.weight=i},toString:function(){return"["+this.x+" "+this.y+"]"},getCost:function(t){return t&&t.x!=this.x&&t.y!=this.y?1.41421*this.weight:this.weight},isWall:function(){return 0===this.weight}}),H=c.BinaryHeap=r({constructor:function(t){this.content=[],this.scoreFunction=t},push:function(t){this.content.push(t),this.sinkDown(this.content.length-1)},pop:function(){var t=this.content[0],n=this.content.pop();return this.content.length>0&&(this.content[0]=n,this.bubbleUp(0)),t},remove:function(t){var n=this.content.indexOf(t),i=this.content.pop();n!==this.content.length-1&&(this.content[n]=i,this.scoreFunction(i)<this.scoreFunction(t)?this.sinkDown(n):this.bubbleUp(n))},size:function(){return this.content.length},rescoreElement:function(t){this.sinkDown(this.content.indexOf(t))},sinkDown:function(t){for(var n=this.content[t];t>0;){var i=(t+1>>1)-1,s=this.content[i];if(!(this.scoreFunction(n)<this.scoreFunction(s)))break;this.content[i]=n,this.content[t]=s,t=i}},bubbleUp:function(t){for(var n=this.content.length,i=this.content[t],s=this.scoreFunction(i);;){var e,r=t+1<<1,o=r-1,a=null;if(o<n){var l=this.content[o];(e=this.scoreFunction(l))<s&&(a=o)}if(r<n){var h=this.content[r];this.scoreFunction(h)<(null===a?s:e)&&(a=r)}if(null===a)break;this.content[t]=this.content[a],this.content[a]=i,t=a}}});return[].forEach(function(t){t.__SERMAT__.identifier=c.__package__+"."+t.__SERMAT__.identifier,c.__SERMAT__.include.push(t)}),s.include(c),c});
//# sourceMappingURL=ludorum-wargame.min.js.map